{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, resolveComponent as _resolveComponent, openBlock as _openBlock, createBlock as _createBlock, createElementVNode as _createElementVNode, Fragment as _Fragment, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"wayline-fallback\"\n};\nconst _hoisted_2 = {\n  ref: \"djiContainer\",\n  class: \"dji-container\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_WaylineList = _resolveComponent(\"WaylineList\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createCommentVNode(\" 当大疆组件不可用时显示自定义航线列表 \"), $data.showCustomWaylineList ? (_openBlock(), _createBlock(_component_WaylineList, {\n    key: 0,\n    \"current-selected-id\": $props.currentSelectedId,\n    onWaylineSelected: $options.handleWaylineSelected\n  }, null, 8 /* PROPS */, [\"current-selected-id\", \"onWaylineSelected\"])) : (_openBlock(), _createElementBlock(_Fragment, {\n    key: 1\n  }, [_createCommentVNode(\" 用于放置大疆原始组件的容器 \"), _createElementVNode(\"div\", _hoisted_2, null, 512 /* NEED_PATCH */)], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */))]);\n}","map":{"version":3,"names":["class","ref","_createElementBlock","_hoisted_1","_createCommentVNode","$data","showCustomWaylineList","_createBlock","_component_WaylineList","$props","currentSelectedId","onWaylineSelected","$options","handleWaylineSelected","_Fragment","key","_createElementVNode","_hoisted_2"],"sources":["D:\\projects\\FlightHub-2-Frontend-Standalone-Component\\frontend\\src\\components\\WaylineFallback.vue"],"sourcesContent":["<template>\r\n  <div class=\"wayline-fallback\">\r\n    <!-- 当大疆组件不可用时显示自定义航线列表 -->\r\n    <WaylineList \r\n      v-if=\"showCustomWaylineList\" \r\n      :current-selected-id=\"currentSelectedId\"\r\n      @wayline-selected=\"handleWaylineSelected\"\r\n    />\r\n    \r\n    <!-- 用于放置大疆原始组件的容器 -->\r\n    <div \r\n      v-else \r\n      ref=\"djiContainer\" \r\n      class=\"dji-container\"\r\n    ></div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport WaylineList from './WaylineList.vue'\r\n\r\nexport default {\r\n  name: 'WaylineFallback',\r\n  components: {\r\n    WaylineList\r\n  },\r\n  props: {\r\n    currentSelectedId: {\r\n      type: Number,\r\n      default: null\r\n    }\r\n  },\r\n  emits: ['wayline-selected'],\r\n  data() {\r\n    return {\r\n      showCustomWaylineList: false,\r\n      djiComponentLoaded: false,\r\n      checkTimer: null\r\n    }\r\n  },\r\n  async mounted() {\r\n    // 尝试加载大疆组件\r\n    await this.tryLoadDjiComponent()\r\n  },\r\n  beforeDestroy() {\r\n    // 清理定时器\r\n    if (this.checkTimer) {\r\n      clearTimeout(this.checkTimer)\r\n    }\r\n  },\r\n  methods: {\r\n    async tryLoadDjiComponent() {\r\n      try {\r\n        // 检查大疆组件是否可用\r\n        this.djiComponentLoaded = await this.checkDjiComponentAvailability()\r\n        \r\n        if (!this.djiComponentLoaded) {\r\n          // 如果不可用，使用自定义组件\r\n          this.showCustomWaylineList = true\r\n          this.$message.warning('大疆航线组件加载失败，已切换至自定义航线列表')\r\n        } else {\r\n          // 尝试渲染大疆组件\r\n          this.renderDjiComponent()\r\n          \r\n          // 设置一个定时器再次检查，确保组件正常工作\r\n          this.checkTimer = setTimeout(() => {\r\n            this.verifyDjiComponent()\r\n          }, 3000)\r\n        }\r\n      } catch (error) {\r\n        console.error('加载大疆组件时出错:', error)\r\n        this.showCustomWaylineList = true\r\n        this.$message.warning('大疆航线组件加载失败，已切换至自定义航线列表')\r\n      }\r\n    },\r\n    \r\n    async checkDjiComponentAvailability() {\r\n      try {\r\n        // 检查全局是否存在大疆相关对象\r\n        if (typeof window.DJI !== 'undefined' && \r\n            typeof window.DJI.WaylineComponent !== 'undefined') {\r\n          return true\r\n        }\r\n        \r\n        // 检查是否有特定的大疆API端点\r\n        if (window.djiApi && typeof window.djiApi.getWaylines === 'function') {\r\n          return true\r\n        }\r\n        \r\n        // 尝试简单的API调用\r\n        const response = await fetch('/api/dji/health', {\r\n          method: 'GET',\r\n          timeout: 2000\r\n        })\r\n        return response.ok\r\n      } catch (error) {\r\n        return false\r\n      }\r\n    },\r\n    \r\n    renderDjiComponent() {\r\n      try {\r\n        // 这里应该是渲染大疆原始组件的代码\r\n        // 根据实际的大疆组件API进行调整\r\n        if (this.$refs.djiContainer) {\r\n          // 模拟渲染大疆组件\r\n          this.$refs.djiContainer.innerHTML = '<div class=\"dji-placeholder\">正在加载大疆航线组件...</div>'\r\n          \r\n          // 尝试调用实际的大疆组件初始化\r\n          if (typeof window.DJI?.WaylineComponent?.init === 'function') {\r\n            window.DJI.WaylineComponent.init(this.$refs.djiContainer, {\r\n              // 配置参数\r\n              showList: true,\r\n              showMap: true\r\n            })\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('渲染大疆组件失败:', error)\r\n        this.showCustomWaylineList = true\r\n        this.$message.error('大疆组件渲染失败，已切换至自定义列表')\r\n      }\r\n    },\r\n    \r\n    verifyDjiComponent() {\r\n      try {\r\n        // 验证大疆组件是否正常工作\r\n        // 检查容器中是否有实际内容或特定的标记元素\r\n        const container = this.$refs.djiContainer\r\n        if (container && container.querySelector('.dji-placeholder')) {\r\n          // 仍然显示占位符，表示组件未正确加载\r\n          this.showCustomWaylineList = true\r\n          this.$message.warning('大疆航线组件未正常初始化，已切换至自定义列表')\r\n        }\r\n      } catch (error) {\r\n        console.error('验证大疆组件失败:', error)\r\n        this.showCustomWaylineList = true\r\n      }\r\n    },\r\n    \r\n    // 处理航线选择事件并向上传递\r\n    handleWaylineSelected(wayline) {\r\n      this.$emit('wayline-selected', wayline)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.wayline-fallback {\r\n  width: 100%;\r\n  max-width: 100%;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.dji-container {\r\n  width: 100%;\r\n  height: 300px;\r\n  min-height: 300px;\r\n  border: 1px solid #ebeef5;\r\n  border-radius: 4px;\r\n  overflow: hidden;\r\n}\r\n\r\n.dji-placeholder {\r\n  width: 100%;\r\n  height: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  color: #909399;\r\n  background-color: #f5f7fa;\r\n}\r\n</style>"],"mappings":";;EACOA,KAAK,EAAC;AAAkB;;EAWzBC,GAAG,EAAC,cAAc;EAClBD,KAAK,EAAC;;;;uBAZVE,mBAAA,CAcM,OAdNC,UAcM,GAbJC,mBAAA,wBAA2B,EAEnBC,KAAA,CAAAC,qBAAqB,I,cAD7BC,YAAA,CAIEC,sBAAA;;IAFC,qBAAmB,EAAEC,MAAA,CAAAC,iBAAiB;IACtCC,iBAAgB,EAAEC,QAAA,CAAAC;0FAIrBX,mBAAA,CAIOY,SAAA;IAAAC,GAAA;EAAA,IALPX,mBAAA,mBAAsB,EACtBY,mBAAA,CAIO,OAJPC,UAIO,8B","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}