{"ast":null,"code":"import { VideoCamera, VideoPause, Refresh, VideoPlay, FullScreen, ZoomIn, ArrowUp, Run, HelpFilled } from '@element-plus/icons-vue';\nexport default {\n  name: 'MonitorPanel',\n  components: {\n    VideoCamera,\n    VideoPause,\n    Refresh,\n    VideoPlay,\n    FullScreen,\n    ZoomIn,\n    ArrowUp,\n    Run,\n    HelpFilled\n  },\n  props: {\n    videoStreamUrl: {\n      type: String,\n      default: ''\n    },\n    isStreaming: {\n      type: Boolean,\n      default: false\n    },\n    droneStatus: {\n      type: String,\n      default: '待命'\n    },\n    batteryLevel: {\n      type: Number,\n      default: 100\n    },\n    altitude: {\n      type: Number,\n      default: 0\n    },\n    speed: {\n      type: Number,\n      default: 0\n    }\n  },\n  data() {\n    return {\n      videoErrorMessage: '',\n      isRefreshing: false,\n      isLoadingVideo: false,\n      isRecording: false,\n      isPlaying: true,\n      zoomLevel: 1,\n      startTime: null,\n      // 默认的占位图像\n      defaultImage: 'https://picsum.photos/1280/720?random=default'\n    };\n  },\n  computed: {\n    // 安全的无人机状态\n    safeDroneStatus() {\n      return typeof this.droneStatus === 'string' && this.droneStatus.trim() ? this.droneStatus : '待命';\n    },\n    // 安全的电池电量\n    safeBatteryLevel() {\n      const level = Number(this.batteryLevel);\n      return isNaN(level) ? 100 : Math.min(100, Math.max(0, level));\n    },\n    // 安全的高度\n    safeAltitude() {\n      const alt = Number(this.altitude);\n      return isNaN(alt) ? 0 : alt;\n    },\n    // 安全的速度\n    safeSpeed() {\n      const spd = Number(this.speed);\n      return isNaN(spd) ? 0 : spd;\n    },\n    // 净化后的视频URL\n    sanitizedVideoUrl() {\n      if (typeof this.videoStreamUrl === 'string' && this.videoStreamUrl.trim()) {\n        return this.videoStreamUrl;\n      }\n      return this.isStreaming ? this.defaultImage : '';\n    },\n    // 当前视频时间\n    currentVideoTime() {\n      if (!this.startTime) return '00:00:00';\n      const now = new Date();\n      const diff = Math.floor((now - this.startTime) / 1000);\n      const hours = Math.floor(diff / 3600).toString().padStart(2, '0');\n      const minutes = Math.floor(diff % 3600 / 60).toString().padStart(2, '0');\n      const seconds = (diff % 60).toString().padStart(2, '0');\n      return `${hours}:${minutes}:${seconds}`;\n    }\n  },\n  watch: {\n    isStreaming(newVal) {\n      if (newVal) {\n        this.startTime = new Date();\n      } else {\n        this.startTime = null;\n      }\n    }\n  },\n  mounted() {\n    if (this.isStreaming) {\n      this.startTime = new Date();\n    }\n  },\n  methods: {\n    // 处理刷新视频流\n    async handleRefreshStream() {\n      this.isRefreshing = true;\n      this.videoErrorMessage = '';\n      this.isLoadingVideo = true;\n      try {\n        await this.$emit('refresh-stream');\n        // 模拟加载延迟\n        await new Promise(resolve => setTimeout(resolve, 1000));\n      } catch (error) {\n        console.error('刷新视频流失败:', error);\n        this.videoErrorMessage = '刷新失败，请稍后重试';\n      } finally {\n        this.isRefreshing = false;\n        this.isLoadingVideo = false;\n      }\n    },\n    // 处理图像加载错误\n    handleImageError(event) {\n      console.error('视频流加载失败:', event);\n      this.videoErrorMessage = '视频流加载失败';\n      this.isLoadingVideo = false;\n      // 如果有错误，使用默认图像作为后备\n      event.target.src = this.defaultImage;\n    },\n    // 处理图像加载成功\n    handleImageLoad() {\n      this.isLoadingVideo = false;\n    },\n    // 获取状态对应的颜色\n    getStatusColor(status) {\n      const statusMap = {\n        '待命': 'success',\n        '飞行中': 'primary',\n        '悬停中': 'info',\n        '暂停': 'warning',\n        '已停止': 'danger',\n        '返回中': 'warning',\n        '降落中': 'warning'\n      };\n      return statusMap[status] || 'info';\n    },\n    // 获取详细的状态信息\n    getDetailedStatusMessage(status) {\n      const messageMap = {\n        '待命': '无人机处于准备起飞状态',\n        '飞行中': '无人机正在执行任务',\n        '悬停中': '无人机在当前位置悬停',\n        '暂停': '无人机任务暂停',\n        '已停止': '无人机已停止运行',\n        '返回中': '无人机正在返回起点',\n        '降落中': '无人机正在降落'\n      };\n      return messageMap[status] || '未知状态';\n    },\n    // 获取电池状态\n    getBatteryStatus(level) {\n      if (level > 70) return '';\n      if (level > 30) return 'warning';\n      return 'exception';\n    },\n    // 获取电池颜色\n    getBatteryColor(level) {\n      if (level < 20) return '#ff4d4f';\n      if (level < 50) return '#faad14';\n      return '#52c41a';\n    },\n    // 格式化数字，保留一位小数\n    formatNumber(num) {\n      return Number(num).toFixed(1);\n    },\n    // 切换播放状态\n    togglePlayback() {\n      this.isPlaying = !this.isPlaying;\n      // 这里可以添加实际的播放/暂停逻辑\n      this.$message.info(this.isPlaying ? '继续播放' : '暂停播放');\n    },\n    // 切换录制状态\n    toggleRecording() {\n      this.isRecording = !this.isRecording;\n      if (this.isRecording) {\n        this.$confirm('确定要开始录制吗？这可能会占用大量存储空间。', '确认录制', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(() => {\n          this.$message.success('开始录制');\n        }).catch(() => {\n          this.isRecording = false;\n          this.$message.info('已取消录制');\n        });\n      } else {\n        this.$message.success('停止录制');\n      }\n    },\n    // 放大视频\n    zoomIn() {\n      if (this.zoomLevel < 2) {\n        this.zoomLevel += 0.25;\n        this.$message.info(`缩放级别: ${this.zoomLevel.toFixed(2)}x`);\n      } else {\n        this.$message.warning('已达到最大缩放级别');\n      }\n    },\n    // 切换全屏\n    toggleFullScreen() {\n      const videoContainer = document.querySelector('.aspect-video');\n      if (videoContainer) {\n        if (!document.fullscreenElement) {\n          videoContainer.requestFullscreen().catch(err => {\n            console.error(`全屏模式失败: ${err.message}`);\n            this.$message.warning('切换全屏失败，请检查浏览器权限');\n          });\n        } else {\n          document.exitFullscreen();\n        }\n      }\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}