{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, resolveComponent as _resolveComponent, openBlock as _openBlock, createBlock as _createBlock, createElementVNode as _createElementVNode, Fragment as _Fragment, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"wayline-fallback\"\n};\nconst _hoisted_2 = {\n  ref: \"djiContainer\",\n  class: \"dji-container\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_WaylineList = _resolveComponent(\"WaylineList\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createCommentVNode(\" 当大疆组件不可用时显示自定义航线列表 \"), $data.showCustomWaylineList ? (_openBlock(), _createBlock(_component_WaylineList, {\n    key: 0\n  })) : (_openBlock(), _createElementBlock(_Fragment, {\n    key: 1\n  }, [_createCommentVNode(\" 用于放置大疆原始组件的容器 \"), _createElementVNode(\"div\", _hoisted_2, null, 512 /* NEED_PATCH */)], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */))]);\n}","map":{"version":3,"names":["class","ref","_createElementBlock","_hoisted_1","_createCommentVNode","$data","showCustomWaylineList","_createBlock","_component_WaylineList","key","_Fragment","_createElementVNode","_hoisted_2"],"sources":["D:\\projects\\FlightHub-2-Frontend-Standalone-Component\\frontend\\src\\components\\WaylineFallback.vue"],"sourcesContent":["<template>\n  <div class=\"wayline-fallback\">\n    <!-- 当大疆组件不可用时显示自定义航线列表 -->\n    <WaylineList v-if=\"showCustomWaylineList\" />\n    \n    <!-- 用于放置大疆原始组件的容器 -->\n    <div \n      v-else \n      ref=\"djiContainer\" \n      class=\"dji-container\"\n    ></div>\n  </div>\n</template>\n\n<script>\nimport WaylineList from './WaylineList.vue'\n\nexport default {\n  name: 'WaylineFallback',\n  components: {\n    WaylineList\n  },\n  data() {\n    return {\n      showCustomWaylineList: false,\n      djiComponentLoaded: false,\n      checkTimer: null\n    }\n  },\n  async mounted() {\n    // 尝试加载大疆组件\n    await this.tryLoadDjiComponent()\n  },\n  beforeDestroy() {\n    // 清理定时器\n    if (this.checkTimer) {\n      clearTimeout(this.checkTimer)\n    }\n  },\n  methods: {\n    async tryLoadDjiComponent() {\n      try {\n        // 检查大疆组件是否可用\n        this.djiComponentLoaded = await this.checkDjiComponentAvailability()\n        \n        if (!this.djiComponentLoaded) {\n          // 如果不可用，使用自定义组件\n          this.showCustomWaylineList = true\n          this.$message.warning('大疆航线组件加载失败，已切换至自定义航线列表')\n        } else {\n          // 尝试渲染大疆组件\n          this.renderDjiComponent()\n          \n          // 设置一个定时器再次检查，确保组件正常工作\n          this.checkTimer = setTimeout(() => {\n            this.verifyDjiComponent()\n          }, 3000)\n        }\n      } catch (error) {\n        console.error('加载大疆组件时出错:', error)\n        this.showCustomWaylineList = true\n        this.$message.warning('大疆航线组件加载失败，已切换至自定义航线列表')\n      }\n    },\n    \n    async checkDjiComponentAvailability() {\n      try {\n        // 检查全局是否存在大疆相关对象\n        if (typeof window.DJI !== 'undefined' && \n            typeof window.DJI.WaylineComponent !== 'undefined') {\n          return true\n        }\n        \n        // 检查是否有特定的大疆API端点\n        if (window.djiApi && typeof window.djiApi.getWaylines === 'function') {\n          return true\n        }\n        \n        // 尝试简单的API调用\n        const response = await fetch('/api/dji/health', {\n          method: 'GET',\n          timeout: 2000\n        })\n        return response.ok\n      } catch (error) {\n        return false\n      }\n    },\n    \n    renderDjiComponent() {\n      try {\n        // 这里应该是渲染大疆原始组件的代码\n        // 根据实际的大疆组件API进行调整\n        if (this.$refs.djiContainer) {\n          // 模拟渲染大疆组件\n          this.$refs.djiContainer.innerHTML = '<div class=\"dji-placeholder\">正在加载大疆航线组件...</div>'\n          \n          // 尝试调用实际的大疆组件初始化\n          if (typeof window.DJI?.WaylineComponent?.init === 'function') {\n            window.DJI.WaylineComponent.init(this.$refs.djiContainer, {\n              // 配置参数\n              showList: true,\n              showMap: true\n            })\n          }\n        }\n      } catch (error) {\n        console.error('渲染大疆组件失败:', error)\n        this.showCustomWaylineList = true\n        this.$message.error('大疆组件渲染失败，已切换至自定义列表')\n      }\n    },\n    \n    verifyDjiComponent() {\n      try {\n        // 验证大疆组件是否正常工作\n        // 检查容器中是否有实际内容或特定的标记元素\n        const container = this.$refs.djiContainer\n        if (container && container.querySelector('.dji-placeholder')) {\n          // 仍然显示占位符，表示组件未正确加载\n          this.showCustomWaylineList = true\n          this.$message.warning('大疆航线组件未正常初始化，已切换至自定义列表')\n        }\n      } catch (error) {\n        console.error('验证大疆组件失败:', error)\n        this.showCustomWaylineList = true\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.wayline-fallback {\n  width: 100%;\n  height: 100%;\n}\n\n.dji-container {\n  width: 100%;\n  height: 600px;\n  min-height: 600px;\n  border: 1px solid #ebeef5;\n  border-radius: 4px;\n  overflow: hidden;\n}\n\n.dji-placeholder {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #909399;\n  background-color: #f5f7fa;\n}\n</style>"],"mappings":";;EACOA,KAAK,EAAC;AAAkB;;EAOzBC,GAAG,EAAC,cAAc;EAClBD,KAAK,EAAC;;;;uBARVE,mBAAA,CAUM,OAVNC,UAUM,GATJC,mBAAA,wBAA2B,EACRC,KAAA,CAAAC,qBAAqB,I,cAAxCC,YAAA,CAA4CC,sBAAA;IAAAC,GAAA;EAAA,O,cAG5CP,mBAAA,CAIOQ,SAAA;IAAAD,GAAA;EAAA,IALPL,mBAAA,mBAAsB,EACtBO,mBAAA,CAIO,OAJPC,UAIO,8B","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}