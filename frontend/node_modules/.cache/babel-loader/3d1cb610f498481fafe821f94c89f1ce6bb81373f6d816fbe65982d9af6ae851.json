{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, resolveComponent as _resolveComponent, openBlock as _openBlock, createBlock as _createBlock, createElementVNode as _createElementVNode, Fragment as _Fragment, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"wayline-fallback-premium\"\n};\nconst _hoisted_2 = {\n  ref: \"djiContainer\",\n  class: \"dji-container-premium\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_WaylineList = _resolveComponent(\"WaylineList\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createCommentVNode(\" 当大疆组件不可用时显示自定义航线列表 \"), $data.showCustomWaylineList ? (_openBlock(), _createBlock(_component_WaylineList, {\n    key: 0,\n    \"current-selected-id\": $props.currentSelectedId,\n    onWaylineSelected: $options.handleWaylineSelected\n  }, null, 8 /* PROPS */, [\"current-selected-id\", \"onWaylineSelected\"])) : (_openBlock(), _createElementBlock(_Fragment, {\n    key: 1\n  }, [_createCommentVNode(\" 用于放置大疆原始组件的容器 \"), _createElementVNode(\"div\", _hoisted_2, null, 512 /* NEED_PATCH */)], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */))]);\n}","map":{"version":3,"names":["class","ref","_createElementBlock","_hoisted_1","_createCommentVNode","$data","showCustomWaylineList","_createBlock","_component_WaylineList","$props","currentSelectedId","onWaylineSelected","$options","handleWaylineSelected","_Fragment","key","_createElementVNode","_hoisted_2"],"sources":["D:\\projects\\FlightHub-2-Frontend-Standalone-Component\\frontend\\src\\components\\WaylineFallback.vue"],"sourcesContent":["<template>\n  <div class=\"wayline-fallback-premium\">\n    <!-- 当大疆组件不可用时显示自定义航线列表 -->\n    <WaylineList \n      v-if=\"showCustomWaylineList\" \n      :current-selected-id=\"currentSelectedId\"\n      @wayline-selected=\"handleWaylineSelected\"\n    />\n    \n    <!-- 用于放置大疆原始组件的容器 -->\n    <div \n      v-else \n      ref=\"djiContainer\" \n      class=\"dji-container-premium\"\n    ></div>\n  </div>\n</template>\n\n<script>\nimport WaylineList from './WaylineList.vue'\n\nexport default {\n  name: 'WaylineFallback',\n  components: {\n    WaylineList\n  },\n  props: {\n    currentSelectedId: {\n      type: Number,\n      default: null\n    }\n  },\n  emits: ['wayline-selected'],\n  data() {\n    return {\n      showCustomWaylineList: false,\n      djiComponentLoaded: false,\n      checkTimer: null\n    }\n  },\n  async mounted() {\n    await this.tryLoadDjiComponent()\n  },\n  beforeUnmount() {\n    if (this.checkTimer) {\n      clearTimeout(this.checkTimer)\n    }\n  },\n  methods: {\n    async tryLoadDjiComponent() {\n      try {\n        this.djiComponentLoaded = await this.checkDjiComponentAvailability()\n        \n        if (!this.djiComponentLoaded) {\n          this.showCustomWaylineList = true\n          // 仅在开发环境提示，避免打扰用户\n          if (process.env.NODE_ENV === 'development') {\n            console.warn('大疆航线组件加载失败，已切换至自定义航线列表')\n          }\n        } else {\n          this.renderDjiComponent()\n          this.checkTimer = setTimeout(() => {\n            this.verifyDjiComponent()\n          }, 3000)\n        }\n      } catch (error) {\n        console.error('加载大疆组件时出错:', error)\n        this.showCustomWaylineList = true\n      }\n    },\n    \n    async checkDjiComponentAvailability() {\n      try {\n        if (typeof window.DJI !== 'undefined' && \n            typeof window.DJI.WaylineComponent !== 'undefined') {\n          return true\n        }\n        if (window.djiApi && typeof window.djiApi.getWaylines === 'function') {\n          return true\n        }\n        return false\n      } catch (error) {\n        return false\n      }\n    },\n    \n    renderDjiComponent() {\n      try {\n        if (this.$refs.djiContainer) {\n          this.$refs.djiContainer.innerHTML = '<div class=\"dji-placeholder-premium\"><div class=\"loading-spinner\"></div><span class=\"loading-text\">正在加载大疆组件...</span></div>'\n          \n          if (typeof window.DJI?.WaylineComponent?.init === 'function') {\n            window.DJI.WaylineComponent.init(this.$refs.djiContainer, {\n              showList: true,\n              showMap: true\n            })\n          }\n        }\n      } catch (error) {\n        console.error('渲染大疆组件失败:', error)\n        this.showCustomWaylineList = true\n      }\n    },\n    \n    verifyDjiComponent() {\n      try {\n        const container = this.$refs.djiContainer\n        if (container && container.querySelector('.dji-placeholder-premium')) {\n          this.showCustomWaylineList = true\n        }\n      } catch (error) {\n        console.error('验证大疆组件失败:', error)\n        this.showCustomWaylineList = true\n      }\n    },\n    \n    handleWaylineSelected(wayline) {\n      this.$emit('wayline-selected', wayline)\n    }\n  }\n}\n</script>\n\n<style scoped>\n.wayline-fallback-premium {\n  width: 100%;\n  height: 100%;\n  min-height: 200px;\n}\n\n.dji-container-premium {\n  width: 100%;\n  height: 100%;\n  min-height: 200px;\n  border: 1px solid rgba(0, 212, 255, 0.2);\n  border-radius: 8px;\n  overflow: hidden;\n  background: rgba(15, 23, 42, 0.4);\n}\n\n:deep(.dji-placeholder-premium) {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 12px;\n  color: #94a3b8;\n  background: rgba(15, 23, 42, 0.6);\n}\n\n:deep(.loading-spinner) {\n  width: 24px;\n  height: 24px;\n  border: 2px solid rgba(0, 212, 255, 0.1);\n  border-top-color: #00d4ff;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n}\n\n:deep(.loading-text) {\n  font-size: 12px;\n  color: #00d4ff;\n}\n\n@keyframes spin {\n  to { transform: rotate(360deg); }\n}\n</style>"],"mappings":";;EACOA,KAAK,EAAC;AAA0B;;EAWjCC,GAAG,EAAC,cAAc;EAClBD,KAAK,EAAC;;;;uBAZVE,mBAAA,CAcM,OAdNC,UAcM,GAbJC,mBAAA,wBAA2B,EAEnBC,KAAA,CAAAC,qBAAqB,I,cAD7BC,YAAA,CAIEC,sBAAA;;IAFC,qBAAmB,EAAEC,MAAA,CAAAC,iBAAiB;IACtCC,iBAAgB,EAAEC,QAAA,CAAAC;0FAIrBX,mBAAA,CAIOY,SAAA;IAAAC,GAAA;EAAA,IALPX,mBAAA,mBAAsB,EACtBY,mBAAA,CAIO,OAJPC,UAIO,8B","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}