{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport { createStore } from 'vuex';\nimport droneApi from '../api/droneApi';\nexport default createStore({\n  state: {\n    // 无人机航线数据\n    droneRoutes: [],\n    selectedRoute: null,\n    // 任务数据\n    taskProgress: 0,\n    currentTask: null,\n    remainingTime: '',\n    completedTasks: 0,\n    totalTasks: 0,\n    // 报警数据\n    alarms: [],\n    // 无人机状态\n    droneStatus: '待命',\n    batteryLevel: 100,\n    currentAltitude: 0,\n    currentSpeed: 0,\n    targetAltitude: 0,\n    targetSpeed: 0,\n    // 视频流\n    videoStreamUrl: '',\n    isStreaming: false,\n    // 系统状态\n    isLoading: false,\n    error: null,\n    darkMode: true\n  },\n  mutations: {\n    // 设置航线数据\n    SET_ROUTES(state, routes) {\n      state.droneRoutes = routes;\n    },\n    SET_SELECTED_ROUTE(state, route) {\n      state.selectedRoute = route;\n    },\n    // 设置任务数据\n    SET_TASK_PROGRESS(state, progress) {\n      state.taskProgress = progress;\n    },\n    SET_CURRENT_TASK(state, task) {\n      state.currentTask = task;\n    },\n    SET_REMAINING_TIME(state, time) {\n      state.remainingTime = time;\n    },\n    SET_TASK_STATS(state, {\n      completed,\n      total\n    }) {\n      state.completedTasks = completed;\n      state.totalTasks = total;\n    },\n    // 设置报警数据\n    SET_ALARMS(state, alarms) {\n      state.alarms = alarms;\n    },\n    REMOVE_ALARM(state, alarmId) {\n      state.alarms = state.alarms.filter(alarm => alarm.id !== alarmId);\n    },\n    // 设置无人机状态\n    SET_DRONE_STATUS(state, status) {\n      state.droneStatus = status;\n    },\n    SET_BATTERY_LEVEL(state, level) {\n      state.batteryLevel = level;\n    },\n    SET_CURRENT_ALTITUDE(state, altitude) {\n      state.currentAltitude = altitude;\n    },\n    SET_CURRENT_SPEED(state, speed) {\n      state.currentSpeed = speed;\n    },\n    SET_TARGET_ALTITUDE(state, altitude) {\n      state.targetAltitude = altitude;\n    },\n    SET_TARGET_SPEED(state, speed) {\n      state.targetSpeed = speed;\n    },\n    // 设置视频流\n    SET_VIDEO_STREAM(state, url) {\n      state.videoStreamUrl = url;\n    },\n    SET_IS_STREAMING(state, isStreaming) {\n      state.isStreaming = isStreaming;\n    },\n    // 系统状态\n    SET_LOADING(state, isLoading) {\n      state.isLoading = isLoading;\n    },\n    SET_ERROR(state, error) {\n      state.error = error;\n    },\n    SET_DARK_MODE(state, isDark) {\n      state.darkMode = isDark;\n      if (isDark) {\n        document.documentElement.classList.add('dark');\n      } else {\n        document.documentElement.classList.remove('dark');\n      }\n      localStorage.setItem('darkMode', isDark);\n    }\n  },\n  actions: {\n    // 初始化系统数据\n    async initializeSystem({\n      commit\n    }) {\n      commit('SET_LOADING', true);\n      try {\n        // 获取航线数据\n        const routes = await droneApi.getRoutes();\n        commit('SET_ROUTES', routes);\n\n        // 获取任务数据\n        const taskData = await droneApi.getTaskData();\n        commit('SET_TASK_PROGRESS', taskData.progress);\n        commit('SET_CURRENT_TASK', taskData.currentTask);\n        commit('SET_REMAINING_TIME', taskData.remainingTime);\n        commit('SET_TASK_STATS', {\n          completed: taskData.completedTasks,\n          total: taskData.totalTasks\n        });\n\n        // 获取报警数据\n        const alarms = await droneApi.getAlarms();\n        commit('SET_ALARMS', alarms);\n\n        // 获取无人机状态\n        const droneStatus = await droneApi.getDroneStatus();\n        commit('SET_DRONE_STATUS', droneStatus.status);\n        commit('SET_BATTERY_LEVEL', droneStatus.batteryLevel);\n        commit('SET_CURRENT_ALTITUDE', droneStatus.altitude);\n        commit('SET_CURRENT_SPEED', droneStatus.speed);\n\n        // 设置视频流\n        commit('SET_VIDEO_STREAM', droneStatus.videoStreamUrl);\n        commit('SET_IS_STREAMING', droneStatus.isStreaming);\n      } catch (error) {\n        commit('SET_ERROR', error.message);\n        console.error('初始化系统失败:', error);\n      } finally {\n        commit('SET_LOADING', false);\n      }\n    },\n    // 选择航线\n    selectRoute({\n      commit\n    }, route) {\n      commit('SET_SELECTED_ROUTE', route);\n    },\n    // 处理报警\n    processAlarm({\n      commit\n    }, alarmId) {\n      commit('REMOVE_ALARM', alarmId);\n      // 这里可以调用API将报警标记为已处理\n      droneApi.processAlarm(alarmId);\n    },\n    // 无人机控制\n    controlDrone({\n      commit\n    }, action) {\n      commit('SET_DRONE_STATUS', {\n        'start': '飞行中',\n        'stop': '待命',\n        'pause': '暂停',\n        'return': '返回中'\n      }[action]);\n\n      // 调用API执行控制动作\n      droneApi.controlDrone(action);\n    },\n    // 更新目标高度\n    updateTargetAltitude({\n      commit\n    }, altitude) {\n      commit('SET_TARGET_ALTITUDE', altitude);\n      // 调用API更新高度\n      droneApi.updateAltitude(altitude);\n    },\n    // 更新目标速度\n    updateTargetSpeed({\n      commit\n    }, speed) {\n      commit('SET_TARGET_SPEED', speed);\n      // 调用API更新速度\n      droneApi.updateSpeed(speed);\n    },\n    // 紧急停止\n    emergencyStop({\n      commit\n    }) {\n      commit('SET_DRONE_STATUS', '已停止');\n      commit('SET_CURRENT_SPEED', 0);\n      // 调用API执行紧急停止\n      droneApi.emergencyStop();\n    },\n    // 切换暗黑模式\n    toggleDarkMode({\n      commit,\n      state\n    }) {\n      commit('SET_DARK_MODE', !state.darkMode);\n    },\n    // 刷新视频流\n    refreshStream({\n      commit\n    }) {\n      const timestamp = Date.now();\n      commit('SET_VIDEO_STREAM', `https://picsum.photos/1280/720?random=${timestamp}`);\n    }\n  },\n  getters: {\n    // 获取进行中的任务\n    activeTasks: state => {\n      return state.droneRoutes.filter(route => route.status === 'in_progress');\n    },\n    // 获取高优先级报警\n    highPriorityAlarms: state => {\n      return state.alarms.filter(alarm => alarm.severity === '高');\n    },\n    // 获取电池状态类名\n    batteryStatusClass: state => {\n      if (state.batteryLevel > 70) return 'bg-green-500';\n      if (state.batteryLevel > 30) return 'bg-yellow-500';\n      return 'bg-red-500';\n    }\n  }\n});","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}