{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport { DjiWaylineCreation } from '../djispace-components';\nimport TaskProgressBar from '../components/TaskProgressBar.vue';\nimport AlarmPanel from '../components/AlarmPanel.vue';\nimport WaylineFallback from '../components/WaylineFallback.vue';\nimport alarmApi from '../api/alarmApi.js';\nexport default {\n  name: 'DjiDashboard',\n  components: {\n    DjiWaylineCreation,\n    TaskProgressBar,\n    AlarmPanel,\n    WaylineFallback\n  },\n  data() {\n    return {\n      showWaylineCreation: false,\n      taskProgress: 65,\n      currentTask: '变电站设备检查',\n      remainingTime: '12:45',\n      completedTasks: 8,\n      totalTasks: 12,\n      // Cesium相关数据\n      viewer: null,\n      tileset: null,\n      loading: false,\n      error: '',\n      wireframe: false,\n      resizeObserver: null,\n      debouncedForceResize: null,\n      // 大疆组件加载状态\n      fh2Loaded: false,\n      // 全局变量：当前选中的航线\n      selectedWayline: null,\n      // 告警信息\n      alarms: [],\n      // 告警加载状态\n      loadingAlarms: false,\n      // 告警详情弹窗\n      showAlarmDetail: false,\n      currentAlarm: null,\n      // 配置信息需要根据实际环境进行修改\n      djiConfig: {\n        serverUrl: 'http://your-dji-server-ip-or-domain:30812',\n        wssUrl: 'ws://your-dji-server-ip-or-domain:30812/duplex/web',\n        hostUrl: 'http://your-dji-server-ip-or-domain',\n        // 复制 prjId 到这里\n        prjId: 'cdca2736-8096-4729-9bc7-497ad5b60d5e',\n        // 复制 projectToken 到这里\n        projectToken: 'your-project-token-here'\n      },\n      // 模拟报警数据，添加航线ID关联\n      mockAlarms: [{\n        id: 1,\n        title: '电力线异常发热',\n        description: '在坐标(23.124, 113.235)处检测到电力线温度异常升高，可能存在线路老化或过载情况。',\n        timestamp: '2024-01-15T14:22:35',\n        location: '变电站A区域-东线路',\n        type: '温度异常',\n        severity: '高',\n        imageUrl: 'https://picsum.photos/800/600?random=1',\n        waylineId: 1\n      }, {\n        id: 2,\n        title: '绝缘子损伤',\n        description: '在铁塔#128处发现绝缘子表面有明显裂纹，需要进一步检查。',\n        timestamp: '2024-01-15T13:45:12',\n        location: '铁塔#128',\n        type: '设备损伤',\n        severity: '中',\n        imageUrl: 'https://picsum.photos/800/600?random=2',\n        waylineId: 1\n      }, {\n        id: 3,\n        title: '无人机信号弱',\n        description: '在航线中段区域信号强度明显减弱，建议调整飞行高度。',\n        timestamp: '2024-01-15T12:30:45',\n        location: '桥梁中部区域',\n        type: '信号异常',\n        severity: '低',\n        imageUrl: 'https://picsum.photos/800/600?random=3',\n        waylineId: 2\n      }, {\n        id: 4,\n        title: '电池电量警告',\n        description: '无人机电池电量低于30%，建议尽快返航。',\n        timestamp: '2024-01-15T11:15:20',\n        location: '河道巡查区段',\n        type: '电量警告',\n        severity: '中',\n        imageUrl: 'https://picsum.photos/800/600?random=4',\n        waylineId: 3\n      }]\n    };\n  },\n  async mounted() {\n    // 检查FH2是否已加载\n    this.checkFh2Availability();\n\n    // 等待DOM更新完成后再初始化Cesium\n    this.$nextTick(async () => {\n      // 等待一小段时间确保DOM完全渲染\n      setTimeout(async () => {\n        // 等待Cesium资源加载完成后再初始化\n        await this.initCesium();\n\n        // 初始化 ResizeObserver\n        this.initResizeObserver();\n\n        // 自动加载默认模型\n        await this.loadModel();\n      }, 200);\n    });\n  },\n  beforeUnmount() {\n    if (this.viewer) {\n      this.viewer.destroy();\n    }\n    // 清理 ResizeObserver\n    if (this.resizeObserver) {\n      this.resizeObserver.disconnect();\n    }\n    // 移除窗口大小调整事件监听\n    window.removeEventListener('resize', this.handleWindowResize);\n    // 清理防抖函数的定时器\n    if (this.debouncedForceResize && this.debouncedForceResize.timeout) {\n      clearTimeout(this.debouncedForceResize.timeout);\n    }\n  },\n  methods: {\n    // 检查FH2是否可用\n    checkFh2Availability() {\n      // 检查全局是否存在FH2对象\n      if (typeof window.FH2 !== 'undefined') {\n        this.fh2Loaded = true;\n        console.log('FH2已成功加载');\n      } else {\n        this.fh2Loaded = false;\n        console.warn('FH2未正确加载，将使用备用组件');\n\n        // 设置一个定时器，再次检查FH2是否加载完成\n        setTimeout(() => {\n          this.checkFh2Availability();\n        }, 1000);\n      }\n    },\n    openWaylineCreation() {\n      if (!this.fh2Loaded) {\n        this.$message.warning('大疆组件未正确加载，无法创建航线');\n        return;\n      }\n      this.showWaylineCreation = true;\n    },\n    handleAlarmRefresh() {\n      console.log('刷新报警信息');\n      // 如果有选中的航线，刷新告警信息\n      if (this.selectedWayline) {\n        this.fetchAlarmsByWayline(this.selectedWayline.id);\n      }\n    },\n    handleViewAlarmDetail(alarm) {\n      console.log('查看报警详情:', alarm);\n      this.currentAlarm = alarm;\n      this.showAlarmDetail = true;\n    },\n    handleProcessAlarm(alarmId) {\n      console.log('处理报警:', alarmId);\n      // 从alarms数组中移除已处理的报警\n      this.alarms = this.alarms.filter(alarm => alarm.id !== alarmId);\n\n      // 调用API更新告警状态\n      this.updateAlarmStatus(alarmId);\n    },\n    // 更新告警状态\n    async updateAlarmStatus(alarmId) {\n      try {\n        // 根据后端模型，正确的完成状态是'COMPLETED'\n        await alarmApi.patchAlarm(alarmId, {\n          status: 'COMPLETED'\n        });\n        console.log('告警状态更新成功');\n      } catch (error) {\n        console.error('更新告警状态失败:', error);\n        // 不影响前端显示，仅记录错误\n      }\n    },\n    // 处理航线选择事件\n    handleWaylineSelected(wayline) {\n      console.log('选中航线:', wayline);\n      this.selectedWayline = wayline;\n      // 当选择航线时，获取该航线的告警信息\n      this.fetchAlarmsByWayline(wayline.id);\n    },\n    // 根据航线ID获取告警信息\n    async fetchAlarmsByWayline(waylineId) {\n      if (!waylineId) {\n        this.alarms = [];\n        return;\n      }\n      this.loadingAlarms = true;\n      try {\n        // 调用API获取告警信息，使用wayline_id参数过滤\n        const response = await alarmApi.getAlarms({\n          wayline_id: waylineId\n        });\n        // 转换API返回的数据格式以适配AlarmPanel组件\n        this.alarms = this.transformAlarmData(response);\n      } catch (error) {\n        console.error('获取告警信息失败:', error);\n        this.$message.error('获取告警信息失败，请稍后重试');\n        // 出错时使用空数组，避免显示错误数据\n        this.alarms = [];\n      } finally {\n        this.loadingAlarms = false;\n      }\n    },\n    // 转换API返回的告警数据格式\n    transformAlarmData(alarmData) {\n      // 确保alarmData是数组\n      const alarms = Array.isArray(alarmData) ? alarmData : alarmData.results || [];\n\n      // 直接返回后端API的数据，不再转换为旧格式\n      // 保留原始字段结构，确保与AlarmPanel组件兼容\n      return alarms;\n    },\n    // 获取告警严重级别\n    getSeverityLevel(level) {\n      switch (level) {\n        case 3:\n        case 'high':\n        case '高':\n          return '高';\n        case 2:\n        case 'medium':\n        case '中':\n          return '中';\n        case 1:\n        case 'low':\n        case '低':\n          return '低';\n        default:\n          return '低';\n      }\n    },\n    // 获取当前选中航线的告警信息\n    getFilteredAlarms() {\n      // 直接返回从API获取的告警信息，因为我们已经根据航线ID过滤过了\n      return this.alarms;\n    },\n    async initCesium() {\n      try {\n        // 动态导入Cesium\n        const Cesium = await import('cesium');\n\n        // 设置Cesium的access token为空（因为我们使用的是本地资源）\n        Cesium.Ion.defaultAccessToken = '';\n\n        // 使用引用获取包装器元素\n        const wrapper = this.$refs.cesiumWrapper;\n        if (!wrapper) {\n          throw new Error('找不到 cesiumWrapper 元素');\n        }\n\n        // 移除已存在的Cesium容器（如果有）\n        const existingContainer = document.getElementById('cesiumContainer');\n        if (existingContainer) {\n          existingContainer.remove();\n        }\n\n        // 使用原生DOM操作创建容器，避免Vue响应式影响\n        const container = document.createElement('div');\n        container.id = 'cesiumContainer';\n\n        // 重要：在添加到DOM前先设置好样式\n        container.style.width = '100%';\n        container.style.height = '100%';\n        container.style.position = 'relative';\n        container.style.margin = '0';\n        container.style.padding = '0';\n        container.style.overflow = 'hidden';\n        container.style.zIndex = '1';\n\n        // 先将容器添加到DOM中\n        wrapper.appendChild(container);\n\n        // 等待并确保容器有正确的尺寸\n        let attempts = 0;\n        const maxAttempts = 20;\n        let width, height;\n        do {\n          width = wrapper.offsetWidth;\n          height = wrapper.offsetHeight;\n          if (width <= 0 || height <= 0) {\n            await new Promise(resolve => setTimeout(resolve, 50));\n            attempts++;\n          } else {\n            break;\n          }\n        } while (attempts < maxAttempts);\n        if (width <= 0 || height <= 0) {\n          throw new Error(`无效的容器尺寸: ${width}x${height}`);\n        }\n        console.log('初始化Cesium容器尺寸:', width, 'x', height);\n\n        // 初始化Cesium Viewer - 添加一些关键配置以确保正确的大小调整\n        this.viewer = new Cesium.Viewer(container, {\n          animation: false,\n          baseLayerPicker: false,\n          fullscreenButton: false,\n          vrButton: false,\n          geocoder: false,\n          homeButton: false,\n          infoBox: false,\n          sceneModePicker: false,\n          selectionIndicator: false,\n          timeline: false,\n          navigationHelpButton: false,\n          navigationInstructionsInitiallyVisible: false,\n          scene3DOnly: true,\n          shadows: true,\n          shouldAnimate: true,\n          creditContainer: document.createElement('div'),\n          // 关键配置：避免Cesium自动添加resize监听器，由我们自己控制\n          automaticallyTrackDataSourceClocks: false,\n          // 提高渲染性能\n          orderIndependentTranslucency: true,\n          // 确保canvas元素可以正确调整大小\n          contextOptions: {\n            alpha: true,\n            stencil: true\n          }\n        });\n\n        // 确保canvas元素的尺寸正确设置\n        if (this.viewer && this.viewer.canvas) {\n          this.viewer.canvas.style.width = '100%';\n          this.viewer.canvas.style.height = '100%';\n        }\n\n        // 设置初始视角\n        this.viewer.camera.setView({\n          destination: Cesium.Cartesian3.fromDegrees(116.3913, 39.9075, 1000),\n          orientation: {\n            heading: Cesium.Math.toRadians(0),\n            pitch: Cesium.Math.toRadians(-30),\n            roll: 0.0\n          }\n        });\n      } catch (err) {\n        this.error = '初始化Cesium失败: ' + err.message;\n        console.error('Cesium initialization error:', err);\n      }\n    },\n    // 防抖函数\n    debounce(func, wait) {\n      let timeout;\n      return function executedFunction(...args) {\n        const later = () => {\n          clearTimeout(timeout);\n          func(...args);\n        };\n        clearTimeout(timeout);\n        timeout = setTimeout(later, wait);\n      };\n    },\n    initResizeObserver() {\n      const wrapper = this.$refs.cesiumWrapper;\n      if (!wrapper) return;\n\n      // 移除任何现有的ResizeObserver，防止多个实例\n      if (this.resizeObserver) {\n        this.resizeObserver.disconnect();\n      }\n\n      // 创建更宽松的防抖函数\n      this.debouncedForceResize = this.debounce(() => {\n        if (this.viewer) {\n          console.log('防抖后调用forceResize');\n          this.forceResize();\n        }\n      }, 100); // 增加到100ms，给DOM更多时间稳定\n\n      // 创建 ResizeObserver 实例，但避免在回调中立即修改DOM\n      this.resizeObserver = new ResizeObserver(entries => {\n        // 记录尺寸变化，但不直接在回调中修改\n        if (entries.length > 0) {\n          const entry = entries[0];\n          const width = entry.contentRect.width;\n          const height = entry.contentRect.height;\n          console.log(`ResizeObserver检测到尺寸变化: ${width}x${height}`);\n        }\n        // 使用防抖函数延迟处理\n        this.debouncedForceResize();\n      });\n\n      // 只观察包装器元素\n      this.resizeObserver.observe(wrapper, {\n        box: 'content-box' // 观察内容盒大小\n      });\n\n      // 添加窗口调整大小事件监听\n      window.addEventListener('resize', this.handleWindowResize);\n\n      // 初始时立即调用一次调整大小\n      setTimeout(() => {\n        this.forceResize();\n      }, 100);\n    },\n    handleWindowResize() {\n      if (this.viewer) {\n        // 利用已定义的防抖函数\n        this.debouncedForceResize();\n      }\n    },\n    // 获取状态文本\n    getStatusText(status) {\n      const statusMap = {\n        'PENDING': '待处理',\n        'PROCESSING': '处理中',\n        'COMPLETED': '已完成',\n        'IGNORED': '已忽略'\n      };\n      return statusMap[status] || status;\n    },\n    // 强制调整Cesium容器大小\n    forceResize() {\n      try {\n        console.log('开始强制调整大小...');\n        const wrapper = this.$refs.cesiumWrapper;\n        const container = document.getElementById('cesiumContainer');\n        if (!wrapper || !container || !this.viewer) {\n          console.warn('无法调整大小：缺少必要元素');\n          return;\n        }\n\n        // 强制重新计算布局\n        void wrapper.offsetHeight;\n\n        // 获取包装器的实际尺寸\n        const width = wrapper.offsetWidth;\n        const height = wrapper.offsetHeight;\n\n        // 避免无效尺寸\n        if (width <= 0 || height <= 0) {\n          console.warn('无效的容器尺寸，跳过调整:', width, 'x', height);\n          return;\n        }\n        console.log('获取到的包装器尺寸:', width, 'x', height);\n\n        // 更新错误信息\n        this.error = '';\n\n        // 关键修改：使用百分比而非像素值，让CSS自动处理\n        container.style.width = '100%';\n        container.style.height = '100%';\n\n        // 确保canvas元素也使用百分比\n        if (this.viewer && this.viewer.canvas) {\n          this.viewer.canvas.style.width = '100%';\n          this.viewer.canvas.style.height = '100%';\n          console.log('设置canvas样式为100%宽高');\n        }\n\n        // 直接强制重新创建视图，使用try-catch防止resize方法不存在的错误\n        if (this.viewer) {\n          console.log('尝试调整视图大小');\n          try {\n            // 安全调用resize方法\n            if (this.viewer.scene && typeof this.viewer.scene.resize === 'function') {\n              this.viewer.scene.resize();\n            }\n            if (typeof this.viewer.resize === 'function') {\n              this.viewer.resize();\n            }\n          } catch (resizeError) {\n            console.warn('调整视图大小方法调用失败，但不影响功能:', resizeError);\n          }\n\n          // 强制重排和重绘\n          void container.offsetHeight;\n        }\n      } catch (error) {\n        console.error('调整大小失败:', error);\n      }\n    },\n    async loadModel() {\n      if (!this.viewer) return;\n      this.loading = true;\n      this.error = '';\n      try {\n        // 动态导入Cesium\n        const Cesium = await import('cesium');\n\n        // 如果已有模型，先移除\n        if (this.tileset) {\n          this.viewer.scene.primitives.remove(this.tileset);\n          this.tileset = null;\n        }\n\n        // 加载3D Tiles数据集\n        this.tileset = await Cesium.Cesium3DTileset.fromUrl('/models/Model_0/tileset.json');\n        this.viewer.scene.primitives.add(this.tileset);\n\n        // 缩放到模型\n        if (this.tileset.readyPromise) {\n          this.tileset.readyPromise.then(() => {\n            this.flyToModel();\n          }).catch(error => {\n            this.error = '模型加载失败: ' + error.message;\n            console.error('Tileset loading error:', error);\n          }).finally(() => {\n            this.loading = false;\n          });\n        } else {\n          // 如果没有readyPromise，直接设置状态\n          this.flyToModel();\n          this.loading = false;\n        }\n      } catch (err) {\n        this.error = '模型加载失败: ' + err.message;\n        this.loading = false;\n        console.error('Model loading error:', err);\n      }\n    },\n    flyToModel() {\n      if (this.viewer && this.tileset) {\n        this.viewer.flyTo(this.tileset);\n      }\n    },\n    async resetView() {\n      if (this.viewer) {\n        // 重置到初始视角\n        const Cesium = await import('cesium');\n        this.viewer.camera.setView({\n          destination: Cesium.Cartesian3.fromDegrees(116.3913, 39.9075, 1000),\n          orientation: {\n            heading: Cesium.Math.toRadians(0),\n            pitch: Cesium.Math.toRadians(-30),\n            roll: 0.0\n          }\n        });\n      }\n    },\n    toggleWireframe() {\n      if (!this.tileset) return;\n      this.wireframe = !this.wireframe;\n      this.tileset.debugWireframe = this.wireframe;\n    }\n  }\n};","map":{"version":3,"names":["DjiWaylineCreation","TaskProgressBar","AlarmPanel","WaylineFallback","alarmApi","name","components","data","showWaylineCreation","taskProgress","currentTask","remainingTime","completedTasks","totalTasks","viewer","tileset","loading","error","wireframe","resizeObserver","debouncedForceResize","fh2Loaded","selectedWayline","alarms","loadingAlarms","showAlarmDetail","currentAlarm","djiConfig","serverUrl","wssUrl","hostUrl","prjId","projectToken","mockAlarms","id","title","description","timestamp","location","type","severity","imageUrl","waylineId","mounted","checkFh2Availability","$nextTick","setTimeout","initCesium","initResizeObserver","loadModel","beforeUnmount","destroy","disconnect","window","removeEventListener","handleWindowResize","timeout","clearTimeout","methods","FH2","console","log","warn","openWaylineCreation","$message","warning","handleAlarmRefresh","fetchAlarmsByWayline","handleViewAlarmDetail","alarm","handleProcessAlarm","alarmId","filter","updateAlarmStatus","patchAlarm","status","handleWaylineSelected","wayline","response","getAlarms","wayline_id","transformAlarmData","alarmData","Array","isArray","results","getSeverityLevel","level","getFilteredAlarms","Cesium","Ion","defaultAccessToken","wrapper","$refs","cesiumWrapper","Error","existingContainer","document","getElementById","remove","container","createElement","style","width","height","position","margin","padding","overflow","zIndex","appendChild","attempts","maxAttempts","offsetWidth","offsetHeight","Promise","resolve","Viewer","animation","baseLayerPicker","fullscreenButton","vrButton","geocoder","homeButton","infoBox","sceneModePicker","selectionIndicator","timeline","navigationHelpButton","navigationInstructionsInitiallyVisible","scene3DOnly","shadows","shouldAnimate","creditContainer","automaticallyTrackDataSourceClocks","orderIndependentTranslucency","contextOptions","alpha","stencil","canvas","camera","setView","destination","Cartesian3","fromDegrees","orientation","heading","Math","toRadians","pitch","roll","err","message","debounce","func","wait","executedFunction","args","later","forceResize","ResizeObserver","entries","length","entry","contentRect","observe","box","addEventListener","getStatusText","statusMap","scene","resize","resizeError","primitives","Cesium3DTileset","fromUrl","add","readyPromise","then","flyToModel","catch","finally","flyTo","resetView","toggleWireframe","debugWireframe"],"sources":["D:\\projects\\FlightHub-2-Frontend-Standalone-Component\\frontend\\src\\views\\DjiDashboard.vue"],"sourcesContent":["<template>\r\n  <div class=\"dji-dashboard h-screen flex flex-col grid-bg\">\r\n    <!-- 顶部导航 -->\r\n    <div class=\"header bg-gray-900 border-b border-gray-800 flex items-center justify-between px-4 h-16 flex-shrink-0 glass-effect\">\r\n      <div class=\"flex items-center\">\r\n        <h1 class=\"text-xl font-bold text-blue-400\">无人机巡检主控台</h1>\r\n      </div>\r\n      <div class=\"flex items-center gap-2\">\r\n        <el-button @click=\"resetView\" class=\"tech-button\">重置视角</el-button>\r\n        <el-button @click=\"toggleWireframe\" class=\"tech-button\">{{ wireframe ? '实体模式' : '线框模式' }}</el-button>\r\n      </div>\r\n    </div>\r\n    \r\n    <!-- 主内容区 -->\r\n    <div class=\"main-content flex flex-1 overflow-hidden\">\r\n      <!-- 左侧控制面板 -->\r\n      <div class=\"left-panel w-60 bg-gray-900 border-r border-gray-800 p-4 overflow-y-auto flex-shrink-0 tech-border\">\r\n        <!-- 航线管理 -->\r\n        <div class=\"panel-section mb-6\">\r\n          <h3 class=\"text-base font-medium mb-3 text-blue-400\">航线管理</h3>\r\n          <div class=\"space-y-2\">\r\n            <!-- <el-button type=\"primary\" @click=\"openWaylineCreation\" class=\"w-full\" :disabled=\"!fh2Loaded\">新增航线</el-button> -->\r\n            \r\n            <!-- 当FH2未加载时，显示我们的备用航线列表组件 -->\r\n            <WaylineFallback \r\n              v-if=\"!fh2Loaded\" \r\n              class=\"mt-4\" \r\n              :current-selected-id=\"selectedWayline?.id\"\r\n              @wayline-selected=\"handleWaylineSelected\"\r\n            />\r\n            \r\n            <div v-else class=\"text-sm text-gray-400\">\r\n              <p>航线列表将在这里显示（由大疆组件提供）</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- 3D模型视图区域 -->\r\n        <div class=\"model-view flex-1 flex flex-col tech-border\">\r\n        <!-- 任务进度条 -->\r\n          <div class=\"progress-container bg-gray-900 border-b border-gray-800 p-4 glass-effect\">\r\n            <h3 class=\"text-base font-medium mb-2 text-blue-400\">任务进度</h3>\r\n          <TaskProgressBar \r\n            :progress=\"taskProgress\"\r\n            :current-task=\"currentTask\"\r\n            :remaining-time=\"remainingTime\"\r\n            :completed-tasks=\"completedTasks\"\r\n            :total-tasks=\"totalTasks\"\r\n          />\r\n        </div>\r\n        \r\n        <!-- Cesium容器 -->\r\n          <div ref=\"cesiumWrapper\" class=\"cesium-wrapper flex-1 relative\">\r\n            <!-- 加载指示器 -->\r\n            <div v-if=\"loading\" class=\"absolute inset-0 flex items-center justify-center bg-black bg-opacity-70 z-10 glass-effect\">\r\n              <div class=\"flex flex-col items-center\">\r\n                <div class=\"w-12 h-12 border-4 border-blue-400 border-t-transparent rounded-full animate-spin mb-2 glow-blue\"></div>\r\n                <span class=\"text-blue-300\">正在加载模型...</span>\r\n              </div>\r\n            </div>\r\n            \r\n            <!-- 错误信息 -->\r\n            <div v-if=\"error\" class=\"absolute inset-0 flex items-center justify-center bg-black bg-opacity-70 z-10 glass-effect\">\r\n              <el-alert\r\n                :title=\"error\"\r\n                type=\"error\"\r\n                show-icon\r\n                class=\"w-96 tech-border\"\r\n              />\r\n            </div>\r\n            \r\n            <!-- 显示FH2加载状态提示\r\n            <div v-if=\"!fh2Loaded && !loading && !error\" class=\"absolute top-4 right-4 z-10\">\r\n              <el-alert\r\n                title=\"大疆组件未正确加载，使用备用功能\"\r\n                type=\"warning\"\r\n                show-icon\r\n                :closable=\"false\"\r\n                class=\"max-w-xs tech-border\"\r\n              />\r\n            </div> -->\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- 右侧控制面板 -->\r\n        <div class=\"right-panel w-60 bg-gray-900 border-l border-gray-800 p-4 overflow-y-auto flex-shrink-0 tech-border\">\r\n        <!-- 报警信息 -->\r\n          <div class=\"panel-section mb-6\">\r\n            <h3 class=\"text-base font-medium mb-3 text-blue-400\">报警信息</h3>\r\n          <div class=\"mb-2 text-sm\">\r\n              <span v-if=\"selectedWayline\" class=\"text-blue-300\">\r\n                当前航线: {{ selectedWayline.name }}\r\n              </span>\r\n              <span v-else class=\"text-gray-400\">\r\n                未选择航线\r\n              </span>\r\n            </div>\r\n          <div v-if=\"loadingAlarms\" class=\"loading-container h-64 flex items-center justify-center tech-border\">\r\n              <el-spinner type=\"primary\" />\r\n            </div>\r\n          <AlarmPanel \r\n            v-else\r\n            :alarms=\"getFilteredAlarms()\"\r\n            @refresh=\"handleAlarmRefresh\"\r\n            @view-detail=\"handleViewAlarmDetail\"\r\n            @process-alarm=\"handleProcessAlarm\"\r\n            class=\"h-64\"\r\n          />\r\n        </div>\r\n        \r\n        <!-- 实时监控 -->\r\n          <div class=\"panel-section mb-6\">\r\n            <h3 class=\"text-base font-medium mb-3 text-blue-400\">实时监控</h3>\r\n            <div class=\"h-32 flex items-center justify-center tech-border\">\r\n              <p class=\"text-gray-400 text-sm\">实时监控将在这里显示（由大疆组件提供）</p>\r\n            </div>\r\n          </div>\r\n          \r\n          <!-- 无人机控制 -->\r\n          <div class=\"panel-section mb-6\">\r\n            <h3 class=\"text-base font-medium mb-3 text-blue-400\">无人机控制</h3>\r\n            <div class=\"h-32 flex items-center justify-center tech-border\">\r\n              <p class=\"text-gray-400 text-sm\">控制面板将在这里显示（由大疆组件提供）</p>\r\n            </div>\r\n          </div>\r\n      </div>\r\n    </div>\r\n    \r\n    <!-- 航线创建对话框 -->\r\n    <el-dialog\r\n      v-model=\"showWaylineCreation\"\r\n      title=\"创建航线\"\r\n      width=\"90%\"\r\n      height=\"90%\"\r\n      destroy-on-close\r\n      class=\"tech-border\"\r\n    >\r\n      <div style=\"height: 70vh\">\r\n        <DjiWaylineCreation \r\n          v-if=\"showWaylineCreation\"\r\n          ref=\"waylineCreationComponent\"\r\n          :config=\"djiConfig\"\r\n        />\r\n      </div>\r\n    </el-dialog>\r\n    \r\n    <!-- 告警详情弹窗 -->\r\n    <el-dialog\r\n      v-model=\"showAlarmDetail\"\r\n      title=\"告警详情\"\r\n      width=\"800px\"\r\n      :close-on-click-modal=\"false\"\r\n      class=\"tech-dialog glass-effect\"\r\n    >\r\n      <div v-if=\"currentAlarm\" class=\"alarm-detail-container\">\r\n        <div class=\"detail-row\">\r\n          <div class=\"detail-label\">告警ID：</div>\r\n          <div class=\"detail-value\">{{ currentAlarm.id }}</div>\r\n        </div>\r\n        \r\n        <div class=\"detail-row\">\r\n          <div class=\"detail-label\">告警类型：</div>\r\n          <div class=\"detail-value\">{{ currentAlarm.category_details?.name || '未分类' }}</div>\r\n        </div>\r\n        \r\n        <div class=\"detail-row\">\r\n          <div class=\"detail-label\">告警状态：</div>\r\n          <div class=\"detail-value\">\r\n            <el-tag :type=\"currentAlarm.status === 'PENDING' || currentAlarm.status === 'PROCESSING' ? 'warning' : currentAlarm.status === 'COMPLETED' ? 'success' : 'info'\">\r\n              {{ getStatusText(currentAlarm.status) }}\r\n            </el-tag>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"detail-row\">\r\n          <div class=\"detail-label\">告警时间：</div>\r\n          <div class=\"detail-value\">{{ currentAlarm.created_at ? new Date(currentAlarm.created_at).toLocaleString('zh-CN') : '--' }}</div>\r\n        </div>\r\n        \r\n        <div class=\"detail-row\">\r\n          <div class=\"detail-label\">告警位置：</div>\r\n          <div class=\"detail-value\">坐标({{ currentAlarm.latitude || '--' }}, {{ currentAlarm.longitude || '--' }})</div>\r\n        </div>\r\n        \r\n        <div class=\"detail-row\">\r\n          <div class=\"detail-label\">航线信息：</div>\r\n          <div class=\"detail-value\">{{ currentAlarm.wayline?.name || currentAlarm.wayline_details?.name || '未知航线' }}</div>\r\n        </div>\r\n        \r\n        <div class=\"detail-row\">\r\n          <div class=\"detail-label\">告警描述：</div>\r\n          <div class=\"detail-value full-width\">{{ currentAlarm.content || '--' }}</div>\r\n        </div>\r\n        \r\n        <div v-if=\"currentAlarm.specific_data\" class=\"detail-row\">\r\n          <div class=\"detail-label\">特定详情：</div>\r\n          <div class=\"detail-value full-width\">{{ JSON.stringify(currentAlarm.specific_data, null, 2) }}</div>\r\n        </div>\r\n        \r\n        <div v-if=\"currentAlarm.image_url\" class=\"detail-row\">\r\n          <div class=\"detail-label\">告警图片：</div>\r\n          <div class=\"detail-value full-width\">\r\n            <el-image\r\n              :src=\"currentAlarm.image_url\"\r\n              :preview-src-list=\"[currentAlarm.image_url]\"\r\n              fit=\"contain\"\r\n              style=\"max-width: 100%; max-height: 400px; cursor: zoom-in\"\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button class=\"tech-button\" @click=\"showAlarmDetail = false\">关闭</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n.alarm-detail-container {\r\n  padding: 10px 0;\r\n}\r\n\r\n.detail-row {\r\n  margin-bottom: 20px;\r\n  display: flex;\r\n  align-items: flex-start;\r\n  border-bottom: 1px solid rgba(75, 85, 99, 0.3);\r\n  padding-bottom: 10px;\r\n}\r\n\r\n.detail-row:last-child {\r\n  border-bottom: none;\r\n}\r\n\r\n.detail-label {\r\n  width: 100px;\r\n  font-weight: bold;\r\n  color: #93c5fd;\r\n  margin-right: 10px;\r\n  flex-shrink: 0;\r\n}\r\n\r\n.detail-value {\r\n  flex: 1;\r\n  color: #d1d5db;\r\n  font-family: 'JetBrains Mono', monospace;\r\n}\r\n\r\n.full-width {\r\n  word-break: break-all;\r\n  line-height: 1.8;\r\n  background: rgba(31, 41, 55, 0.5);\r\n  padding: 8px;\r\n  border-radius: 4px;\r\n  border-left: 3px solid #3b82f6;\r\n}\r\n  /* 科技风格对话框 */\r\n  .tech-dialog {\r\n    background-color: #1f2937;\r\n    border: 1px solid #374151;\r\n    border-radius: 8px;\r\n    box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);\r\n  }\r\n\r\n  .tech-dialog :deep(.el-dialog__header) {\r\n    background-color: #111827;\r\n    border-bottom: 1px solid #374151;\r\n  }\r\n\r\n  .tech-dialog :deep(.el-dialog__title) {\r\n    color: #3b82f6;\r\n    font-weight: 600;\r\n  }\r\n\r\n  .tech-dialog :deep(.el-dialog__body) {\r\n    background-color: #1f2937;\r\n    color: #d1d5db;\r\n  }\r\n\r\n  .tech-dialog :deep(.el-dialog__footer) {\r\n    background-color: #111827;\r\n    border-top: 1px solid #374151;\r\n  }\r\n\r\n  /* 科技风格按钮 */\r\n  .tech-button {\r\n    background-color: #1f2937;\r\n    border: 1px solid #374151;\r\n    color: #d1d5db;\r\n    transition: all 0.3s ease;\r\n  }\r\n\r\n  .tech-button:hover {\r\n    background-color: #374151;\r\n    border-color: #3b82f6;\r\n    box-shadow: 0 0 10px rgba(59, 130, 246, 0.3);\r\n  }\r\n</style>\r\n\r\n<script>\r\nimport { DjiWaylineCreation } from '../djispace-components'\r\nimport TaskProgressBar from '../components/TaskProgressBar.vue'\r\nimport AlarmPanel from '../components/AlarmPanel.vue'\r\nimport WaylineFallback from '../components/WaylineFallback.vue'\r\nimport alarmApi from '../api/alarmApi.js'\r\n\r\nexport default {\r\n  name: 'DjiDashboard',\r\n  components: {\r\n    DjiWaylineCreation,\r\n    TaskProgressBar,\r\n    AlarmPanel,\r\n    WaylineFallback\r\n  },\r\n  data() {\r\n    return {\r\n      showWaylineCreation: false,\r\n      taskProgress: 65,\r\n      currentTask: '变电站设备检查',\r\n      remainingTime: '12:45',\r\n      completedTasks: 8,\r\n      totalTasks: 12,\r\n      // Cesium相关数据\r\n      viewer: null,\r\n      tileset: null,\r\n      loading: false,\r\n      error: '',\r\n      wireframe: false,\r\n      resizeObserver: null,\r\n      debouncedForceResize: null,\r\n      // 大疆组件加载状态\r\n      fh2Loaded: false,\r\n      // 全局变量：当前选中的航线\r\n      selectedWayline: null,\r\n      // 告警信息\r\n      alarms: [],\r\n      // 告警加载状态\r\n      loadingAlarms: false,\r\n      // 告警详情弹窗\r\n      showAlarmDetail: false,\r\n      currentAlarm: null,\r\n      // 配置信息需要根据实际环境进行修改\r\n      djiConfig: {\r\n        serverUrl: 'http://your-dji-server-ip-or-domain:30812',\r\n        wssUrl: 'ws://your-dji-server-ip-or-domain:30812/duplex/web',\r\n        hostUrl: 'http://your-dji-server-ip-or-domain',\r\n        // 复制 prjId 到这里\r\n        prjId: 'cdca2736-8096-4729-9bc7-497ad5b60d5e',\r\n        // 复制 projectToken 到这里\r\n        projectToken: 'your-project-token-here'\r\n      },\r\n      // 模拟报警数据，添加航线ID关联\r\n      mockAlarms: [\r\n        {\r\n          id: 1,\r\n          title: '电力线异常发热',\r\n          description: '在坐标(23.124, 113.235)处检测到电力线温度异常升高，可能存在线路老化或过载情况。',\r\n          timestamp: '2024-01-15T14:22:35',\r\n          location: '变电站A区域-东线路',\r\n          type: '温度异常',\r\n          severity: '高',\r\n          imageUrl: 'https://picsum.photos/800/600?random=1',\r\n          waylineId: 1\r\n        },\r\n        {\r\n          id: 2,\r\n          title: '绝缘子损伤',\r\n          description: '在铁塔#128处发现绝缘子表面有明显裂纹，需要进一步检查。',\r\n          timestamp: '2024-01-15T13:45:12',\r\n          location: '铁塔#128',\r\n          type: '设备损伤',\r\n          severity: '中',\r\n          imageUrl: 'https://picsum.photos/800/600?random=2',\r\n          waylineId: 1\r\n        },\r\n        {\r\n          id: 3,\r\n          title: '无人机信号弱',\r\n          description: '在航线中段区域信号强度明显减弱，建议调整飞行高度。',\r\n          timestamp: '2024-01-15T12:30:45',\r\n          location: '桥梁中部区域',\r\n          type: '信号异常',\r\n          severity: '低',\r\n          imageUrl: 'https://picsum.photos/800/600?random=3',\r\n          waylineId: 2\r\n        },\r\n        {\r\n          id: 4,\r\n          title: '电池电量警告',\r\n          description: '无人机电池电量低于30%，建议尽快返航。',\r\n          timestamp: '2024-01-15T11:15:20',\r\n          location: '河道巡查区段',\r\n          type: '电量警告',\r\n          severity: '中',\r\n          imageUrl: 'https://picsum.photos/800/600?random=4',\r\n          waylineId: 3\r\n        }\r\n      ]\r\n    }\r\n  },\r\n  async mounted() {\r\n    // 检查FH2是否已加载\r\n    this.checkFh2Availability()\r\n    \r\n    // 等待DOM更新完成后再初始化Cesium\r\n    this.$nextTick(async () => {\r\n      // 等待一小段时间确保DOM完全渲染\r\n      setTimeout(async () => {\r\n        // 等待Cesium资源加载完成后再初始化\r\n        await this.initCesium()\r\n        \r\n        // 初始化 ResizeObserver\r\n        this.initResizeObserver()\r\n        \r\n        // 自动加载默认模型\r\n        await this.loadModel()\r\n      }, 200)\r\n    })\r\n  },\r\n  beforeUnmount() {\r\n    if (this.viewer) {\r\n      this.viewer.destroy()\r\n    }\r\n    // 清理 ResizeObserver\r\n    if (this.resizeObserver) {\r\n      this.resizeObserver.disconnect()\r\n    }\r\n    // 移除窗口大小调整事件监听\r\n    window.removeEventListener('resize', this.handleWindowResize)\r\n    // 清理防抖函数的定时器\r\n    if (this.debouncedForceResize && this.debouncedForceResize.timeout) {\r\n      clearTimeout(this.debouncedForceResize.timeout)\r\n    }\r\n  },\r\n  methods: {\r\n    // 检查FH2是否可用\r\n    checkFh2Availability() {\r\n      // 检查全局是否存在FH2对象\r\n      if (typeof window.FH2 !== 'undefined') {\r\n        this.fh2Loaded = true\r\n        console.log('FH2已成功加载')\r\n      } else {\r\n        this.fh2Loaded = false\r\n        console.warn('FH2未正确加载，将使用备用组件')\r\n        \r\n        // 设置一个定时器，再次检查FH2是否加载完成\r\n        setTimeout(() => {\r\n          this.checkFh2Availability()\r\n        }, 1000)\r\n      }\r\n    },\r\n    \r\n    openWaylineCreation() {\r\n      if (!this.fh2Loaded) {\r\n        this.$message.warning('大疆组件未正确加载，无法创建航线')\r\n        return\r\n      }\r\n      this.showWaylineCreation = true\r\n    },\r\n    handleAlarmRefresh() {\r\n      console.log('刷新报警信息')\r\n      // 如果有选中的航线，刷新告警信息\r\n      if (this.selectedWayline) {\r\n        this.fetchAlarmsByWayline(this.selectedWayline.id)\r\n      }\r\n    },\r\n    handleViewAlarmDetail(alarm) {\r\n      console.log('查看报警详情:', alarm)\r\n      this.currentAlarm = alarm\r\n      this.showAlarmDetail = true\r\n    },\r\n    handleProcessAlarm(alarmId) {\r\n      console.log('处理报警:', alarmId)\r\n      // 从alarms数组中移除已处理的报警\r\n      this.alarms = this.alarms.filter(alarm => alarm.id !== alarmId)\r\n      \r\n      // 调用API更新告警状态\r\n      this.updateAlarmStatus(alarmId)\r\n    },\r\n    \r\n    // 更新告警状态\r\n    async updateAlarmStatus(alarmId) {\r\n      try {\r\n        // 根据后端模型，正确的完成状态是'COMPLETED'\r\n        await alarmApi.patchAlarm(alarmId, { status: 'COMPLETED' })\r\n        console.log('告警状态更新成功')\r\n      } catch (error) {\r\n        console.error('更新告警状态失败:', error)\r\n        // 不影响前端显示，仅记录错误\r\n      }\r\n    },\r\n    \r\n    // 处理航线选择事件\r\n    handleWaylineSelected(wayline) {\r\n      console.log('选中航线:', wayline)\r\n      this.selectedWayline = wayline\r\n      // 当选择航线时，获取该航线的告警信息\r\n      this.fetchAlarmsByWayline(wayline.id)\r\n    },\r\n    \r\n    // 根据航线ID获取告警信息\r\n    async fetchAlarmsByWayline(waylineId) {\r\n      if (!waylineId) {\r\n        this.alarms = []\r\n        return\r\n      }\r\n      \r\n      this.loadingAlarms = true\r\n      try {\r\n        // 调用API获取告警信息，使用wayline_id参数过滤\r\n        const response = await alarmApi.getAlarms({ wayline_id: waylineId })\r\n        // 转换API返回的数据格式以适配AlarmPanel组件\r\n        this.alarms = this.transformAlarmData(response)\r\n      } catch (error) {\r\n        console.error('获取告警信息失败:', error)\r\n        this.$message.error('获取告警信息失败，请稍后重试')\r\n        // 出错时使用空数组，避免显示错误数据\r\n        this.alarms = []\r\n      } finally {\r\n        this.loadingAlarms = false\r\n      }\r\n    },\r\n    \r\n    // 转换API返回的告警数据格式\r\n    transformAlarmData(alarmData) {\r\n      // 确保alarmData是数组\r\n      const alarms = Array.isArray(alarmData) ? alarmData : (alarmData.results || [])\r\n      \r\n      // 直接返回后端API的数据，不再转换为旧格式\r\n      // 保留原始字段结构，确保与AlarmPanel组件兼容\r\n      return alarms\r\n    },\r\n    \r\n    // 获取告警严重级别\r\n    getSeverityLevel(level) {\r\n      switch (level) {\r\n        case 3:\r\n        case 'high':\r\n        case '高':\r\n          return '高'\r\n        case 2:\r\n        case 'medium':\r\n        case '中':\r\n          return '中'\r\n        case 1:\r\n        case 'low':\r\n        case '低':\r\n          return '低'\r\n        default:\r\n          return '低'\r\n      }\r\n    },\r\n    \r\n    // 获取当前选中航线的告警信息\r\n    getFilteredAlarms() {\r\n      // 直接返回从API获取的告警信息，因为我们已经根据航线ID过滤过了\r\n      return this.alarms\r\n    },\r\n    async initCesium() {\r\n      try {\r\n        // 动态导入Cesium\r\n        const Cesium = await import('cesium')\r\n        \r\n        // 设置Cesium的access token为空（因为我们使用的是本地资源）\r\n        Cesium.Ion.defaultAccessToken = ''\r\n        \r\n        // 使用引用获取包装器元素\r\n        const wrapper = this.$refs.cesiumWrapper\r\n        if (!wrapper) {\r\n          throw new Error('找不到 cesiumWrapper 元素')\r\n        }\r\n        \r\n        // 移除已存在的Cesium容器（如果有）\r\n        const existingContainer = document.getElementById('cesiumContainer')\r\n        if (existingContainer) {\r\n          existingContainer.remove()\r\n        }\r\n        \r\n        // 使用原生DOM操作创建容器，避免Vue响应式影响\r\n        const container = document.createElement('div')\r\n        container.id = 'cesiumContainer'\r\n        \r\n        // 重要：在添加到DOM前先设置好样式\r\n        container.style.width = '100%'\r\n        container.style.height = '100%'\r\n        container.style.position = 'relative'\r\n        container.style.margin = '0'\r\n        container.style.padding = '0'\r\n        container.style.overflow = 'hidden'\r\n        container.style.zIndex = '1'\r\n        \r\n        // 先将容器添加到DOM中\r\n        wrapper.appendChild(container)\r\n        \r\n        // 等待并确保容器有正确的尺寸\r\n        let attempts = 0;\r\n        const maxAttempts = 20;\r\n        let width, height;\r\n        \r\n        do {\r\n          width = wrapper.offsetWidth\r\n          height = wrapper.offsetHeight\r\n          \r\n          if (width <= 0 || height <= 0) {\r\n            await new Promise(resolve => setTimeout(resolve, 50));\r\n            attempts++;\r\n          } else {\r\n            break;\r\n          }\r\n        } while (attempts < maxAttempts);\r\n        \r\n        if (width <= 0 || height <= 0) {\r\n          throw new Error(`无效的容器尺寸: ${width}x${height}`)\r\n        }\r\n        \r\n        console.log('初始化Cesium容器尺寸:', width, 'x', height)\r\n        \r\n        // 初始化Cesium Viewer - 添加一些关键配置以确保正确的大小调整\r\n        this.viewer = new Cesium.Viewer(container, {\r\n          animation: false,\r\n          baseLayerPicker: false,\r\n          fullscreenButton: false,\r\n          vrButton: false,\r\n          geocoder: false,\r\n          homeButton: false,\r\n          infoBox: false,\r\n          sceneModePicker: false,\r\n          selectionIndicator: false,\r\n          timeline: false,\r\n          navigationHelpButton: false,\r\n          navigationInstructionsInitiallyVisible: false,\r\n          scene3DOnly: true,\r\n          shadows: true,\r\n          shouldAnimate: true,\r\n          creditContainer: document.createElement('div'),\r\n          // 关键配置：避免Cesium自动添加resize监听器，由我们自己控制\r\n          automaticallyTrackDataSourceClocks: false,\r\n          // 提高渲染性能\r\n          orderIndependentTranslucency: true,\r\n          // 确保canvas元素可以正确调整大小\r\n          contextOptions: {\r\n            alpha: true,\r\n            stencil: true\r\n          }\r\n        })\r\n        \r\n        // 确保canvas元素的尺寸正确设置\r\n        if (this.viewer && this.viewer.canvas) {\r\n          this.viewer.canvas.style.width = '100%'\r\n          this.viewer.canvas.style.height = '100%'\r\n        }\r\n\r\n        // 设置初始视角\r\n        this.viewer.camera.setView({\r\n          destination: Cesium.Cartesian3.fromDegrees(116.3913, 39.9075, 1000),\r\n          orientation: {\r\n            heading: Cesium.Math.toRadians(0),\r\n            pitch: Cesium.Math.toRadians(-30),\r\n            roll: 0.0\r\n          }\r\n        })\r\n      } catch (err) {\r\n        this.error = '初始化Cesium失败: ' + err.message\r\n        console.error('Cesium initialization error:', err)\r\n      }\r\n    },\r\n    // 防抖函数\r\n    debounce(func, wait) {\r\n      let timeout;\r\n      return function executedFunction(...args) {\r\n        const later = () => {\r\n          clearTimeout(timeout);\r\n          func(...args);\r\n        };\r\n        clearTimeout(timeout);\r\n        timeout = setTimeout(later, wait);\r\n      };\r\n    },\r\n    \r\n    initResizeObserver() {\r\n      const wrapper = this.$refs.cesiumWrapper\r\n      if (!wrapper) return\r\n      \r\n      // 移除任何现有的ResizeObserver，防止多个实例\r\n      if (this.resizeObserver) {\r\n        this.resizeObserver.disconnect()\r\n      }\r\n      \r\n      // 创建更宽松的防抖函数\r\n      this.debouncedForceResize = this.debounce(() => {\r\n        if (this.viewer) {\r\n          console.log('防抖后调用forceResize')\r\n          this.forceResize()\r\n        }\r\n      }, 100) // 增加到100ms，给DOM更多时间稳定\r\n      \r\n      // 创建 ResizeObserver 实例，但避免在回调中立即修改DOM\r\n      this.resizeObserver = new ResizeObserver(entries => {\r\n        // 记录尺寸变化，但不直接在回调中修改\r\n        if (entries.length > 0) {\r\n          const entry = entries[0]\r\n          const width = entry.contentRect.width\r\n          const height = entry.contentRect.height\r\n          console.log(`ResizeObserver检测到尺寸变化: ${width}x${height}`)\r\n        }\r\n        // 使用防抖函数延迟处理\r\n        this.debouncedForceResize()\r\n      })\r\n      \r\n      // 只观察包装器元素\r\n      this.resizeObserver.observe(wrapper, {\r\n        box: 'content-box' // 观察内容盒大小\r\n      })\r\n      \r\n      // 添加窗口调整大小事件监听\r\n      window.addEventListener('resize', this.handleWindowResize)\r\n      \r\n      // 初始时立即调用一次调整大小\r\n      setTimeout(() => {\r\n        this.forceResize()\r\n      }, 100)\r\n    },\r\n    \r\n    handleWindowResize() {\r\n      if (this.viewer) {\r\n        // 利用已定义的防抖函数\r\n        this.debouncedForceResize()\r\n      }\r\n    },\r\n    // 获取状态文本\r\n    getStatusText(status) {\r\n      const statusMap = {\r\n        'PENDING': '待处理',\r\n        'PROCESSING': '处理中',\r\n        'COMPLETED': '已完成',\r\n        'IGNORED': '已忽略'\r\n      }\r\n      return statusMap[status] || status\r\n    },\r\n    // 强制调整Cesium容器大小\r\n    forceResize() {\r\n      try {\r\n        console.log('开始强制调整大小...')\r\n        const wrapper = this.$refs.cesiumWrapper\r\n        const container = document.getElementById('cesiumContainer')\r\n        \r\n        if (!wrapper || !container || !this.viewer) {\r\n          console.warn('无法调整大小：缺少必要元素')\r\n          return\r\n        }\r\n        \r\n        // 强制重新计算布局\r\n        void wrapper.offsetHeight\r\n        \r\n        // 获取包装器的实际尺寸\r\n        const width = wrapper.offsetWidth\r\n        const height = wrapper.offsetHeight\r\n        \r\n        // 避免无效尺寸\r\n        if (width <= 0 || height <= 0) {\r\n          console.warn('无效的容器尺寸，跳过调整:', width, 'x', height)\r\n          return\r\n        }\r\n        \r\n        console.log('获取到的包装器尺寸:', width, 'x', height)\r\n        \r\n        // 更新错误信息\r\n        this.error = ''\r\n        \r\n        // 关键修改：使用百分比而非像素值，让CSS自动处理\r\n        container.style.width = '100%'\r\n        container.style.height = '100%'\r\n        \r\n        // 确保canvas元素也使用百分比\r\n        if (this.viewer && this.viewer.canvas) {\r\n          this.viewer.canvas.style.width = '100%'\r\n          this.viewer.canvas.style.height = '100%'\r\n          console.log('设置canvas样式为100%宽高')\r\n        }\r\n        \r\n        // 直接强制重新创建视图，使用try-catch防止resize方法不存在的错误\r\n        if (this.viewer) {\r\n          console.log('尝试调整视图大小')\r\n          try {\r\n            // 安全调用resize方法\r\n            if (this.viewer.scene && typeof this.viewer.scene.resize === 'function') {\r\n              this.viewer.scene.resize()\r\n            }\r\n            if (typeof this.viewer.resize === 'function') {\r\n              this.viewer.resize()\r\n            }\r\n          } catch (resizeError) {\r\n            console.warn('调整视图大小方法调用失败，但不影响功能:', resizeError)\r\n          }\r\n          \r\n          // 强制重排和重绘\r\n          void container.offsetHeight\r\n        }\r\n      } catch (error) {\r\n        console.error('调整大小失败:', error)\r\n      }\r\n    },\r\n    async loadModel() {\r\n      if (!this.viewer) return\r\n      \r\n      this.loading = true\r\n      this.error = ''\r\n      \r\n      try {\r\n        // 动态导入Cesium\r\n        const Cesium = await import('cesium')\r\n        \r\n        // 如果已有模型，先移除\r\n        if (this.tileset) {\r\n          this.viewer.scene.primitives.remove(this.tileset)\r\n          this.tileset = null\r\n        }\r\n        \r\n        // 加载3D Tiles数据集\r\n        this.tileset = await Cesium.Cesium3DTileset.fromUrl('/models/Model_0/tileset.json')\r\n        \r\n        this.viewer.scene.primitives.add(this.tileset)\r\n        \r\n        // 缩放到模型\r\n        if (this.tileset.readyPromise) {\r\n          this.tileset.readyPromise.then(() => {\r\n            this.flyToModel()\r\n          }).catch(error => {\r\n            this.error = '模型加载失败: ' + error.message\r\n            console.error('Tileset loading error:', error)\r\n          }).finally(() => {\r\n            this.loading = false\r\n          })\r\n        } else {\r\n          // 如果没有readyPromise，直接设置状态\r\n          this.flyToModel()\r\n          this.loading = false\r\n        }\r\n      } catch (err) {\r\n        this.error = '模型加载失败: ' + err.message\r\n        this.loading = false\r\n        console.error('Model loading error:', err)\r\n      }\r\n    },\r\n    flyToModel() {\r\n      if (this.viewer && this.tileset) {\r\n        this.viewer.flyTo(this.tileset)\r\n      }\r\n    },\r\n    async resetView() {\r\n      if (this.viewer) {\r\n        // 重置到初始视角\r\n        const Cesium = await import('cesium')\r\n        this.viewer.camera.setView({\r\n          destination: Cesium.Cartesian3.fromDegrees(116.3913, 39.9075, 1000),\r\n          orientation: {\r\n            heading: Cesium.Math.toRadians(0),\r\n            pitch: Cesium.Math.toRadians(-30),\r\n            roll: 0.0\r\n          }\r\n        })\r\n      }\r\n    },\r\n    toggleWireframe() {\r\n      if (!this.tileset) return\r\n      \r\n      this.wireframe = !this.wireframe\r\n      this.tileset.debugWireframe = this.wireframe\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n/* 基础布局样式 */\r\n.dji-dashboard {\r\n  width: 100%;\r\n  height: 100vh;\r\n  box-sizing: border-box;\r\n  display: flex;\r\n  flex-direction: column;\r\n  overflow: hidden;\r\n}\r\n\r\n.header {\r\n  z-index: 10;\r\n}\r\n\r\n.main-content {\r\n  display: flex;\r\n  flex: 1;\r\n  overflow: hidden;\r\n}\r\n\r\n.model-view {\r\n  flex: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n  min-width: 0; /* 防止flex子元素溢出 */\r\n}\r\n\r\n.cesium-wrapper {\r\n  flex: 1;\r\n  position: relative;\r\n  min-height: 0; /* 防止flex子元素溢出 */\r\n  border: 1px solid #374151;\r\n  border-radius: 4px;\r\n  margin: 8px;\r\n  margin-top: 0;\r\n  background: #0f172a;\r\n}\r\n\r\n.left-panel, .right-panel {\r\n  flex-shrink: 0;\r\n  min-height: 0; /* 防止flex子元素溢出 */\r\n}\r\n\r\n/* 面板部分样式 */\r\n.panel-section {\r\n  padding-bottom: 1rem;\r\n  border-bottom: 1px solid #374151;\r\n}\r\n\r\n.panel-section:last-child {\r\n  border-bottom: none;\r\n  padding-bottom: 0;\r\n}\r\n\r\n/* 进度条容器样式 */\r\n.progress-container {\r\n  flex-shrink: 0;\r\n  border: 1px solid #374151;\r\n  border-radius: 4px;\r\n  margin: 8px;\r\n  margin-bottom: 0;\r\n}\r\n\r\n/* Cesium容器样式 - 通过JS动态设置，这里只设置基础样式 */\r\n#cesiumContainer {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  margin: 0;\r\n  padding: 0;\r\n  overflow: hidden;\r\n  z-index: 1;\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n/* 加载状态样式 */\r\n.loading-container {\r\n  background-color: #1f2937;\r\n  border-radius: 4px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n/* 强制所有元素正确计算大小 */\r\n* {\r\n  box-sizing: border-box;\r\n}\r\n\r\n/* Element Plus 暗黑模式覆盖 */\r\n.el-button {\r\n  background: linear-gradient(135deg, #374151, #4b5563);\r\n  border: 1px solid #6b7280;\r\n  color: #d1d5db;\r\n}\r\n\r\n.el-button:hover {\r\n  background: linear-gradient(135deg, #4b5563, #6b7280);\r\n  border: 1px solid #9ca3af;\r\n  color: #f3f4f6;\r\n  box-shadow: 0 0 10px rgba(107, 114, 128, 0.5);\r\n}\r\n\r\n.el-dialog__header {\r\n  background: #1f2937;\r\n  border-bottom: 1px solid #374151;\r\n}\r\n\r\n.el-dialog__title {\r\n  color: #3b82f6;\r\n}\r\n\r\n.el-dialog__body {\r\n  background: #111827;\r\n  color: #d1d5db;\r\n}\r\n\r\n.el-dialog__footer {\r\n  background: #1f2937;\r\n  border-top: 1px solid #374151;\r\n}\r\n\r\n.el-alert {\r\n  background: rgba(17, 24, 39, 0.9);\r\n  border: 1px solid #374151;\r\n  color: #d1d5db;\r\n}\r\n\r\n.el-alert__description {\r\n  color: #9ca3af;\r\n}\r\n\r\n/* 添加科技感网格线 */\r\n.dji-dashboard::before {\r\n  content: '';\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background-image: \r\n    linear-gradient(rgba(59, 130, 246, 0.1) 1px, transparent 1px),\r\n    linear-gradient(90deg, rgba(59, 130, 246, 0.1) 1px, transparent 1px);\r\n  background-size: 30px 30px;\r\n  pointer-events: none;\r\n  z-index: -1;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}