{"ast":null,"code":"import WaylineList from './WaylineList.vue';\nexport default {\n  name: 'WaylineFallback',\n  components: {\n    WaylineList\n  },\n  props: {\n    currentSelectedId: {\n      type: Number,\n      default: null\n    }\n  },\n  emits: ['wayline-selected'],\n  data() {\n    return {\n      showCustomWaylineList: false,\n      djiComponentLoaded: false,\n      checkTimer: null\n    };\n  },\n  async mounted() {\n    await this.tryLoadDjiComponent();\n  },\n  beforeUnmount() {\n    if (this.checkTimer) {\n      clearTimeout(this.checkTimer);\n    }\n  },\n  methods: {\n    async tryLoadDjiComponent() {\n      try {\n        this.djiComponentLoaded = await this.checkDjiComponentAvailability();\n        if (!this.djiComponentLoaded) {\n          this.showCustomWaylineList = true;\n          // 仅在开发环境提示，避免打扰用户\n          if (process.env.NODE_ENV === 'development') {\n            console.warn('大疆航线组件加载失败，已切换至自定义航线列表');\n          }\n        } else {\n          this.renderDjiComponent();\n          this.checkTimer = setTimeout(() => {\n            this.verifyDjiComponent();\n          }, 3000);\n        }\n      } catch (error) {\n        console.error('加载大疆组件时出错:', error);\n        this.showCustomWaylineList = true;\n      }\n    },\n    async checkDjiComponentAvailability() {\n      try {\n        if (typeof window.DJI !== 'undefined' && typeof window.DJI.WaylineComponent !== 'undefined') {\n          return true;\n        }\n        if (window.djiApi && typeof window.djiApi.getWaylines === 'function') {\n          return true;\n        }\n        return false;\n      } catch (error) {\n        return false;\n      }\n    },\n    renderDjiComponent() {\n      try {\n        if (this.$refs.djiContainer) {\n          this.$refs.djiContainer.innerHTML = '<div class=\"dji-placeholder-premium\"><div class=\"loading-spinner\"></div><span class=\"loading-text\">正在加载大疆组件...</span></div>';\n          if (typeof window.DJI?.WaylineComponent?.init === 'function') {\n            window.DJI.WaylineComponent.init(this.$refs.djiContainer, {\n              showList: true,\n              showMap: true\n            });\n          }\n        }\n      } catch (error) {\n        console.error('渲染大疆组件失败:', error);\n        this.showCustomWaylineList = true;\n      }\n    },\n    verifyDjiComponent() {\n      try {\n        const container = this.$refs.djiContainer;\n        if (container && container.querySelector('.dji-placeholder-premium')) {\n          this.showCustomWaylineList = true;\n        }\n      } catch (error) {\n        console.error('验证大疆组件失败:', error);\n        this.showCustomWaylineList = true;\n      }\n    },\n    handleWaylineSelected(wayline) {\n      this.$emit('wayline-selected', wayline);\n    }\n  }\n};","map":{"version":3,"names":["WaylineList","name","components","props","currentSelectedId","type","Number","default","emits","data","showCustomWaylineList","djiComponentLoaded","checkTimer","mounted","tryLoadDjiComponent","beforeUnmount","clearTimeout","methods","checkDjiComponentAvailability","process","env","NODE_ENV","console","warn","renderDjiComponent","setTimeout","verifyDjiComponent","error","window","DJI","WaylineComponent","djiApi","getWaylines","$refs","djiContainer","innerHTML","init","showList","showMap","container","querySelector","handleWaylineSelected","wayline","$emit"],"sources":["D:\\projects\\FlightHub-2-Frontend-Standalone-Component\\frontend\\src\\components\\WaylineFallback.vue"],"sourcesContent":["<template>\n  <div class=\"wayline-fallback-premium\">\n    <!-- 当大疆组件不可用时显示自定义航线列表 -->\n    <WaylineList \n      v-if=\"showCustomWaylineList\" \n      :current-selected-id=\"currentSelectedId\"\n      @wayline-selected=\"handleWaylineSelected\"\n    />\n    \n    <!-- 用于放置大疆原始组件的容器 -->\n    <div \n      v-else \n      ref=\"djiContainer\" \n      class=\"dji-container-premium\"\n    ></div>\n  </div>\n</template>\n\n<script>\nimport WaylineList from './WaylineList.vue'\n\nexport default {\n  name: 'WaylineFallback',\n  components: {\n    WaylineList\n  },\n  props: {\n    currentSelectedId: {\n      type: Number,\n      default: null\n    }\n  },\n  emits: ['wayline-selected'],\n  data() {\n    return {\n      showCustomWaylineList: false,\n      djiComponentLoaded: false,\n      checkTimer: null\n    }\n  },\n  async mounted() {\n    await this.tryLoadDjiComponent()\n  },\n  beforeUnmount() {\n    if (this.checkTimer) {\n      clearTimeout(this.checkTimer)\n    }\n  },\n  methods: {\n    async tryLoadDjiComponent() {\n      try {\n        this.djiComponentLoaded = await this.checkDjiComponentAvailability()\n        \n        if (!this.djiComponentLoaded) {\n          this.showCustomWaylineList = true\n          // 仅在开发环境提示，避免打扰用户\n          if (process.env.NODE_ENV === 'development') {\n            console.warn('大疆航线组件加载失败，已切换至自定义航线列表')\n          }\n        } else {\n          this.renderDjiComponent()\n          this.checkTimer = setTimeout(() => {\n            this.verifyDjiComponent()\n          }, 3000)\n        }\n      } catch (error) {\n        console.error('加载大疆组件时出错:', error)\n        this.showCustomWaylineList = true\n      }\n    },\n    \n    async checkDjiComponentAvailability() {\n      try {\n        if (typeof window.DJI !== 'undefined' && \n            typeof window.DJI.WaylineComponent !== 'undefined') {\n          return true\n        }\n        if (window.djiApi && typeof window.djiApi.getWaylines === 'function') {\n          return true\n        }\n        return false\n      } catch (error) {\n        return false\n      }\n    },\n    \n    renderDjiComponent() {\n      try {\n        if (this.$refs.djiContainer) {\n          this.$refs.djiContainer.innerHTML = '<div class=\"dji-placeholder-premium\"><div class=\"loading-spinner\"></div><span class=\"loading-text\">正在加载大疆组件...</span></div>'\n          \n          if (typeof window.DJI?.WaylineComponent?.init === 'function') {\n            window.DJI.WaylineComponent.init(this.$refs.djiContainer, {\n              showList: true,\n              showMap: true\n            })\n          }\n        }\n      } catch (error) {\n        console.error('渲染大疆组件失败:', error)\n        this.showCustomWaylineList = true\n      }\n    },\n    \n    verifyDjiComponent() {\n      try {\n        const container = this.$refs.djiContainer\n        if (container && container.querySelector('.dji-placeholder-premium')) {\n          this.showCustomWaylineList = true\n        }\n      } catch (error) {\n        console.error('验证大疆组件失败:', error)\n        this.showCustomWaylineList = true\n      }\n    },\n    \n    handleWaylineSelected(wayline) {\n      this.$emit('wayline-selected', wayline)\n    }\n  }\n}\n</script>\n\n<style scoped>\n.wayline-fallback-premium {\n  width: 100%;\n  height: 100%;\n  min-height: 200px;\n}\n\n.dji-container-premium {\n  width: 100%;\n  height: 100%;\n  min-height: 200px;\n  border: 1px solid rgba(0, 212, 255, 0.2);\n  border-radius: 8px;\n  overflow: hidden;\n  background: rgba(15, 23, 42, 0.4);\n}\n\n:deep(.dji-placeholder-premium) {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 12px;\n  color: #94a3b8;\n  background: rgba(15, 23, 42, 0.6);\n}\n\n:deep(.loading-spinner) {\n  width: 24px;\n  height: 24px;\n  border: 2px solid rgba(0, 212, 255, 0.1);\n  border-top-color: #00d4ff;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n}\n\n:deep(.loading-text) {\n  font-size: 12px;\n  color: #00d4ff;\n}\n\n@keyframes spin {\n  to { transform: rotate(360deg); }\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}