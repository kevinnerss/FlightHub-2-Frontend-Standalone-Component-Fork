{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport { ref, computed } from 'vue';\nimport { isEqual } from 'lodash-unified';\nimport { useLocale } from '../../../../hooks/use-locale/index.mjs';\nimport { valueEquals, formatter, parseDate, dayOrDaysToDate } from '../utils.mjs';\nimport { isArray } from '@vue/shared';\nimport { UPDATE_MODEL_EVENT } from '../../../../constants/event.mjs';\nconst useCommonPicker = (props, emit) => {\n  const {\n    lang\n  } = useLocale();\n  const pickerVisible = ref(false);\n  const pickerActualVisible = ref(false);\n  const userInput = ref(null);\n  const valueIsEmpty = computed(() => {\n    const {\n      modelValue\n    } = props;\n    return !modelValue || isArray(modelValue) && !modelValue.filter(Boolean).length;\n  });\n  const emitInput = input => {\n    if (!valueEquals(props.modelValue, input)) {\n      let formatted;\n      if (isArray(input)) {\n        formatted = input.map(item => formatter(item, props.valueFormat, lang.value));\n      } else if (input) {\n        formatted = formatter(input, props.valueFormat, lang.value);\n      }\n      const emitVal = input ? formatted : input;\n      emit(UPDATE_MODEL_EVENT, emitVal, lang.value);\n    }\n  };\n  const parsedValue = computed(() => {\n    var _a;\n    let dayOrDays;\n    if (valueIsEmpty.value) {\n      if (pickerOptions.value.getDefaultValue) {\n        dayOrDays = pickerOptions.value.getDefaultValue();\n      }\n    } else {\n      if (isArray(props.modelValue)) {\n        dayOrDays = props.modelValue.map(d => parseDate(d, props.valueFormat, lang.value));\n      } else {\n        dayOrDays = parseDate((_a = props.modelValue) != null ? _a : \"\", props.valueFormat, lang.value);\n      }\n    }\n    if (pickerOptions.value.getRangeAvailableTime) {\n      const availableResult = pickerOptions.value.getRangeAvailableTime(dayOrDays);\n      if (!isEqual(availableResult, dayOrDays)) {\n        dayOrDays = availableResult;\n        if (!valueIsEmpty.value) {\n          emitInput(dayOrDaysToDate(dayOrDays));\n        }\n      }\n    }\n    if (isArray(dayOrDays) && dayOrDays.some(day => !day)) {\n      dayOrDays = [];\n    }\n    return dayOrDays;\n  });\n  const pickerOptions = ref({});\n  const onSetPickerOption = e => {\n    pickerOptions.value[e[0]] = e[1];\n    pickerOptions.value.panelReady = true;\n  };\n  const onCalendarChange = e => {\n    emit(\"calendar-change\", e);\n  };\n  const onPanelChange = (value, mode, view) => {\n    emit(\"panel-change\", value, mode, view);\n  };\n  const onPick = (date = \"\", visible = false) => {\n    pickerVisible.value = visible;\n    let result;\n    if (isArray(date)) {\n      result = date.map(_ => _.toDate());\n    } else {\n      result = date ? date.toDate() : date;\n    }\n    userInput.value = null;\n    emitInput(result);\n  };\n  return {\n    parsedValue,\n    pickerActualVisible,\n    pickerOptions,\n    pickerVisible,\n    userInput,\n    valueIsEmpty,\n    emitInput,\n    onCalendarChange,\n    onPanelChange,\n    onPick,\n    onSetPickerOption\n  };\n};\nexport { useCommonPicker };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}