{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.flat-map.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport alarmApi from '../api/alarmApi';\nexport default {\n  name: 'AlarmStats',\n  data() {\n    return {\n      loading: true,\n      error: '',\n      lastUpdated: '',\n      months: [],\n      waylines: [],\n      waylineNameMap: {},\n      stats: {\n        safetyDays: 0,\n        totalAlarms: 0,\n        todayAlarms: 0,\n        totalMileage: '--',\n        todayMileage: '--'\n      },\n      safetyStatuses: [{\n        label: '同里程位',\n        value: 0,\n        color: '#38bdf8'\n      }, {\n        label: '重要点位',\n        value: 0,\n        color: '#a855f7'\n      }, {\n        label: '安全位',\n        value: 0,\n        color: '#22c55e'\n      }],\n      metrics: [],\n      lineChart: {\n        categories: [],\n        series: []\n      },\n      donutSeries: [],\n      chartSize: {\n        width: 1080,\n        height: 320\n      },\n      chartPaddingX: 28,\n      chartPaddingY: 16,\n      latestAlarmDate: null,\n      windowAlarms: [],\n      detailModal: {\n        visible: false,\n        loading: false,\n        waylineId: null,\n        waylineName: '',\n        monthLabel: '',\n        alarms: []\n      },\n      // 高对比度调色板（顺序循环使用）\n      seriesColors: ['#20A4F3',\n      // 鲜亮蓝\n      '#FF6B6B',\n      // 亮红\n      '#7C3AED',\n      // 深紫\n      '#16A34A',\n      // 纯绿\n      '#F59E0B',\n      // 琥珀橙\n      '#0EA5E9',\n      // 青蓝\n      '#EF4444',\n      // 鲜红\n      '#14B8A6',\n      // 松石绿\n      '#8B5CF6',\n      // 紫罗兰\n      '#F97316',\n      // 亮橙\n      '#22C55E',\n      // 草绿\n      '#C026D3' // 品红\n      ],\n      selectionMenu: {\n        visible: false,\n        options: [],\n        monthIndex: null,\n        x: 0,\n        y: 0\n      },\n      overlapColor: '#ffffff',\n      emptyTip: {\n        visible: false,\n        text: '暂无告警信息',\n        x: 0,\n        y: 0\n      }\n    };\n  },\n  computed: {\n    donutTotal() {\n      return this.donutSeries.reduce((sum, item) => sum + item.value, 0);\n    },\n    maxLineValue() {\n      const values = this.lineChart.series.flatMap(item => item.data);\n      return Math.max(...values, 1);\n    },\n    gridLines() {\n      const lines = [];\n      const steps = 5;\n      const innerHeight = Math.max(this.chartSize.height - this.chartPaddingY * 2, 1);\n      for (let i = 0; i <= steps; i++) {\n        const y = this.chartPaddingY + innerHeight / steps * i;\n        lines.push({\n          y\n        });\n      }\n      return lines;\n    },\n    axisPaddingStyle() {\n      return {\n        paddingLeft: `${this.chartPaddingX}px`,\n        paddingRight: `${this.chartPaddingX}px`\n      };\n    }\n  },\n  mounted() {\n    this.loadData();\n  },\n  methods: {\n    async loadData() {\n      this.loading = true;\n      this.error = '';\n      try {\n        // 先获取最新告警时间，用作时间轴锚点\n        const latest = await this.fetchLatestCreatedAt();\n        this.initMonths(latest || new Date());\n        await Promise.all([this.fetchWaylines(), this.fetchAndAggregateAlarms()]);\n        if (!this.lastUpdated && latest) {\n          this.lastUpdated = this.formatDateTime(latest);\n        }\n      } catch (err) {\n        console.error('加载告警统计失败', err);\n        this.error = '加载告警统计失败，请稍后重试';\n      } finally {\n        this.loading = false;\n      }\n    },\n    initMonths(baseDate = new Date()) {\n      const months = [];\n      const anchor = this.parsePlainDate(baseDate) || new Date();\n      for (let i = 11; i >= 0; i--) {\n        const date = new Date(anchor.getFullYear(), anchor.getMonth() - i, 1);\n        const start = new Date(date.getFullYear(), date.getMonth(), 1, 0, 0, 0, 0);\n        const end = new Date(date.getFullYear(), date.getMonth() + 1, 0, 23, 59, 59, 999);\n        months.push({\n          label: `${date.getMonth() + 1}月`,\n          key: `${date.getFullYear()}-${date.getMonth()}`,\n          start,\n          end\n        });\n      }\n      this.months = months;\n      this.lineChart.categories = months.map(m => m.label);\n    },\n    async fetchWaylines() {\n      try {\n        const res = await alarmApi.getWaylines();\n        const list = this.normalizeList(res);\n        this.waylines = list;\n        this.waylineNameMap = list.reduce((map, item) => {\n          const id = item.wayline_id || item.id;\n          if (id !== undefined && id !== null) {\n            map[id] = item.name || `航线${id}`;\n          }\n          return map;\n        }, {});\n      } catch (err) {\n        console.warn('加载航线列表失败，使用空列表', err);\n        this.waylines = [];\n        this.waylineNameMap = {};\n      }\n    },\n    normalizeList(res) {\n      if (!res) return [];\n      if (Array.isArray(res)) return res;\n      if (res.results) return res.results;\n      if (res.data) return res.data;\n      return [];\n    },\n    resolveWaylineId(alarm) {\n      return alarm?.wayline_id ?? alarm?.wayline?.id ?? alarm?.wayline?.wayline_id ?? alarm?.wayline_details?.id ?? alarm?.wayline_details?.wayline_id ?? null;\n    },\n    resolveWaylineName(alarm) {\n      const id = this.resolveWaylineId(alarm);\n      return alarm?.wayline?.name || alarm?.wayline_details?.name || this.waylineNameMap[id] || (id ? `航线${id}` : '未知航线');\n    },\n    async fetchAndAggregateAlarms() {\n      // 若已有时间窗口，用其开始结束做服务端过滤，避免漏数据；否则先取全部再重建窗口\n      const hasWindow = this.months.length > 0;\n      const params = {\n        page_size: 20000\n      };\n      if (hasWindow) {\n        params.start_date = this.formatDateParam(this.months[0].start);\n        params.end_date = this.formatDateParam(this.months[this.months.length - 1].end);\n      }\n      const alarms = await this.fetchAllAlarms(params);\n      const latest = this.getLatestCreatedAt(alarms);\n\n      // 用最新告警时间重建月份范围\n      const anchor = latest || this.latestAlarmDate || new Date();\n      this.initMonths(anchor);\n\n      // 过滤出窗口内的数据再聚合（按时间范围判定月份）\n      const inWindowAlarms = alarms.filter(item => this.getMonthIndexFromString(item.created_at) !== -1);\n      this.windowAlarms = inWindowAlarms;\n      this.buildStatsFromAlarms(inWindowAlarms);\n      this.buildSeries(inWindowAlarms);\n      if (latest) {\n        this.lastUpdated = this.formatDateTime(latest);\n      } else if (!this.lastUpdated && this.latestAlarmDate) {\n        this.lastUpdated = this.formatDateTime(this.latestAlarmDate);\n      }\n    },\n    async fetchAllAlarms(baseParams) {\n      const pageSize = baseParams.page_size || 20000;\n      let page = 1;\n      const collected = [];\n      let hasNext = true;\n      let totalCount = null;\n      // 分页抓取：优先看 next，其次看 count，再看页大小\n      while (hasNext) {\n        const res = await alarmApi.getAlarms({\n          ...baseParams,\n          page,\n          page_size: pageSize\n        });\n        const list = this.normalizeList(res);\n        collected.push(...list);\n        if (totalCount === null && res && typeof res.count === 'number') {\n          totalCount = res.count;\n        }\n        const hasNextFlag = Boolean(res && res.next);\n        const needByCount = totalCount !== null ? collected.length < totalCount : false;\n        const needBySize = list.length === pageSize;\n        hasNext = hasNextFlag || needByCount || needBySize;\n        if (!hasNext) break;\n        page += 1;\n      }\n      return collected;\n    },\n    async fetchLatestCreatedAt() {\n      try {\n        const res = await alarmApi.getAlarms({\n          page_size: 1,\n          ordering: '-created_at'\n        });\n        const list = this.normalizeList(res);\n        if (list.length && list[0].created_at) {\n          const ts = this.parsePlainDate(list[0].created_at);\n          this.latestAlarmDate = ts;\n          this.lastUpdated = this.formatDateTime(ts);\n          return ts;\n        }\n      } catch (err) {\n        console.warn('获取最新告警时间失败', err);\n      }\n      return null;\n    },\n    buildStatsFromAlarms(alarms) {\n      this.stats.totalAlarms = alarms.length;\n      const todayKey = this.formatDateParam(new Date());\n      this.stats.todayAlarms = alarms.filter(item => this.formatDateParam(this.parsePlainDate(item.created_at)) === todayKey).length;\n      const oldest = alarms.reduce((oldestTs, alarm) => {\n        const ts = this.parsePlainDate(alarm.created_at);\n        if (Number.isNaN(ts.getTime())) return oldestTs;\n        if (!oldestTs) return ts;\n        return ts < oldestTs ? ts : oldestTs;\n      }, null);\n      if (oldest) {\n        const now = Date.now();\n        const diffDays = Math.floor((now - oldest.getTime()) / (1000 * 60 * 60 * 24));\n        this.stats.safetyDays = Math.max(diffDays, 0);\n      } else {\n        this.stats.safetyDays = 0;\n      }\n      this.safetyStatuses = [{\n        label: '今日异常',\n        value: this.stats.todayAlarms,\n        color: '#38bdf8'\n      }, {\n        label: '近月异常',\n        value: alarms.filter(a => this.isInCurrentMonth(a.created_at)).length,\n        color: '#a855f7'\n      }, {\n        label: '全年异常',\n        value: this.stats.totalAlarms,\n        color: '#22c55e'\n      }];\n      this.metrics = [{\n        label: '发现异常总数',\n        value: this.stats.totalAlarms,\n        trend: 'up',\n        delta: ''\n      }, {\n        label: '今日发现异常数',\n        value: this.stats.todayAlarms,\n        trend: this.stats.todayAlarms ? 'up' : 'flat',\n        delta: this.stats.todayAlarms ? `+${this.stats.todayAlarms}` : '持平'\n      }, {\n        label: '巡检总里程',\n        value: this.stats.totalMileage,\n        trend: 'flat',\n        delta: ''\n      }, {\n        label: '今日巡检里程',\n        value: this.stats.todayMileage,\n        trend: 'flat',\n        delta: ''\n      }];\n    },\n    isInCurrentMonth(dateLike) {\n      const dt = this.parsePlainDate(dateLike);\n      const now = new Date();\n      return dt.getFullYear() === now.getFullYear() && dt.getMonth() === now.getMonth();\n    },\n    buildSeries(alarms) {\n      const seriesMap = new Map();\n      alarms.forEach(alarm => {\n        const waylineId = this.resolveWaylineId(alarm);\n        if (waylineId === null || waylineId === undefined) return;\n        const monthIndex = this.getMonthIndexFromString(alarm.created_at);\n        if (monthIndex === -1) return;\n        if (!seriesMap.has(waylineId)) {\n          seriesMap.set(waylineId, {\n            id: waylineId,\n            name: this.resolveWaylineName(alarm),\n            data: Array(this.months.length).fill(0)\n          });\n        }\n        seriesMap.get(waylineId).data[monthIndex] += 1;\n      });\n      const series = Array.from(seriesMap.values());\n      series.sort((a, b) => b.data.reduce((sum, n) => sum + n, 0) - a.data.reduce((sum, n) => sum + n, 0));\n      series.forEach((item, idx) => {\n        item.color = this.getSeriesColor(idx);\n      });\n      this.lineChart.series = series;\n      this.lineChart.categories = this.months.map(m => m.label);\n      this.donutSeries = series.map(item => ({\n        name: item.name,\n        value: item.data.reduce((sum, n) => sum + n, 0),\n        color: item.color\n      }));\n    },\n    getSeriesColor(index) {\n      return this.seriesColors[index % this.seriesColors.length];\n    },\n    getDonutDash(value) {\n      const circumference = 2 * Math.PI * 44;\n      const length = value / (this.donutTotal || 1) * circumference;\n      return `${length} ${circumference}`;\n    },\n    getDonutOffset(index) {\n      const circumference = 2 * Math.PI * 44;\n      const previous = this.donutSeries.slice(0, index).reduce((sum, item) => sum + item.value, 0);\n      return -(previous / (this.donutTotal || 1) * circumference);\n    },\n    getDonutPercent(value) {\n      if (!this.donutTotal) return 0;\n      return Math.round(value / this.donutTotal * 100);\n    },\n    getLinePoints(seriesData) {\n      const count = this.lineChart.categories.length || 1;\n      const innerWidth = Math.max(this.chartSize.width - this.chartPaddingX * 2, 1);\n      const innerHeight = Math.max(this.chartSize.height - this.chartPaddingY * 2, 1);\n      const max = this.maxLineValue || 1;\n      const step = count > 1 ? innerWidth / (count - 1) : innerWidth;\n      return seriesData.map((value, idx) => {\n        const x = count > 1 ? this.chartPaddingX + step * idx : this.chartPaddingX + innerWidth / 2;\n        const y = this.chartPaddingY + innerHeight - value / max * innerHeight;\n        return {\n          x,\n          y\n        };\n      });\n    },\n    getLinePath(seriesData) {\n      const points = this.getLinePoints(seriesData);\n      if (!points.length) return '';\n      const [first, ...rest] = points;\n      const pathParts = rest.map(point => `L ${point.x} ${point.y}`);\n      return `M ${first.x} ${first.y} ${pathParts.join(' ')}`;\n    },\n    getLatestCreatedAt(list) {\n      const latest = list.reduce((acc, item) => {\n        const ts = this.parsePlainDate(item.created_at);\n        if (Number.isNaN(ts.getTime())) return acc;\n        if (!acc) return ts;\n        return ts > acc ? ts : acc;\n      }, null);\n      return latest;\n    },\n    handlePointClick(serie, monthIndex, event) {\n      const month = this.months[monthIndex];\n      if (!month) return;\n      const value = serie.data?.[monthIndex] || 0;\n      if (!value) {\n        this.selectionMenu.visible = false;\n        this.showEmptyTip(event, '该月份无告警信息');\n        return;\n      }\n      const pointValue = serie.data?.[monthIndex] || 0;\n      const candidates = this.lineChart.series.filter(item => {\n        const v = item.data?.[monthIndex] || 0;\n        return v > 0 && v === pointValue;\n      });\n      if (candidates.length <= 1 || !event) {\n        return this.openDetailFor(serie, monthIndex);\n      }\n      this.selectionMenu.visible = true;\n      this.selectionMenu.options = candidates;\n      this.selectionMenu.monthIndex = monthIndex;\n      this.selectionMenu.x = event.clientX + 12;\n      this.selectionMenu.y = event.clientY + 12 + window.scrollY;\n    },\n    async openDetailFor(serie, monthIndex) {\n      const month = this.months[monthIndex];\n      if (!month) return;\n      this.selectionMenu.visible = false;\n      this.detailModal.visible = true;\n      this.detailModal.loading = true;\n      this.detailModal.alarms = [];\n      this.detailModal.waylineId = serie.id;\n      this.detailModal.waylineName = serie.name;\n      this.detailModal.monthLabel = month.label;\n      try {\n        // 先使用已加载的数据，避免接口筛选造成偏差\n        const filtered = this.windowAlarms.filter(alarm => {\n          const waylineId = this.resolveWaylineId(alarm);\n          const idx = this.getMonthIndexFromString(alarm.created_at);\n          return waylineId === serie.id && idx === monthIndex;\n        });\n        if (filtered.length) {\n          this.detailModal.alarms = filtered;\n        } else {\n          const res = await alarmApi.getAlarms({\n            wayline_id: serie.id,\n            start_date: this.formatDateParam(month.start),\n            end_date: this.formatDateParam(month.end),\n            page_size: 500\n          });\n          this.detailModal.alarms = this.normalizeList(res);\n        }\n      } catch (err) {\n        console.error('加载单月告警失败', err);\n        this.detailModal.alarms = [];\n      } finally {\n        this.detailModal.loading = false;\n      }\n    },\n    selectSeriesOption(option) {\n      const monthIdx = this.selectionMenu.monthIndex;\n      this.selectionMenu.visible = false;\n      if (option) {\n        this.openDetailFor(option, monthIdx);\n      }\n    },\n    closeDetailModal() {\n      this.detailModal.visible = false;\n    },\n    formatDateTime(dateLike) {\n      if (typeof dateLike === 'string') {\n        const trimmed = dateLike.trim().replace('T', ' ');\n        const noMs = trimmed.split('.')[0];\n        return noMs || trimmed;\n      }\n      const dt = this.parsePlainDate(dateLike);\n      if (Number.isNaN(dt.getTime())) return '--';\n      const pad = num => String(num).padStart(2, '0');\n      return `${dt.getFullYear()}-${pad(dt.getMonth() + 1)}-${pad(dt.getDate())} ${pad(dt.getHours())}:${pad(dt.getMinutes())}`;\n    },\n    formatDateParam(date) {\n      const dt = this.parsePlainDate(date);\n      const pad = num => String(num).padStart(2, '0');\n      return `${dt.getFullYear()}-${pad(dt.getMonth() + 1)}-${pad(dt.getDate())}`;\n    },\n    getMonthIndexForDate(dt) {\n      return this.months.findIndex(m => dt >= m.start && dt <= m.end);\n    },\n    getMonthIndexFromString(dateLike) {\n      const dt = this.parsePlainDate(dateLike);\n      if (!dt || Number.isNaN(dt.getTime())) return -1;\n      return this.getMonthIndexForDate(dt);\n    },\n    parsePlainDate(dateLike) {\n      if (typeof dateLike === 'string') {\n        const parts = this.parseDateParts(dateLike);\n        if (parts) return this.buildDateFromParts(parts);\n      }\n      const dt = new Date(dateLike);\n      return dt;\n    },\n    parseDateParts(dateLike) {\n      if (typeof dateLike !== 'string') return null;\n      const raw = dateLike.trim();\n      const cleaned = raw.replace(/([+-]\\d{2}:?\\d{2}|Z)$/i, '');\n      const match = cleaned.match(/^(\\d{4})-(\\d{2})-(\\d{2})[ T](\\d{2}):(\\d{2})(?::(\\d{2})(?:\\.(\\d+))?)?/);\n      if (!match) return null;\n      const [, y, m, d, h, mi, s, ms = '0'] = match;\n      return {\n        year: Number(y),\n        month: Number(m),\n        day: Number(d),\n        hour: Number(h),\n        minute: Number(mi),\n        second: Number(s || 0),\n        milli: Number(String(ms).padEnd(3, '0').slice(0, 3))\n      };\n    },\n    buildDateFromParts(parts) {\n      return new Date(parts.year, parts.month - 1, parts.day, parts.hour, parts.minute, parts.second, parts.milli || 0);\n    },\n    getPointColor(serie, monthIndex) {\n      // 若该月有多个航线点且值相同，使用重叠色\n      const targetValue = serie.data?.[monthIndex] || 0;\n      if (!targetValue) return serie.color;\n      const overlaps = this.lineChart.series.filter(s => {\n        const v = s.data?.[monthIndex] || 0;\n        return v === targetValue && v > 0;\n      });\n      if (overlaps.length > 1) {\n        return this.overlapColor;\n      }\n      return serie.color;\n    }\n  }\n};","map":{"version":3,"names":["alarmApi","name","data","loading","error","lastUpdated","months","waylines","waylineNameMap","stats","safetyDays","totalAlarms","todayAlarms","totalMileage","todayMileage","safetyStatuses","label","value","color","metrics","lineChart","categories","series","donutSeries","chartSize","width","height","chartPaddingX","chartPaddingY","latestAlarmDate","windowAlarms","detailModal","visible","waylineId","waylineName","monthLabel","alarms","seriesColors","selectionMenu","options","monthIndex","x","y","overlapColor","emptyTip","text","computed","donutTotal","reduce","sum","item","maxLineValue","values","flatMap","Math","max","gridLines","lines","steps","innerHeight","i","push","axisPaddingStyle","paddingLeft","paddingRight","mounted","loadData","methods","latest","fetchLatestCreatedAt","initMonths","Date","Promise","all","fetchWaylines","fetchAndAggregateAlarms","formatDateTime","err","console","baseDate","anchor","parsePlainDate","date","getFullYear","getMonth","start","end","key","map","m","res","getWaylines","list","normalizeList","id","wayline_id","undefined","warn","Array","isArray","results","resolveWaylineId","alarm","wayline","wayline_details","resolveWaylineName","hasWindow","length","params","page_size","start_date","formatDateParam","end_date","fetchAllAlarms","getLatestCreatedAt","inWindowAlarms","filter","getMonthIndexFromString","created_at","buildStatsFromAlarms","buildSeries","baseParams","pageSize","page","collected","hasNext","totalCount","getAlarms","count","hasNextFlag","Boolean","next","needByCount","needBySize","ordering","ts","todayKey","oldest","oldestTs","Number","isNaN","getTime","now","diffDays","floor","a","isInCurrentMonth","trend","delta","dateLike","dt","seriesMap","Map","forEach","has","set","fill","get","from","sort","b","n","idx","getSeriesColor","index","getDonutDash","circumference","PI","getDonutOffset","previous","slice","getDonutPercent","round","getLinePoints","seriesData","innerWidth","step","getLinePath","points","first","rest","pathParts","point","join","acc","handlePointClick","serie","event","month","showEmptyTip","pointValue","candidates","v","openDetailFor","clientX","clientY","window","scrollY","filtered","selectSeriesOption","option","monthIdx","closeDetailModal","trimmed","trim","replace","noMs","split","pad","num","String","padStart","getDate","getHours","getMinutes","getMonthIndexForDate","findIndex","parts","parseDateParts","buildDateFromParts","raw","cleaned","match","d","h","mi","s","ms","year","day","hour","minute","second","milli","padEnd","getPointColor","targetValue","overlaps"],"sources":["D:\\projects\\FlightHub-2-Frontend-Standalone-Component\\frontend\\src\\views\\AlarmStats.vue"],"sourcesContent":["<template>\n  <div class=\"alarm-stats-page\">\n    <div class=\"page-header\">\n      <div class=\"title-block\">\n        <p class=\"page-kicker\">沈阳地铁三号线 智能轨道巡检无人机</p>\n        <h1 class=\"page-title\">告警统计</h1>\n        <p class=\"page-subtitle\">近一年各航线月度告警趋势，可点击节点查看当月详情</p>\n      </div>\n      <div class=\"header-meta\">\n        <div class=\"meta-chip\">\n          <span class=\"meta-label\">统计周期</span>\n          <span class=\"meta-value\">近 12 个月</span>\n        </div>\n        <div class=\"meta-chip\">\n          <span class=\"meta-label\">更新时间</span>\n          <span class=\"meta-value\">{{ lastUpdated }}</span>\n        </div>\n      </div>\n    </div>\n\n    <div v-if=\"loading\" class=\"loading-state\">\n      <div class=\"loading-spinner\"></div>\n      <p>正在加载告警统计...</p>\n    </div>\n    <div v-else>\n      <div v-if=\"error\" class=\"error-state\">{{ error }}</div>\n\n      <div class=\"top-grid\">\n        <div class=\"card hero-card\">\n          <div class=\"hero-overlay\"></div>\n          <div class=\"hero-content\">\n            <div class=\"hero-header\">\n              <div>\n                <p class=\"hero-label\">安全运行天数</p>\n                <div class=\"hero-number\">\n                  {{ stats.safetyDays }}\n                  <span class=\"hero-unit\">天</span>\n                </div>\n              </div>\n              <span class=\"hero-tag\">近一年</span>\n            </div>\n            <div class=\"hero-summary\">\n              <div v-for=\"status in safetyStatuses\" :key=\"status.label\" class=\"summary-chip\">\n                <span class=\"chip-dot\" :style=\"{ background: status.color }\"></span>\n                <span class=\"chip-label\">{{ status.label }}</span>\n                <span class=\"chip-value\">{{ status.value }}</span>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"card metrics-card\">\n          <div class=\"card-header\">\n            <h3 class=\"card-title\">巡检指标</h3>\n            <span class=\"card-subtitle\">累计与当日概览</span>\n          </div>\n          <div class=\"metrics-grid\">\n            <div v-for=\"metric in metrics\" :key=\"metric.label\" class=\"metric-item\">\n              <div class=\"metric-label\">{{ metric.label }}</div>\n              <div class=\"metric-value\">\n                {{ metric.value }}\n                <span v-if=\"metric.delta\" class=\"metric-trend\" :class=\"metric.trend\">\n                  <span v-if=\"metric.trend === 'up'\">↑</span>\n                  <span v-else-if=\"metric.trend === 'down'\">↓</span>\n                  <span v-else>→</span>\n                  {{ metric.delta }}\n                </span>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"card donut-card\">\n          <div class=\"card-header\">\n            <h3 class=\"card-title\">异常点位趋势分布</h3>\n            <span class=\"card-subtitle\">按航线占比</span>\n          </div>\n          <div class=\"donut-content\">\n            <svg class=\"donut-chart\" viewBox=\"0 0 140 140\" role=\"img\" aria-label=\"异常占比\">\n              <defs>\n                <filter id=\"glow\" x=\"-40%\" y=\"-40%\" width=\"180%\" height=\"180%\">\n                  <feGaussianBlur stdDeviation=\"3\" result=\"coloredBlur\" />\n                  <feMerge>\n                    <feMergeNode in=\"coloredBlur\" />\n                    <feMergeNode in=\"SourceGraphic\" />\n                  </feMerge>\n                </filter>\n              </defs>\n              <circle\n                class=\"donut-track\"\n                cx=\"70\"\n                cy=\"70\"\n                r=\"44\"\n                fill=\"none\"\n                stroke=\"rgba(255,255,255,0.05)\"\n                stroke-width=\"14\"\n              />\n              <circle\n                v-for=\"(item, idx) in donutSeries\"\n                :key=\"item.name\"\n                class=\"donut-segment\"\n                filter=\"url(#glow)\"\n                cx=\"70\"\n                cy=\"70\"\n                r=\"44\"\n                fill=\"none\"\n                :stroke=\"item.color\"\n                stroke-linecap=\"round\"\n                stroke-width=\"14\"\n                :stroke-dasharray=\"getDonutDash(item.value)\"\n                :stroke-dashoffset=\"getDonutOffset(idx)\"\n                transform=\"rotate(-90 70 70)\"\n              />\n              <text x=\"70\" y=\"64\" text-anchor=\"middle\" class=\"donut-label\">总异常</text>\n              <text x=\"70\" y=\"84\" text-anchor=\"middle\" class=\"donut-value\">\n                {{ donutTotal }}\n              </text>\n            </svg>\n            <div class=\"donut-legend\">\n              <div v-for=\"item in donutSeries\" :key=\"item.name\" class=\"legend-item\">\n                <span class=\"legend-dot\" :style=\"{ background: item.color }\"></span>\n                <div class=\"legend-text\">\n                  <span class=\"legend-name\">{{ item.name }}</span>\n                  <span class=\"legend-value\">{{ getDonutPercent(item.value) }}%</span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"card chart-card\">\n        <div class=\"card-header\">\n          <div>\n            <h3 class=\"card-title\">异常点位时间分布</h3>\n            <span class=\"card-subtitle\">按月份分布的航线异常趋势（点击节点查看当月告警）</span>\n          </div>\n          <div class=\"series-legend\">\n            <div v-for=\"serie in lineChart.series\" :key=\"serie.id\" class=\"series-chip\">\n              <span class=\"legend-dot\" :style=\"{ background: serie.color }\"></span>\n              <span class=\"legend-name\">{{ serie.name }}</span>\n            </div>\n          </div>\n        </div>\n        <div class=\"line-chart-wrapper\" v-if=\"lineChart.series.length\">\n          <svg\n            class=\"line-chart\"\n            :viewBox=\"`0 0 ${chartSize.width} ${chartSize.height}`\"\n            preserveAspectRatio=\"none\"\n          >\n            <g class=\"grid-lines\">\n              <line\n                v-for=\"(line, idx) in gridLines\"\n                :key=\"idx\"\n                :x1=\"0\"\n                :y1=\"line.y\"\n                :x2=\"chartSize.width\"\n                :y2=\"line.y\"\n                stroke=\"rgba(255,255,255,0.05)\"\n                stroke-width=\"1\"\n              />\n            </g>\n            <g class=\"chart-series\">\n                <g v-for=\"serie in lineChart.series\" :key=\"serie.id\">\n                  <path\n                    :d=\"getLinePath(serie.data)\"\n                    :stroke=\"serie.color\"\n                    fill=\"none\"\n                    stroke-width=\"3\"\n                    stroke-linecap=\"round\"\n                    stroke-linejoin=\"round\"\n                  />\n                  <g class=\"data-points\">\n                    <g v-for=\"(point, idx) in getLinePoints(serie.data)\" :key=\"point.x + '-' + point.y\">\n                      <circle\n                        :cx=\"point.x\"\n                        :cy=\"point.y\"\n                        :r=\"5\"\n                        :fill=\"getPointColor(serie, idx)\"\n                        stroke=\"rgba(255,255,255,0.8)\"\n                        stroke-width=\"1.5\"\n                        class=\"chart-point\"\n                        @click=\"handlePointClick(serie, idx, $event)\"\n                      />\n                  </g>\n                </g>\n              </g>\n            </g>\n          </svg>\n          <div class=\"x-axis\" :style=\"axisPaddingStyle\">\n            <span v-for=\"label in lineChart.categories\" :key=\"label\">{{ label }}</span>\n          </div>\n        </div>\n        <div v-else class=\"empty-state\">暂无告警数据</div>\n      </div>\n    </div>\n\n    <div v-if=\"detailModal.visible\" class=\"modal-overlay\" @click.self=\"closeDetailModal\">\n      <div class=\"modal-premium detail-modal\">\n        <div class=\"modal-header\">\n          <h3 class=\"modal-title\">{{ detailModal.waylineName }} · {{ detailModal.monthLabel }} 告警</h3>\n          <button @click=\"closeDetailModal\" class=\"modal-close\">×</button>\n        </div>\n        <div class=\"modal-body\">\n          <div v-if=\"detailModal.loading\" class=\"loading-state\">\n            <div class=\"loading-spinner\"></div>\n            <p>正在加载当月告警...</p>\n          </div>\n          <div v-else>\n            <div v-if=\"!detailModal.alarms.length\" class=\"empty-state\">该月份暂无告警</div>\n            <div v-else class=\"detail-list\">\n              <div v-for=\"alarm in detailModal.alarms\" :key=\"alarm.id\" class=\"detail-row\">\n                <div class=\"detail-main\">\n                  <div class=\"detail-title\">{{ alarm.content || '未填写描述' }}</div>\n                  <div class=\"detail-meta\">\n                    <span>时间：{{ formatDateTime(alarm.created_at) }}</span>\n                    <span>航线：{{ resolveWaylineName(alarm) }}</span>\n                    <span v-if=\"alarm.latitude && alarm.longitude\">坐标：{{ alarm.latitude }}, {{ alarm.longitude }}</span>\n                  </div>\n                </div>\n                <div class=\"detail-badges\">\n                  <span class=\"status-pill\">ID: {{ alarm.id }}</span>\n                  <span class=\"status-pill\">{{ alarm.status || '未知状态' }}</span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class=\"modal-footer\">\n          <button @click=\"closeDetailModal\" class=\"modal-btn secondary-btn\">关闭</button>\n        </div>\n      </div>\n    </div>\n\n        <div\n          v-if=\"selectionMenu.visible\"\n          class=\"selection-pop\"\n          :style=\"{ top: `${selectionMenu.y}px`, left: `${selectionMenu.x}px` }\"\n        >\n      <div class=\"selection-header\">\n        <span>选择航线查看当月告警</span>\n        <button class=\"close-btn\" @click=\"selectionMenu.visible = false\">×</button>\n      </div>\n      <div class=\"selection-options\">\n        <button\n          v-for=\"option in selectionMenu.options\"\n          :key=\"option.id\"\n          class=\"selection-item\"\n          @click=\"selectSeriesOption(option)\"\n        >\n          <span class=\"legend-dot\" :style=\"{ background: option.color || '#38bdf8' }\"></span>\n          <span class=\"option-name\">{{ option.name }}</span>\n          <span class=\"option-value\">{{ option.data?.[selectionMenu.monthIndex] || 0 }} 条</span>\n        </button>\n          </div>\n        </div>\n\n    <div\n      v-if=\"emptyTip.visible\"\n      class=\"selection-pop\"\n      :style=\"{ top: `${emptyTip.y}px`, left: `${emptyTip.x}px` }\"\n    >\n      <div class=\"selection-header\">\n        <span>{{ emptyTip.text }}</span>\n        <button class=\"close-btn\" @click=\"emptyTip.visible = false\">×</button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport alarmApi from '../api/alarmApi'\n\nexport default {\n  name: 'AlarmStats',\n  data() {\n    return {\n      loading: true,\n      error: '',\n      lastUpdated: '',\n      months: [],\n      waylines: [],\n      waylineNameMap: {},\n      stats: {\n        safetyDays: 0,\n        totalAlarms: 0,\n        todayAlarms: 0,\n        totalMileage: '--',\n        todayMileage: '--'\n      },\n      safetyStatuses: [\n        { label: '同里程位', value: 0, color: '#38bdf8' },\n        { label: '重要点位', value: 0, color: '#a855f7' },\n        { label: '安全位', value: 0, color: '#22c55e' }\n      ],\n      metrics: [],\n      lineChart: {\n        categories: [],\n        series: []\n      },\n      donutSeries: [],\n      chartSize: {\n        width: 1080,\n        height: 320\n      },\n      chartPaddingX: 28,\n      chartPaddingY: 16,\n      latestAlarmDate: null,\n      windowAlarms: [],\n      detailModal: {\n        visible: false,\n        loading: false,\n        waylineId: null,\n        waylineName: '',\n        monthLabel: '',\n        alarms: []\n      },\n      // 高对比度调色板（顺序循环使用）\n      seriesColors: [\n        '#20A4F3', // 鲜亮蓝\n        '#FF6B6B', // 亮红\n        '#7C3AED', // 深紫\n        '#16A34A', // 纯绿\n        '#F59E0B', // 琥珀橙\n        '#0EA5E9', // 青蓝\n        '#EF4444', // 鲜红\n        '#14B8A6', // 松石绿\n        '#8B5CF6', // 紫罗兰\n        '#F97316', // 亮橙\n        '#22C55E', // 草绿\n        '#C026D3'  // 品红\n      ],\n      selectionMenu: {\n        visible: false,\n        options: [],\n        monthIndex: null,\n        x: 0,\n        y: 0\n      },\n      overlapColor: '#ffffff',\n      emptyTip: {\n        visible: false,\n        text: '暂无告警信息',\n        x: 0,\n        y: 0\n      }\n    }\n  },\n  computed: {\n    donutTotal() {\n      return this.donutSeries.reduce((sum, item) => sum + item.value, 0)\n    },\n    maxLineValue() {\n      const values = this.lineChart.series.flatMap(item => item.data)\n      return Math.max(...values, 1)\n    },\n    gridLines() {\n      const lines = []\n      const steps = 5\n      const innerHeight = Math.max(this.chartSize.height - this.chartPaddingY * 2, 1)\n      for (let i = 0; i <= steps; i++) {\n        const y = this.chartPaddingY + (innerHeight / steps) * i\n        lines.push({ y })\n      }\n      return lines\n    },\n    axisPaddingStyle() {\n      return {\n        paddingLeft: `${this.chartPaddingX}px`,\n        paddingRight: `${this.chartPaddingX}px`\n      }\n    }\n  },\n  mounted() {\n    this.loadData()\n  },\n  methods: {\n    async loadData() {\n      this.loading = true\n      this.error = ''\n      try {\n        // 先获取最新告警时间，用作时间轴锚点\n        const latest = await this.fetchLatestCreatedAt()\n        this.initMonths(latest || new Date())\n        await Promise.all([this.fetchWaylines(), this.fetchAndAggregateAlarms()])\n        if (!this.lastUpdated && latest) {\n          this.lastUpdated = this.formatDateTime(latest)\n        }\n      } catch (err) {\n        console.error('加载告警统计失败', err)\n        this.error = '加载告警统计失败，请稍后重试'\n      } finally {\n        this.loading = false\n      }\n    },\n    initMonths(baseDate = new Date()) {\n      const months = []\n      const anchor = this.parsePlainDate(baseDate) || new Date()\n      for (let i = 11; i >= 0; i--) {\n        const date = new Date(anchor.getFullYear(), anchor.getMonth() - i, 1)\n        const start = new Date(date.getFullYear(), date.getMonth(), 1, 0, 0, 0, 0)\n        const end = new Date(date.getFullYear(), date.getMonth() + 1, 0, 23, 59, 59, 999)\n        months.push({\n          label: `${date.getMonth() + 1}月`,\n          key: `${date.getFullYear()}-${date.getMonth()}`,\n          start,\n          end\n        })\n      }\n      this.months = months\n      this.lineChart.categories = months.map(m => m.label)\n    },\n    async fetchWaylines() {\n      try {\n        const res = await alarmApi.getWaylines()\n        const list = this.normalizeList(res)\n        this.waylines = list\n        this.waylineNameMap = list.reduce((map, item) => {\n          const id = item.wayline_id || item.id\n          if (id !== undefined && id !== null) {\n            map[id] = item.name || `航线${id}`\n          }\n          return map\n        }, {})\n      } catch (err) {\n        console.warn('加载航线列表失败，使用空列表', err)\n        this.waylines = []\n        this.waylineNameMap = {}\n      }\n    },\n    normalizeList(res) {\n      if (!res) return []\n      if (Array.isArray(res)) return res\n      if (res.results) return res.results\n      if (res.data) return res.data\n      return []\n    },\n    resolveWaylineId(alarm) {\n      return (\n        alarm?.wayline_id ??\n        alarm?.wayline?.id ??\n        alarm?.wayline?.wayline_id ??\n        alarm?.wayline_details?.id ??\n        alarm?.wayline_details?.wayline_id ??\n        null\n      )\n    },\n    resolveWaylineName(alarm) {\n      const id = this.resolveWaylineId(alarm)\n      return (\n        alarm?.wayline?.name ||\n        alarm?.wayline_details?.name ||\n        this.waylineNameMap[id] ||\n        (id ? `航线${id}` : '未知航线')\n      )\n    },\n    async fetchAndAggregateAlarms() {\n      // 若已有时间窗口，用其开始结束做服务端过滤，避免漏数据；否则先取全部再重建窗口\n      const hasWindow = this.months.length > 0\n      const params = { page_size: 20000 }\n      if (hasWindow) {\n        params.start_date = this.formatDateParam(this.months[0].start)\n        params.end_date = this.formatDateParam(this.months[this.months.length - 1].end)\n      }\n\n      const alarms = await this.fetchAllAlarms(params)\n      const latest = this.getLatestCreatedAt(alarms)\n\n      // 用最新告警时间重建月份范围\n      const anchor = latest || this.latestAlarmDate || new Date()\n      this.initMonths(anchor)\n\n      // 过滤出窗口内的数据再聚合（按时间范围判定月份）\n      const inWindowAlarms = alarms.filter(item => this.getMonthIndexFromString(item.created_at) !== -1)\n      this.windowAlarms = inWindowAlarms\n\n      this.buildStatsFromAlarms(inWindowAlarms)\n      this.buildSeries(inWindowAlarms)\n\n      if (latest) {\n        this.lastUpdated = this.formatDateTime(latest)\n      } else if (!this.lastUpdated && this.latestAlarmDate) {\n        this.lastUpdated = this.formatDateTime(this.latestAlarmDate)\n      }\n    },\n    async fetchAllAlarms(baseParams) {\n      const pageSize = baseParams.page_size || 20000\n      let page = 1\n      const collected = []\n      let hasNext = true\n      let totalCount = null\n      // 分页抓取：优先看 next，其次看 count，再看页大小\n      while (hasNext) {\n        const res = await alarmApi.getAlarms({ ...baseParams, page, page_size: pageSize })\n        const list = this.normalizeList(res)\n        collected.push(...list)\n\n        if (totalCount === null && res && typeof res.count === 'number') {\n          totalCount = res.count\n        }\n\n        const hasNextFlag = Boolean(res && res.next)\n        const needByCount = totalCount !== null ? collected.length < totalCount : false\n        const needBySize = list.length === pageSize\n\n        hasNext = hasNextFlag || needByCount || needBySize\n        if (!hasNext) break\n        page += 1\n      }\n      return collected\n    },\n    async fetchLatestCreatedAt() {\n      try {\n        const res = await alarmApi.getAlarms({ page_size: 1, ordering: '-created_at' })\n        const list = this.normalizeList(res)\n        if (list.length && list[0].created_at) {\n          const ts = this.parsePlainDate(list[0].created_at)\n          this.latestAlarmDate = ts\n          this.lastUpdated = this.formatDateTime(ts)\n          return ts\n        }\n      } catch (err) {\n        console.warn('获取最新告警时间失败', err)\n      }\n      return null\n    },\n    buildStatsFromAlarms(alarms) {\n      this.stats.totalAlarms = alarms.length\n      const todayKey = this.formatDateParam(new Date())\n      this.stats.todayAlarms = alarms.filter(item => this.formatDateParam(this.parsePlainDate(item.created_at)) === todayKey).length\n      const oldest = alarms.reduce((oldestTs, alarm) => {\n        const ts = this.parsePlainDate(alarm.created_at)\n        if (Number.isNaN(ts.getTime())) return oldestTs\n        if (!oldestTs) return ts\n        return ts < oldestTs ? ts : oldestTs\n      }, null)\n      if (oldest) {\n        const now = Date.now()\n        const diffDays = Math.floor((now - oldest.getTime()) / (1000 * 60 * 60 * 24))\n        this.stats.safetyDays = Math.max(diffDays, 0)\n      } else {\n        this.stats.safetyDays = 0\n      }\n      this.safetyStatuses = [\n        { label: '今日异常', value: this.stats.todayAlarms, color: '#38bdf8' },\n        { label: '近月异常', value: alarms.filter(a => this.isInCurrentMonth(a.created_at)).length, color: '#a855f7' },\n        { label: '全年异常', value: this.stats.totalAlarms, color: '#22c55e' }\n      ]\n      this.metrics = [\n        { label: '发现异常总数', value: this.stats.totalAlarms, trend: 'up', delta: '' },\n        { label: '今日发现异常数', value: this.stats.todayAlarms, trend: this.stats.todayAlarms ? 'up' : 'flat', delta: this.stats.todayAlarms ? `+${this.stats.todayAlarms}` : '持平' },\n        { label: '巡检总里程', value: this.stats.totalMileage, trend: 'flat', delta: '' },\n        { label: '今日巡检里程', value: this.stats.todayMileage, trend: 'flat', delta: '' }\n      ]\n    },\n    isInCurrentMonth(dateLike) {\n      const dt = this.parsePlainDate(dateLike)\n      const now = new Date()\n      return dt.getFullYear() === now.getFullYear() && dt.getMonth() === now.getMonth()\n    },\n    buildSeries(alarms) {\n      const seriesMap = new Map()\n      alarms.forEach(alarm => {\n        const waylineId = this.resolveWaylineId(alarm)\n        if (waylineId === null || waylineId === undefined) return\n        const monthIndex = this.getMonthIndexFromString(alarm.created_at)\n        if (monthIndex === -1) return\n        if (!seriesMap.has(waylineId)) {\n          seriesMap.set(waylineId, {\n            id: waylineId,\n            name: this.resolveWaylineName(alarm),\n            data: Array(this.months.length).fill(0)\n          })\n        }\n        seriesMap.get(waylineId).data[monthIndex] += 1\n      })\n\n      const series = Array.from(seriesMap.values())\n      series.sort((a, b) => b.data.reduce((sum, n) => sum + n, 0) - a.data.reduce((sum, n) => sum + n, 0))\n      series.forEach((item, idx) => {\n        item.color = this.getSeriesColor(idx)\n      })\n      this.lineChart.series = series\n      this.lineChart.categories = this.months.map(m => m.label)\n\n      this.donutSeries = series.map(item => ({\n        name: item.name,\n        value: item.data.reduce((sum, n) => sum + n, 0),\n        color: item.color\n      }))\n    },\n    getSeriesColor(index) {\n      return this.seriesColors[index % this.seriesColors.length]\n    },\n    getDonutDash(value) {\n      const circumference = 2 * Math.PI * 44\n      const length = (value / (this.donutTotal || 1)) * circumference\n      return `${length} ${circumference}`\n    },\n    getDonutOffset(index) {\n      const circumference = 2 * Math.PI * 44\n      const previous = this.donutSeries.slice(0, index).reduce((sum, item) => sum + item.value, 0)\n      return -((previous / (this.donutTotal || 1)) * circumference)\n    },\n    getDonutPercent(value) {\n      if (!this.donutTotal) return 0\n      return Math.round((value / this.donutTotal) * 100)\n    },\n    getLinePoints(seriesData) {\n      const count = this.lineChart.categories.length || 1\n      const innerWidth = Math.max(this.chartSize.width - this.chartPaddingX * 2, 1)\n      const innerHeight = Math.max(this.chartSize.height - this.chartPaddingY * 2, 1)\n      const max = this.maxLineValue || 1\n      const step = count > 1 ? innerWidth / (count - 1) : innerWidth\n      return seriesData.map((value, idx) => {\n        const x =\n          count > 1\n            ? this.chartPaddingX + step * idx\n            : this.chartPaddingX + innerWidth / 2\n        const y = this.chartPaddingY + innerHeight - (value / max) * innerHeight\n        return { x, y }\n      })\n    },\n    getLinePath(seriesData) {\n      const points = this.getLinePoints(seriesData)\n      if (!points.length) return ''\n      const [first, ...rest] = points\n      const pathParts = rest.map(point => `L ${point.x} ${point.y}`)\n      return `M ${first.x} ${first.y} ${pathParts.join(' ')}`\n    },\n    getLatestCreatedAt(list) {\n      const latest = list.reduce((acc, item) => {\n        const ts = this.parsePlainDate(item.created_at)\n        if (Number.isNaN(ts.getTime())) return acc\n        if (!acc) return ts\n        return ts > acc ? ts : acc\n      }, null)\n      return latest\n    },\n    handlePointClick(serie, monthIndex, event) {\n      const month = this.months[monthIndex]\n      if (!month) return\n      const value = serie.data?.[monthIndex] || 0\n      if (!value) {\n        this.selectionMenu.visible = false\n        this.showEmptyTip(event, '该月份无告警信息')\n        return\n      }\n      const pointValue = serie.data?.[monthIndex] || 0\n      const candidates = this.lineChart.series.filter(item => {\n        const v = item.data?.[monthIndex] || 0\n        return v > 0 && v === pointValue\n      })\n      if (candidates.length <= 1 || !event) {\n        return this.openDetailFor(serie, monthIndex)\n      }\n      this.selectionMenu.visible = true\n      this.selectionMenu.options = candidates\n      this.selectionMenu.monthIndex = monthIndex\n      this.selectionMenu.x = event.clientX + 12\n      this.selectionMenu.y = event.clientY + 12 + window.scrollY\n    },\n    async openDetailFor(serie, monthIndex) {\n      const month = this.months[monthIndex]\n      if (!month) return\n      this.selectionMenu.visible = false\n      this.detailModal.visible = true\n      this.detailModal.loading = true\n      this.detailModal.alarms = []\n      this.detailModal.waylineId = serie.id\n      this.detailModal.waylineName = serie.name\n      this.detailModal.monthLabel = month.label\n      try {\n      // 先使用已加载的数据，避免接口筛选造成偏差\n      const filtered = this.windowAlarms.filter(alarm => {\n        const waylineId = this.resolveWaylineId(alarm)\n        const idx = this.getMonthIndexFromString(alarm.created_at)\n        return waylineId === serie.id && idx === monthIndex\n      })\n        if (filtered.length) {\n          this.detailModal.alarms = filtered\n        } else {\n          const res = await alarmApi.getAlarms({\n            wayline_id: serie.id,\n            start_date: this.formatDateParam(month.start),\n            end_date: this.formatDateParam(month.end),\n            page_size: 500\n          })\n          this.detailModal.alarms = this.normalizeList(res)\n        }\n      } catch (err) {\n        console.error('加载单月告警失败', err)\n        this.detailModal.alarms = []\n      } finally {\n        this.detailModal.loading = false\n      }\n    },\n    selectSeriesOption(option) {\n      const monthIdx = this.selectionMenu.monthIndex\n      this.selectionMenu.visible = false\n      if (option) {\n        this.openDetailFor(option, monthIdx)\n      }\n    },\n    closeDetailModal() {\n      this.detailModal.visible = false\n    },\n    formatDateTime(dateLike) {\n      if (typeof dateLike === 'string') {\n        const trimmed = dateLike.trim().replace('T', ' ')\n        const noMs = trimmed.split('.')[0]\n        return noMs || trimmed\n      }\n      const dt = this.parsePlainDate(dateLike)\n      if (Number.isNaN(dt.getTime())) return '--'\n      const pad = num => String(num).padStart(2, '0')\n      return `${dt.getFullYear()}-${pad(dt.getMonth() + 1)}-${pad(dt.getDate())} ${pad(dt.getHours())}:${pad(dt.getMinutes())}`\n    },\n    formatDateParam(date) {\n      const dt = this.parsePlainDate(date)\n      const pad = num => String(num).padStart(2, '0')\n      return `${dt.getFullYear()}-${pad(dt.getMonth() + 1)}-${pad(dt.getDate())}`\n    },\n    getMonthIndexForDate(dt) {\n      return this.months.findIndex(m => dt >= m.start && dt <= m.end)\n    },\n    getMonthIndexFromString(dateLike) {\n      const dt = this.parsePlainDate(dateLike)\n      if (!dt || Number.isNaN(dt.getTime())) return -1\n      return this.getMonthIndexForDate(dt)\n    },\n    parsePlainDate(dateLike) {\n      if (typeof dateLike === 'string') {\n        const parts = this.parseDateParts(dateLike)\n        if (parts) return this.buildDateFromParts(parts)\n      }\n      const dt = new Date(dateLike)\n      return dt\n    },\n    parseDateParts(dateLike) {\n      if (typeof dateLike !== 'string') return null\n      const raw = dateLike.trim()\n      const cleaned = raw.replace(/([+-]\\d{2}:?\\d{2}|Z)$/i, '')\n      const match = cleaned.match(/^(\\d{4})-(\\d{2})-(\\d{2})[ T](\\d{2}):(\\d{2})(?::(\\d{2})(?:\\.(\\d+))?)?/)\n      if (!match) return null\n      const [, y, m, d, h, mi, s, ms = '0'] = match\n      return {\n        year: Number(y),\n        month: Number(m),\n        day: Number(d),\n        hour: Number(h),\n        minute: Number(mi),\n        second: Number(s || 0),\n        milli: Number(String(ms).padEnd(3, '0').slice(0, 3))\n      }\n    },\n    buildDateFromParts(parts) {\n      return new Date(\n        parts.year,\n        parts.month - 1,\n        parts.day,\n        parts.hour,\n        parts.minute,\n        parts.second,\n        parts.milli || 0\n      )\n    },\n    getPointColor(serie, monthIndex) {\n      // 若该月有多个航线点且值相同，使用重叠色\n      const targetValue = serie.data?.[monthIndex] || 0\n      if (!targetValue) return serie.color\n      const overlaps = this.lineChart.series.filter(s => {\n        const v = s.data?.[monthIndex] || 0\n        return v === targetValue && v > 0\n      })\n      if (overlaps.length > 1) {\n        return this.overlapColor\n      }\n      return serie.color\n    }\n  }\n}\n</script>\n\n<style scoped>\n.alarm-stats-page {\n  max-width: 1640px;\n  margin: 0 auto;\n  padding: 24px 18px 48px;\n  color: #e2e8f0;\n  font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;\n}\n\n.page-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 24px;\n  margin-bottom: 24px;\n}\n\n.title-block {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n}\n\n.page-kicker {\n  color: #7dd3fc;\n  letter-spacing: 2px;\n  font-size: 13px;\n  text-transform: uppercase;\n}\n\n.page-title {\n  font-size: 32px;\n  font-weight: 800;\n  color: #e0f2fe;\n  letter-spacing: 1px;\n}\n\n.page-subtitle {\n  color: #94a3b8;\n  font-size: 14px;\n}\n\n.header-meta {\n  display: flex;\n  gap: 12px;\n  flex-wrap: wrap;\n}\n\n.meta-chip {\n  padding: 10px 14px;\n  background: rgba(51, 65, 85, 0.6);\n  border: 1px solid rgba(56, 189, 248, 0.35);\n  border-radius: 12px;\n  min-width: 160px;\n  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);\n}\n\n.meta-label {\n  display: block;\n  color: #94a3b8;\n  font-size: 12px;\n  margin-bottom: 4px;\n}\n\n.meta-value {\n  color: #e0f2fe;\n  font-weight: 700;\n}\n\n.top-grid {\n  display: grid;\n  grid-template-columns: 1.25fr 1.1fr 1fr;\n  gap: 16px;\n  margin-bottom: 16px;\n}\n\n.card {\n  position: relative;\n  background: linear-gradient(145deg, rgba(15, 23, 50, 0.95) 0%, rgba(15, 23, 42, 0.7) 100%);\n  border: 1px solid rgba(59, 130, 246, 0.25);\n  border-radius: 16px;\n  overflow: hidden;\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35), 0 0 60px rgba(56, 189, 248, 0.12);\n  backdrop-filter: blur(6px);\n}\n\n.hero-card {\n  background: linear-gradient(135deg, rgba(12, 74, 110, 0.85), rgba(30, 64, 175, 0.85));\n  min-height: 220px;\n}\n\n.hero-overlay {\n  position: absolute;\n  inset: 0;\n  background:\n    radial-gradient(circle at 80% 20%, rgba(56, 189, 248, 0.35), transparent 45%),\n    radial-gradient(circle at 20% 80%, rgba(94, 234, 212, 0.25), transparent 40%);\n  filter: blur(10px);\n  opacity: 0.8;\n}\n\n.hero-content {\n  position: relative;\n  padding: 22px 24px;\n  display: flex;\n  flex-direction: column;\n  gap: 18px;\n  z-index: 1;\n}\n\n.hero-header {\n  display: flex;\n  align-items: flex-start;\n  justify-content: space-between;\n}\n\n.hero-label {\n  color: #cbd5e1;\n  font-size: 14px;\n  letter-spacing: 1px;\n}\n\n.hero-number {\n  font-size: 48px;\n  font-weight: 800;\n  color: #e0f2fe;\n  text-shadow: 0 0 16px rgba(14, 165, 233, 0.7);\n}\n\n.hero-unit {\n  font-size: 16px;\n  color: #bae6fd;\n  margin-left: 6px;\n}\n\n.hero-tag {\n  padding: 8px 12px;\n  background: rgba(59, 130, 246, 0.2);\n  border: 1px solid rgba(59, 130, 246, 0.4);\n  border-radius: 999px;\n  color: #e0f2fe;\n  font-size: 12px;\n}\n\n.hero-summary {\n  display: flex;\n  gap: 12px;\n  flex-wrap: wrap;\n}\n\n.summary-chip {\n  display: inline-flex;\n  align-items: center;\n  gap: 8px;\n  padding: 10px 12px;\n  background: rgba(15, 23, 42, 0.35);\n  border: 1px solid rgba(255, 255, 255, 0.08);\n  border-radius: 12px;\n  color: #cbd5e1;\n}\n\n.chip-dot {\n  width: 10px;\n  height: 10px;\n  border-radius: 999px;\n}\n\n.chip-label {\n  font-size: 13px;\n}\n\n.chip-value {\n  font-size: 16px;\n  font-weight: 700;\n  color: #e2e8f0;\n}\n\n.card-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 16px 18px 8px;\n}\n\n.card-title {\n  font-size: 18px;\n  font-weight: 700;\n  color: #e0f2fe;\n}\n\n.card-subtitle {\n  color: #94a3b8;\n  font-size: 13px;\n}\n\n.metrics-card {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n.metrics-grid {\n  display: grid;\n  grid-template-columns: repeat(2, minmax(0, 1fr));\n  gap: 12px;\n  padding: 0 16px 16px;\n}\n\n.metric-item {\n  background: rgba(15, 23, 42, 0.4);\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  border-radius: 12px;\n  padding: 14px;\n  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.04);\n}\n\n.metric-label {\n  color: #94a3b8;\n  font-size: 13px;\n  margin-bottom: 6px;\n  letter-spacing: 0.3px;\n}\n\n.metric-value {\n  font-size: 20px;\n  font-weight: 700;\n  color: #e0f2fe;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.metric-trend {\n  font-size: 12px;\n  padding: 4px 8px;\n  border-radius: 999px;\n  background: rgba(59, 130, 246, 0.15);\n  border: 1px solid rgba(59, 130, 246, 0.35);\n}\n\n.metric-trend.up {\n  color: #22d3ee;\n}\n\n.metric-trend.down {\n  color: #f97316;\n}\n\n.metric-trend.flat {\n  color: #cbd5e1;\n}\n\n.donut-card {\n  display: flex;\n  flex-direction: column;\n}\n\n.donut-content {\n  display: flex;\n  gap: 12px;\n  padding: 4px 14px 16px;\n  align-items: center;\n}\n\n.donut-chart {\n  width: 180px;\n  height: 180px;\n  flex-shrink: 0;\n}\n\n.donut-track {\n  opacity: 0.7;\n}\n\n.donut-segment {\n  transition: opacity 0.2s ease;\n}\n\n.donut-card:hover .donut-segment {\n  opacity: 0.85;\n}\n\n.donut-label {\n  fill: #94a3b8;\n  font-size: 12px;\n  letter-spacing: 1px;\n}\n\n.donut-value {\n  fill: #e0f2fe;\n  font-size: 22px;\n  font-weight: 800;\n}\n\n.donut-legend {\n  display: grid;\n  grid-template-columns: repeat(2, minmax(0, 1fr));\n  gap: 8px 16px;\n  width: 100%;\n}\n\n.legend-item {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  background: rgba(15, 23, 42, 0.35);\n  border: 1px solid rgba(255, 255, 255, 0.06);\n  border-radius: 12px;\n  padding: 10px 12px;\n}\n\n.legend-dot {\n  width: 10px;\n  height: 10px;\n  border-radius: 999px;\n}\n\n.legend-text {\n  display: flex;\n  justify-content: space-between;\n  width: 100%;\n  color: #cbd5e1;\n  font-size: 13px;\n}\n\n.legend-name {\n  font-weight: 600;\n}\n\n.legend-value {\n  color: #e0f2fe;\n  font-weight: 700;\n}\n\n.chart-card {\n  margin-top: 12px;\n  padding-bottom: 12px;\n}\n\n.series-legend {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n\n.series-chip {\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n  padding: 6px 10px;\n  background: rgba(15, 23, 42, 0.45);\n  border: 1px solid rgba(255, 255, 255, 0.08);\n  border-radius: 10px;\n  color: #cbd5e1;\n  font-size: 12px;\n}\n\n.line-chart-wrapper {\n  padding: 6px 14px 16px;\n}\n\n.line-chart {\n  width: 100%;\n  height: auto;\n}\n\n.grid-lines line {\n  stroke-dasharray: 4 4;\n}\n\n.x-axis {\n  display: flex;\n  justify-content: space-between;\n  color: #94a3b8;\n  font-size: 12px;\n  margin-top: 6px;\n}\n\n.x-axis span {\n  text-align: center;\n}\n\n.loading-state {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 12px;\n  padding: 24px;\n  color: #cbd5e1;\n}\n\n.loading-spinner {\n  width: 28px;\n  height: 28px;\n  border: 3px solid rgba(56, 189, 248, 0.3);\n  border-top-color: #38bdf8;\n  border-radius: 999px;\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n\n.error-state {\n  margin-bottom: 16px;\n  padding: 12px 16px;\n  border-radius: 12px;\n  background: rgba(248, 113, 113, 0.1);\n  border: 1px solid rgba(248, 113, 113, 0.4);\n  color: #fecaca;\n}\n\n.empty-state {\n  padding: 18px;\n  text-align: center;\n  color: #94a3b8;\n}\n\n.chart-point {\n  cursor: pointer;\n  transition: r 0.15s ease, opacity 0.15s ease;\n}\n\n.chart-point:hover {\n  r: 7;\n  opacity: 0.95;\n}\n\n.selection-pop {\n  position: absolute;\n  z-index: 1500;\n  min-width: 220px;\n  background: rgba(15, 23, 42, 0.95);\n  border: 1px solid rgba(59, 130, 246, 0.3);\n  border-radius: 12px;\n  box-shadow: 0 16px 40px rgba(0, 0, 0, 0.35);\n  overflow: hidden;\n}\n\n.selection-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 10px 12px;\n  color: #e0f2fe;\n  font-size: 13px;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.06);\n}\n\n.selection-header .close-btn {\n  background: transparent;\n  border: none;\n  color: #cbd5e1;\n  font-size: 18px;\n  cursor: pointer;\n}\n\n.selection-options {\n  display: flex;\n  flex-direction: column;\n  max-height: 260px;\n  overflow: auto;\n}\n\n.selection-item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 10px 12px;\n  background: transparent;\n  border: none;\n  color: #e2e8f0;\n  cursor: pointer;\n  text-align: left;\n}\n\n.selection-item:hover {\n  background: rgba(59, 130, 246, 0.08);\n}\n\n.selection-item .option-name {\n  flex: 1;\n  font-weight: 600;\n}\n\n.selection-item .option-value {\n  color: #94a3b8;\n  font-size: 12px;\n}\n.modal-overlay {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.55);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1200;\n}\n\n.modal-premium {\n  background: rgba(15, 23, 42, 0.95);\n  border: 1px solid rgba(59, 130, 246, 0.3);\n  border-radius: 16px;\n  width: min(1080px, 90vw);\n  max-height: 80vh;\n  overflow: hidden;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);\n}\n\n.detail-modal {\n  display: flex;\n  flex-direction: column;\n}\n\n.modal-header {\n  padding: 16px 18px;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.06);\n}\n\n.modal-title {\n  color: #e0f2fe;\n  font-size: 18px;\n  font-weight: 700;\n}\n\n.modal-close {\n  background: transparent;\n  border: none;\n  color: #cbd5e1;\n  font-size: 22px;\n  cursor: pointer;\n}\n\n.modal-body {\n  padding: 16px 18px;\n  overflow: auto;\n}\n\n.modal-footer {\n  padding: 12px 18px 16px;\n  border-top: 1px solid rgba(255, 255, 255, 0.06);\n  display: flex;\n  justify-content: flex-end;\n  gap: 10px;\n}\n\n.modal-btn {\n  padding: 10px 16px;\n  border-radius: 10px;\n  border: 1px solid rgba(59, 130, 246, 0.4);\n  background: rgba(59, 130, 246, 0.2);\n  color: #e0f2fe;\n  cursor: pointer;\n}\n\n.secondary-btn {\n  background: rgba(148, 163, 184, 0.15);\n  border-color: rgba(148, 163, 184, 0.4);\n}\n\n.detail-list {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n\n.detail-row {\n  display: flex;\n  justify-content: space-between;\n  gap: 10px;\n  padding: 12px 14px;\n  border: 1px solid rgba(255, 255, 255, 0.08);\n  border-radius: 12px;\n  background: rgba(15, 23, 42, 0.4);\n}\n\n.detail-title {\n  font-weight: 700;\n  color: #e2e8f0;\n  margin-bottom: 6px;\n}\n\n.detail-meta {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  color: #94a3b8;\n  font-size: 12px;\n}\n\n.detail-badges {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  align-items: flex-end;\n}\n\n.status-pill {\n  padding: 6px 10px;\n  background: rgba(59, 130, 246, 0.15);\n  border: 1px solid rgba(59, 130, 246, 0.25);\n  border-radius: 10px;\n  color: #cbd5e1;\n  font-size: 12px;\n}\n\n@media (max-width: 1280px) {\n  .top-grid {\n    grid-template-columns: 1fr;\n  }\n\n  .donut-content {\n    flex-direction: column;\n    align-items: flex-start;\n  }\n\n  .donut-legend {\n    grid-template-columns: repeat(3, minmax(0, 1fr));\n  }\n}\n\n@media (max-width: 960px) {\n  .page-header {\n    flex-direction: column;\n    align-items: flex-start;\n  }\n\n  .donut-legend {\n    grid-template-columns: repeat(2, minmax(0, 1fr));\n  }\n}\n\n@media (max-width: 640px) {\n  .alarm-stats-page {\n    padding: 16px 12px 32px;\n  }\n\n  .metrics-grid {\n    grid-template-columns: 1fr;\n  }\n\n  .donut-legend {\n    grid-template-columns: 1fr;\n  }\n\n  .detail-row {\n    flex-direction: column;\n  }\n\n  .detail-badges {\n    flex-direction: row;\n  }\n}\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}