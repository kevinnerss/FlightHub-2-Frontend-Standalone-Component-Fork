{"ast":null,"code":"import { createRouter, createWebHistory } from 'vue-router';\n\n// 懒加载路由组件\nconst Login = () => import('../views/Login.vue');\nconst UserManagement = () => import('../views/UserManagement.vue');\nconst DjiDashboard = () => import('../views/DjiDashboard.vue');\nconst AlarmManagement = () => import('../views/AlarmManagement.vue');\nconst routes = [{\n  path: '/login',\n  name: 'Login',\n  component: Login,\n  meta: {\n    title: '登录',\n    requiresAuth: false\n  }\n}, {\n  path: '/user-management',\n  name: 'UserManagement',\n  component: UserManagement,\n  meta: {\n    title: '人员管理',\n    requiresAuth: true,\n    requiresAdmin: true\n  }\n}, {\n  path: '/',\n  name: 'DjiDashboard',\n  component: DjiDashboard,\n  meta: {\n    title: '主控台',\n    requiresAuth: true\n  }\n}, {\n  path: '/alarm-management',\n  name: 'AlarmManagement',\n  component: AlarmManagement,\n  meta: {\n    title: '告警管理',\n    requiresAuth: true\n  }\n},\n// 404页面\n{\n  path: '/:pathMatch(.*)*',\n  redirect: '/'\n}];\nconst router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes\n});\n\n// 全局前置守卫 - 实现认证和授权控制\nrouter.beforeEach((to, from, next) => {\n  // 设置页面标题\n  document.title = to.meta.title || '无人机巡检数字孪生系统';\n\n  // 获取认证状态\n  const isAuthenticated = localStorage.getItem('token') !== null;\n\n  // 检查是否需要认证\n  if (to.meta.requiresAuth && !isAuthenticated) {\n    // 未认证且需要认证，跳转到登录页\n    return next({\n      name: 'Login',\n      query: {\n        redirect: to.fullPath\n      }\n    });\n  }\n\n  // 检查是否需要管理员权限\n  if (to.meta.requiresAdmin) {\n    // 从localStorage获取用户角色信息\n    const userStr = localStorage.getItem('userInfo');\n    let isAdmin = false;\n    if (userStr) {\n      try {\n        const userInfo = JSON.parse(userStr);\n        isAdmin = userInfo.role === 'admin';\n      } catch (e) {\n        console.error('解析用户信息失败:', e);\n      }\n    }\n    if (!isAdmin) {\n      // 没有管理员权限，跳转到首页\n      return next({\n        name: 'DjiDashboard'\n      });\n    }\n  }\n\n  // 已认证用户访问登录页时，重定向到首页\n  if (to.name === 'Login' && isAuthenticated) {\n    return next({\n      name: 'DjiDashboard'\n    });\n  }\n  next();\n});\nexport default router;","map":{"version":3,"names":["createRouter","createWebHistory","Login","UserManagement","DjiDashboard","AlarmManagement","routes","path","name","component","meta","title","requiresAuth","requiresAdmin","redirect","router","history","process","env","BASE_URL","beforeEach","to","from","next","document","isAuthenticated","localStorage","getItem","query","fullPath","userStr","isAdmin","userInfo","JSON","parse","role","e","console","error"],"sources":["D:/projects/FlightHub-2-Frontend-Standalone-Component/frontend/src/router/index.js"],"sourcesContent":["import { createRouter, createWebHistory } from 'vue-router'\n\n// 懒加载路由组件\nconst Login = () => import('../views/Login.vue')\nconst UserManagement = () => import('../views/UserManagement.vue')\nconst DjiDashboard = () => import('../views/DjiDashboard.vue')\n\nconst AlarmManagement = () => import('../views/AlarmManagement.vue')\n\n\n\nconst routes = [\n  {\n    path: '/login',\n    name: 'Login',\n    component: Login,\n    meta: {\n      title: '登录',\n      requiresAuth: false\n    }\n  },\n  \n  {\n    path: '/user-management',\n    name: 'UserManagement',\n    component: UserManagement,\n    meta: {\n      title: '人员管理',\n      requiresAuth: true,\n      requiresAdmin: true\n    }\n  },\n\n  {\n    path: '/',\n    name: 'DjiDashboard',\n    component: DjiDashboard,\n    meta: {\n      title: '主控台',\n      requiresAuth: true\n    }\n  },\n\n  {\n    path: '/alarm-management',\n    name: 'AlarmManagement',\n    component: AlarmManagement,\n    meta: {\n      title: '告警管理',\n      requiresAuth: true\n    }\n  },\n\n\n  \n  // 404页面\n  {\n    path: '/:pathMatch(.*)*',\n    redirect: '/'\n  }\n]\n\nconst router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes\n})\n\n// 全局前置守卫 - 实现认证和授权控制\nrouter.beforeEach((to, from, next) => {\n  // 设置页面标题\n  document.title = to.meta.title || '无人机巡检数字孪生系统'\n  \n  // 获取认证状态\n  const isAuthenticated = localStorage.getItem('token') !== null\n  \n  // 检查是否需要认证\n  if (to.meta.requiresAuth && !isAuthenticated) {\n    // 未认证且需要认证，跳转到登录页\n    return next({ name: 'Login', query: { redirect: to.fullPath } })\n  }\n  \n  // 检查是否需要管理员权限\n  if (to.meta.requiresAdmin) {\n    // 从localStorage获取用户角色信息\n    const userStr = localStorage.getItem('userInfo')\n    let isAdmin = false\n    \n    if (userStr) {\n      try {\n        const userInfo = JSON.parse(userStr)\n        isAdmin = userInfo.role === 'admin'\n      } catch (e) {\n        console.error('解析用户信息失败:', e)\n      }\n    }\n    \n    if (!isAdmin) {\n      // 没有管理员权限，跳转到首页\n      return next({ name: 'DjiDashboard' })\n    }\n  }\n  \n  // 已认证用户访问登录页时，重定向到首页\n  if (to.name === 'Login' && isAuthenticated) {\n    return next({ name: 'DjiDashboard' })\n  }\n  \n  next()\n})\n\nexport default router"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}