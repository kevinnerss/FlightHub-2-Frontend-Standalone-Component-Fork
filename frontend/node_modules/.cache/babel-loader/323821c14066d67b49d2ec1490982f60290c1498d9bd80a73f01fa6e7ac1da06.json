{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport alarmApi from '../api/alarmApi';\nexport default {\n  name: 'AlarmList',\n  data() {\n    return {\n      alarms: [],\n      categories: [],\n      loading: false,\n      searchQuery: '',\n      statusFilter: '',\n      waylineIdFilter: '',\n      currentPage: 1,\n      pageSize: 10,\n      totalAlarms: 0,\n      showStatusDialog: false,\n      currentAlarm: null,\n      newAlarmStatus: ''\n    };\n  },\n  watch: {\n    // 监听搜索关键词变化\n    searchQuery: {\n      handler() {\n        this.currentPage = 1; // 重置到第一页\n        this.loadAlarms();\n      },\n      debounce: 300 // 防抖，避免频繁请求\n    },\n    // 监听状态筛选变化\n    statusFilter() {\n      this.currentPage = 1;\n      this.loadAlarms();\n    },\n    // 监听航线ID筛选变化\n    waylineIdFilter: {\n      handler() {\n        this.currentPage = 1;\n        this.loadAlarms();\n      },\n      debounce: 300\n    }\n  },\n  computed: {\n    // 直接使用从后端获取的数据，不再需要前端过滤\n    filteredAlarms() {\n      return this.alarms;\n    }\n  },\n  async mounted() {\n    await this.loadAlarms();\n    await this.loadCategories();\n  },\n  methods: {\n    async loadAlarms() {\n      this.loading = true;\n      try {\n        // 构建请求参数，包含分页和筛选条件\n        const params = {\n          page: this.currentPage,\n          page_size: this.pageSize,\n          search: this.searchQuery,\n          // 搜索关键词\n          status: this.statusFilter,\n          // 状态筛选\n          wayline_id: this.waylineIdFilter // 航线ID筛选\n        };\n        const response = await alarmApi.getAlarms(params);\n\n        // 转换数据格式，确保前端显示正确\n        this.alarms = (response?.results || []).map(alarm => ({\n          id: alarm.id,\n          created_at: alarm.created_at,\n          category_name: alarm.category ? alarm.category.name : '未分类',\n          category_id: alarm.category ? alarm.category.id : null,\n          latitude: alarm.latitude,\n          longitude: alarm.longitude,\n          content: alarm.content,\n          image_url: alarm.image_url,\n          status: alarm.status,\n          wayline_id: alarm.wayline_id || null\n        }));\n        this.totalAlarms = response?.count || this.alarms.length;\n      } catch (error) {\n        this.$message.error('获取告警列表失败，显示模拟数据');\n        console.error('Load alarms error:', error);\n\n        // 使用模拟数据，确保页面功能正常\n        let mockAlarms = [{\n          id: 1,\n          created_at: new Date().toISOString(),\n          category_name: '设备故障',\n          category_id: 1,\n          latitude: 39.9042,\n          longitude: 116.4074,\n          content: '无人机电机过热',\n          image_url: null,\n          status: 'PENDING',\n          wayline_id: 'WL001'\n        }, {\n          id: 2,\n          created_at: new Date(Date.now() - 3600000).toISOString(),\n          category_name: '信号丢失',\n          category_id: 2,\n          latitude: 39.9142,\n          longitude: 116.4174,\n          content: '遥控信号弱',\n          image_url: null,\n          status: 'RESOLVED',\n          wayline_id: 'WL002'\n        }, {\n          id: 3,\n          created_at: new Date(Date.now() - 7200000).toISOString(),\n          category_name: '电量警告',\n          category_id: 3,\n          latitude: 39.9242,\n          longitude: 116.4274,\n          content: '电池电量低于20%',\n          image_url: null,\n          status: 'COMPLETED',\n          wayline_id: 'WL001'\n        }];\n\n        // 当API调用失败时，在前端进行模拟过滤，确保筛选功能可见\n        if (this.searchQuery) {\n          const query = this.searchQuery.toLowerCase();\n          mockAlarms = mockAlarms.filter(alarm => alarm.content.toLowerCase().includes(query) || alarm.category_name.toLowerCase().includes(query));\n        }\n        if (this.statusFilter) {\n          mockAlarms = mockAlarms.filter(alarm => alarm.status === this.statusFilter);\n        }\n        if (this.waylineIdFilter) {\n          const waylineId = String(this.waylineIdFilter);\n          mockAlarms = mockAlarms.filter(alarm => alarm.wayline_id && String(alarm.wayline_id).includes(waylineId));\n        }\n\n        // 模拟分页\n        const start = (this.currentPage - 1) * this.pageSize;\n        const end = start + this.pageSize;\n        this.alarms = mockAlarms.slice(start, end);\n        this.totalAlarms = mockAlarms.length;\n      } finally {\n        this.loading = false;\n      }\n    },\n    async loadCategories() {\n      try {\n        const categories = await alarmApi.getAlarmCategories();\n        this.categories = categories?.results || categories || [];\n      } catch (error) {\n        this.$message.error('获取告警类型失败，使用默认类型');\n        console.error('Load categories error:', error);\n\n        // 使用模拟数据\n        this.categories = [{\n          id: 1,\n          name: '设备故障',\n          code: 'EQUIPMENT_FAILURE'\n        }, {\n          id: 2,\n          name: '信号丢失',\n          code: 'SIGNAL_LOSS'\n        }, {\n          id: 3,\n          name: '电量警告',\n          code: 'BATTERY_WARNING'\n        }, {\n          id: 4,\n          name: '天气异常',\n          code: 'WEATHER_ABNORMAL'\n        }];\n      }\n    },\n    formatDate(dateString) {\n      if (!dateString) return '';\n      const date = new Date(dateString);\n      return date.toLocaleString('zh-CN', {\n        year: 'numeric',\n        month: '2-digit',\n        day: '2-digit',\n        hour: '2-digit',\n        minute: '2-digit',\n        second: '2-digit'\n      });\n    },\n    getStatusText(status) {\n      const statusMap = {\n        'PENDING': '待处理',\n        'PROCESSING': '处理中',\n        'COMPLETED': '已完成',\n        'IGNORED': '已忽略'\n      };\n      return statusMap[status] || status;\n    },\n    getStatusType(status) {\n      const typeMap = {\n        'PENDING': 'danger',\n        'PROCESSING': 'warning',\n        'COMPLETED': 'success',\n        'IGNORED': 'info'\n      };\n      return typeMap[status] || 'default';\n    },\n    getCategoryType(categoryName) {\n      // 确保categoryName是字符串\n      if (!categoryName || typeof categoryName !== 'string') {\n        return 'info';\n      }\n\n      // 根据不同的告警类型返回不同的标签类型\n      const typeKeywords = {\n        '发热': 'danger',\n        '损伤': 'warning',\n        '故障': 'danger',\n        '异常': 'warning',\n        '隐患': 'warning'\n      };\n      for (const [keyword, type] of Object.entries(typeKeywords)) {\n        if (categoryName.includes(keyword)) {\n          return type;\n        }\n      }\n      return 'info';\n    },\n    openAddAlarmDialog() {\n      // 重置表单数据\n      this.currentAlarm = {\n        id: '新告警',\n        content: '',\n        status: 'PENDING'\n      };\n      this.newAlarmStatus = 'PENDING'; // 默认为待处理\n\n      // 使用el-form对话框收集必要的告警信息\n      this.$prompt('请输入告警描述:', '新增告警', {\n        confirmButtonText: '下一步',\n        cancelButtonText: '取消',\n        inputValue: '',\n        inputPlaceholder: '请输入详细的告警描述...',\n        inputValidator: value => {\n          if (!value || value.trim().length < 5) {\n            return '告警描述至少需要5个字符';\n          }\n          return true;\n        }\n      }).then(async ({\n        value\n      }) => {\n        // 显示状态选择对话框\n        this.currentAlarm.content = value;\n        try {\n          // 创建新告警\n          const newAlarmData = {\n            category: this.categories.length > 0 ? this.categories[0].id : null,\n            // 使用第一个分类或null\n            content: value,\n            latitude: 0,\n            // 默认值\n            longitude: 0,\n            // 默认值\n            status: this.newAlarmStatus,\n            wayline_id: null // 默认为空，实际应用中可以让用户输入\n          };\n          await alarmApi.createAlarm(newAlarmData);\n          this.$message.success('告警创建成功');\n          await this.loadAlarms(); // 重新加载列表\n        } catch (error) {\n          this.$message.error('告警创建失败');\n          console.error('Create alarm error:', error);\n        }\n      }).catch(() => {\n        // 取消操作\n      });\n    },\n    viewAlarmDetail(alarm) {\n      // 查看详情，可以打开一个新的详情对话框\n      this.$message.info(`查看告警ID: ${alarm.id} 的详情`);\n      // 这里可以实现更详细的查看功能\n    },\n    updateAlarmStatus(alarm) {\n      console.log('更新状态按钮被点击', alarm);\n      // 确保currentAlarm是响应式的\n      this.currentAlarm = {\n        ...alarm\n      };\n      this.newAlarmStatus = alarm.status || 'PENDING';\n      // 直接设置显示状态\n      this.showStatusDialog = true;\n      console.log('对话框显示状态设置为true', this.showStatusDialog);\n    },\n    async confirmStatusUpdate() {\n      if (!this.newAlarmStatus || !this.currentAlarm?.id) {\n        this.$message.error('请选择有效的状态');\n        return;\n      }\n      try {\n        // 使用patchAlarm方法只更新状态字段\n        await alarmApi.patchAlarm(this.currentAlarm.id, {\n          status: this.newAlarmStatus\n        });\n        this.$message.success('告警状态更新成功');\n        this.showStatusDialog = false;\n        await this.loadAlarms(); // 重新加载列表\n      } catch (error) {\n        this.$message.error('状态更新失败');\n        console.error('Update alarm status error:', error);\n      }\n    },\n    async deleteAlarm(alarmId) {\n      this.$confirm('确定要删除这条告警吗？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(async () => {\n        try {\n          await alarmApi.deleteAlarm(alarmId);\n          this.$message.success('删除成功');\n          await this.loadAlarms(); // 重新加载列表\n        } catch (error) {\n          this.$message.error('删除失败');\n          console.error('Delete alarm error:', error);\n        }\n      }).catch(() => {\n        // 取消删除\n      });\n    },\n    handleSizeChange(size) {\n      this.pageSize = size;\n      this.loadAlarms();\n    },\n    handleCurrentChange(current) {\n      this.currentPage = current;\n      this.loadAlarms();\n    }\n  }\n};","map":{"version":3,"names":["alarmApi","name","data","alarms","categories","loading","searchQuery","statusFilter","waylineIdFilter","currentPage","pageSize","totalAlarms","showStatusDialog","currentAlarm","newAlarmStatus","watch","handler","loadAlarms","debounce","computed","filteredAlarms","mounted","loadCategories","methods","params","page","page_size","search","status","wayline_id","response","getAlarms","results","map","alarm","id","created_at","category_name","category","category_id","latitude","longitude","content","image_url","count","length","error","$message","console","mockAlarms","Date","toISOString","now","query","toLowerCase","filter","includes","waylineId","String","start","end","slice","getAlarmCategories","code","formatDate","dateString","date","toLocaleString","year","month","day","hour","minute","second","getStatusText","statusMap","getStatusType","typeMap","getCategoryType","categoryName","typeKeywords","keyword","type","Object","entries","openAddAlarmDialog","$prompt","confirmButtonText","cancelButtonText","inputValue","inputPlaceholder","inputValidator","value","trim","then","newAlarmData","createAlarm","success","catch","viewAlarmDetail","info","updateAlarmStatus","log","confirmStatusUpdate","patchAlarm","deleteAlarm","alarmId","$confirm","handleSizeChange","size","handleCurrentChange","current"],"sources":["D:\\projects\\FlightHub-2-Frontend-Standalone-Component\\frontend\\src\\components\\AlarmList.vue"],"sourcesContent":["<template>\n  <div class=\"alarm-list-container\">\n    <div class=\"header-actions\">\n      <h2 class=\"title\">告警信息列表</h2>\n      <el-button type=\"primary\" @click=\"openAddAlarmDialog\">新增告警</el-button>\n    </div>\n    \n    <!-- 搜索和筛选 -->\n    <div class=\"search-filters mb-4\">\n      <el-input\n        v-model=\"searchQuery\"\n        placeholder=\"搜索告警内容\"\n        prefix-icon=\"el-icon-search\"\n        class=\"search-input\"\n      />\n      <el-select\n        v-model=\"statusFilter\"\n        placeholder=\"筛选状态\"\n        class=\"status-filter\"\n      >\n        <el-option label=\"全部\" value=\"\" />\n        <el-option label=\"待处理\" value=\"PENDING\" />\n        <el-option label=\"处理中\" value=\"PROCESSING\" />\n        <el-option label=\"已完成\" value=\"COMPLETED\" />\n        <el-option label=\"已忽略\" value=\"IGNORED\" />\n      </el-select>\n      <el-input\n        v-model=\"waylineIdFilter\"\n        placeholder=\"筛选航线ID\"\n        prefix-icon=\"el-icon-document\"\n        class=\"wayline-filter\"\n      />\n    </div>\n    \n    <!-- 告警列表 -->\n    <el-table\n      v-loading=\"loading\"\n      :data=\"filteredAlarms\"\n      style=\"width: 100%\"\n      border\n      empty-text=\"暂无告警数据\"\n      :fit=\"true\"\n      :scroll-x=\"'max-content'\"\n    >\n      <el-table-column prop=\"id\" label=\"告警ID\" min-width=\"80\" />\n      <el-table-column prop=\"wayline_id\" label=\"航线ID\" min-width=\"100\" />\n      \n      <el-table-column prop=\"created_at\" label=\"报警日期时间\" min-width=\"180\">\n        <template #default=\"{row}\">\n          {{ formatDate(row?.created_at || '') }}\n        </template>\n      </el-table-column>\n      \n      <el-table-column prop=\"category_name\" label=\"报警类型\" min-width=\"120\">\n        <template #default=\"{row}\">\n          <el-tag :type=\"getCategoryType(row?.category_name || '')\">\n            {{ row?.category_name || '未分类' }}\n          </el-tag>\n        </template>\n      </el-table-column>\n      \n      <el-table-column prop=\"content\" label=\"告警描述\" min-width=\"200\" show-overflow-tooltip />\n      \n      <el-table-column prop=\"image_url\" label=\"报警图片\" min-width=\"100\">\n        <template #default=\"{row}\">\n          <el-image\n            v-if=\"row?.image_url\"\n            :src=\"row.image_url\"\n            :preview-src-list=\"[row.image_url]\"\n            style=\"width: 40px; height: 40px; cursor: pointer\"\n            fit=\"cover\"\n          />\n          <span v-else class=\"text-gray-400\">无图片</span>\n        </template>\n      </el-table-column>\n      \n      <el-table-column prop=\"location\" label=\"报警位置\" min-width=\"150\">\n        <template #default=\"{row}\">\n          坐标({{ row?.latitude || '--' }}, {{ row?.longitude || '--' }})\n        </template>\n      </el-table-column>\n      \n      <el-table-column prop=\"status\" label=\"状态\" min-width=\"100\">\n        <template #default=\"{row}\">\n          <el-tag :type=\"getStatusType(row?.status || '')\">\n            {{ getStatusText(row?.status || '') }}\n          </el-tag>\n        </template>\n      </el-table-column>\n      \n      <el-table-column label=\"操作\" min-width=\"180\">\n        <template #default=\"{row}\">\n          <el-button size=\"small\" @click=\"viewAlarmDetail(row)\">查看</el-button>\n          <el-button size=\"small\" type=\"primary\" @click=\"updateAlarmStatus(row)\">更新状态</el-button>\n          <el-button size=\"small\" type=\"danger\" @click=\"deleteAlarm(row?.id || 0)\">删除</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n    \n    <!-- 分页 -->\n    <div class=\"pagination-container\">\n      <el-pagination\n        v-model=\"currentPage\"\n        :page-size=\"pageSize\"\n        :total=\"totalAlarms\"\n        layout=\"total, prev, pager, next, jumper\"\n        @size-change=\"handleSizeChange\"\n        @current-change=\"handleCurrentChange\"\n      />\n    </div>\n    \n    <!-- 状态更新对话框 -->\n    <el-dialog\n      title=\"更新告警状态\"\n      v-model=\"showStatusDialog\"\n      width=\"400px\"\n    >\n      <div class=\"status-dialog-content\">\n        <h4>告警信息</h4>\n        <p><strong>告警ID:</strong> {{ currentAlarm?.id }}</p>\n        <p><strong>告警描述:</strong> {{ currentAlarm?.content }}</p>\n        <p><strong>当前状态:</strong> \n          <el-tag :type=\"getStatusType(currentAlarm?.status || '')\">\n            {{ getStatusText(currentAlarm?.status || '') }}\n          </el-tag>\n        </p>\n        \n        <h4 style=\"margin-top: 20px;\">更新为</h4>\n        <el-select v-model=\"newAlarmStatus\" placeholder=\"请选择新状态\" style=\"width: 100%;\">\n          <el-option label=\"待处理\" value=\"PENDING\" />\n          <el-option label=\"处理中\" value=\"PROCESSING\" />\n          <el-option label=\"已完成\" value=\"COMPLETED\" />\n          <el-option label=\"已忽略\" value=\"IGNORED\" />\n        </el-select>\n      </div>\n      \n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"showStatusDialog = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"confirmStatusUpdate\">确定</el-button>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport alarmApi from '../api/alarmApi'\n\nexport default {\n  name: 'AlarmList',\n  data() {\n    return {\n      alarms: [],\n      categories: [],\n      loading: false,\n      searchQuery: '',\n      statusFilter: '',\n      waylineIdFilter: '',\n      currentPage: 1,\n      pageSize: 10,\n      totalAlarms: 0,\n      showStatusDialog: false,\n      currentAlarm: null,\n      newAlarmStatus: ''\n    }\n  },\n  watch: {\n    // 监听搜索关键词变化\n    searchQuery: {\n      handler() {\n        this.currentPage = 1 // 重置到第一页\n        this.loadAlarms()\n      },\n      debounce: 300 // 防抖，避免频繁请求\n    },\n    // 监听状态筛选变化\n    statusFilter() {\n      this.currentPage = 1\n      this.loadAlarms()\n    },\n    // 监听航线ID筛选变化\n    waylineIdFilter: {\n      handler() {\n        this.currentPage = 1\n        this.loadAlarms()\n      },\n      debounce: 300\n    }\n  },\n  computed: {\n    // 直接使用从后端获取的数据，不再需要前端过滤\n    filteredAlarms() {\n      return this.alarms\n    }\n  },\n  async mounted() {\n    await this.loadAlarms()\n    await this.loadCategories()\n  },\n  methods: {\n    async loadAlarms() {\n      this.loading = true\n      try {\n        // 构建请求参数，包含分页和筛选条件\n        const params = {\n          page: this.currentPage,\n          page_size: this.pageSize,\n          search: this.searchQuery, // 搜索关键词\n          status: this.statusFilter, // 状态筛选\n          wayline_id: this.waylineIdFilter // 航线ID筛选\n        }\n        \n        const response = await alarmApi.getAlarms(params)\n        \n        // 转换数据格式，确保前端显示正确\n        this.alarms = (response?.results || []).map(alarm => ({\n          id: alarm.id,\n          created_at: alarm.created_at,\n          category_name: alarm.category ? alarm.category.name : '未分类',\n          category_id: alarm.category ? alarm.category.id : null,\n          latitude: alarm.latitude,\n          longitude: alarm.longitude,\n          content: alarm.content,\n          image_url: alarm.image_url,\n          status: alarm.status,\n          wayline_id: alarm.wayline_id || null\n        }))\n        \n        this.totalAlarms = response?.count || this.alarms.length\n      } catch (error) {\n        this.$message.error('获取告警列表失败，显示模拟数据')\n        console.error('Load alarms error:', error)\n        \n        // 使用模拟数据，确保页面功能正常\n        let mockAlarms = [\n          {\n            id: 1,\n            created_at: new Date().toISOString(),\n            category_name: '设备故障',\n            category_id: 1,\n            latitude: 39.9042,\n            longitude: 116.4074,\n            content: '无人机电机过热',\n            image_url: null,\n            status: 'PENDING',\n            wayline_id: 'WL001'\n          },\n          {\n            id: 2,\n            created_at: new Date(Date.now() - 3600000).toISOString(),\n            category_name: '信号丢失',\n            category_id: 2,\n            latitude: 39.9142,\n            longitude: 116.4174,\n            content: '遥控信号弱',\n            image_url: null,\n            status: 'RESOLVED',\n            wayline_id: 'WL002'\n          },\n          {\n            id: 3,\n            created_at: new Date(Date.now() - 7200000).toISOString(),\n            category_name: '电量警告',\n            category_id: 3,\n            latitude: 39.9242,\n            longitude: 116.4274,\n            content: '电池电量低于20%',\n            image_url: null,\n            status: 'COMPLETED',\n            wayline_id: 'WL001'\n          }\n        ]\n        \n        // 当API调用失败时，在前端进行模拟过滤，确保筛选功能可见\n        if (this.searchQuery) {\n          const query = this.searchQuery.toLowerCase()\n          mockAlarms = mockAlarms.filter(alarm => \n            alarm.content.toLowerCase().includes(query) ||\n            alarm.category_name.toLowerCase().includes(query)\n          )\n        }\n        \n        if (this.statusFilter) {\n          mockAlarms = mockAlarms.filter(alarm => alarm.status === this.statusFilter)\n        }\n        \n        if (this.waylineIdFilter) {\n          const waylineId = String(this.waylineIdFilter)\n          mockAlarms = mockAlarms.filter(alarm => \n            alarm.wayline_id && String(alarm.wayline_id).includes(waylineId)\n          )\n        }\n        \n        // 模拟分页\n        const start = (this.currentPage - 1) * this.pageSize\n        const end = start + this.pageSize\n        this.alarms = mockAlarms.slice(start, end)\n        this.totalAlarms = mockAlarms.length\n      } finally {\n        this.loading = false\n      }\n    },\n    \n    async loadCategories() {\n      try {\n        const categories = await alarmApi.getAlarmCategories()\n        this.categories = categories?.results || categories || []\n      } catch (error) {\n        this.$message.error('获取告警类型失败，使用默认类型')\n        console.error('Load categories error:', error)\n        \n        // 使用模拟数据\n        this.categories = [\n          { id: 1, name: '设备故障', code: 'EQUIPMENT_FAILURE' },\n          { id: 2, name: '信号丢失', code: 'SIGNAL_LOSS' },\n          { id: 3, name: '电量警告', code: 'BATTERY_WARNING' },\n          { id: 4, name: '天气异常', code: 'WEATHER_ABNORMAL' }\n        ]\n      }\n    },\n    \n    formatDate(dateString) {\n      if (!dateString) return ''\n      const date = new Date(dateString)\n      return date.toLocaleString('zh-CN', {\n        year: 'numeric',\n        month: '2-digit',\n        day: '2-digit',\n        hour: '2-digit',\n        minute: '2-digit',\n        second: '2-digit'\n      })\n    },\n    \n    getStatusText(status) {\n      const statusMap = {\n        'PENDING': '待处理',\n        'PROCESSING': '处理中',\n        'COMPLETED': '已完成',\n        'IGNORED': '已忽略'\n      }\n      return statusMap[status] || status\n    },\n    \n    getStatusType(status) {\n      const typeMap = {\n        'PENDING': 'danger',\n        'PROCESSING': 'warning',\n        'COMPLETED': 'success',\n        'IGNORED': 'info'\n      }\n      return typeMap[status] || 'default'\n    },\n    \n    getCategoryType(categoryName) {\n      // 确保categoryName是字符串\n      if (!categoryName || typeof categoryName !== 'string') {\n        return 'info'\n      }\n      \n      // 根据不同的告警类型返回不同的标签类型\n      const typeKeywords = {\n        '发热': 'danger',\n        '损伤': 'warning',\n        '故障': 'danger',\n        '异常': 'warning',\n        '隐患': 'warning'\n      }\n      \n      for (const [keyword, type] of Object.entries(typeKeywords)) {\n        if (categoryName.includes(keyword)) {\n          return type\n        }\n      }\n      \n      return 'info'\n    },\n    \n    openAddAlarmDialog() {\n      // 重置表单数据\n      this.currentAlarm = {\n        id: '新告警',\n        content: '',\n        status: 'PENDING'\n      }\n      this.newAlarmStatus = 'PENDING' // 默认为待处理\n      \n      // 使用el-form对话框收集必要的告警信息\n      this.$prompt(\n        '请输入告警描述:',\n        '新增告警',\n        {\n          confirmButtonText: '下一步',\n          cancelButtonText: '取消',\n          inputValue: '',\n          inputPlaceholder: '请输入详细的告警描述...',\n          inputValidator: (value) => {\n            if (!value || value.trim().length < 5) {\n              return '告警描述至少需要5个字符';\n            }\n            return true;\n          }\n        }\n      ).then(async ({ value }) => {\n        // 显示状态选择对话框\n        this.currentAlarm.content = value\n        \n        try {\n          // 创建新告警\n          const newAlarmData = {\n            category: this.categories.length > 0 ? this.categories[0].id : null, // 使用第一个分类或null\n            content: value,\n            latitude: 0, // 默认值\n            longitude: 0, // 默认值\n            status: this.newAlarmStatus,\n            wayline_id: null // 默认为空，实际应用中可以让用户输入\n          }\n          \n          await alarmApi.createAlarm(newAlarmData)\n          this.$message.success('告警创建成功')\n          await this.loadAlarms() // 重新加载列表\n        } catch (error) {\n          this.$message.error('告警创建失败')\n          console.error('Create alarm error:', error)\n        }\n      }).catch(() => {\n        // 取消操作\n      })\n    },\n    \n    viewAlarmDetail(alarm) {\n      // 查看详情，可以打开一个新的详情对话框\n      this.$message.info(`查看告警ID: ${alarm.id} 的详情`)\n      // 这里可以实现更详细的查看功能\n    },\n    \n    updateAlarmStatus(alarm) {\n      console.log('更新状态按钮被点击', alarm)\n      // 确保currentAlarm是响应式的\n      this.currentAlarm = {...alarm};\n      this.newAlarmStatus = alarm.status || 'PENDING';\n      // 直接设置显示状态\n      this.showStatusDialog = true;\n      console.log('对话框显示状态设置为true', this.showStatusDialog);\n    },\n    \n    async confirmStatusUpdate() {\n      if (!this.newAlarmStatus || !this.currentAlarm?.id) {\n        this.$message.error('请选择有效的状态')\n        return\n      }\n      \n      try {\n        // 使用patchAlarm方法只更新状态字段\n        await alarmApi.patchAlarm(this.currentAlarm.id, { status: this.newAlarmStatus })\n        this.$message.success('告警状态更新成功')\n        this.showStatusDialog = false\n        await this.loadAlarms() // 重新加载列表\n      } catch (error) {\n        this.$message.error('状态更新失败')\n        console.error('Update alarm status error:', error)\n      }\n    },\n    \n    async deleteAlarm(alarmId) {\n      this.$confirm('确定要删除这条告警吗？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(async () => {\n        try {\n          await alarmApi.deleteAlarm(alarmId)\n          this.$message.success('删除成功')\n          await this.loadAlarms() // 重新加载列表\n        } catch (error) {\n          this.$message.error('删除失败')\n          console.error('Delete alarm error:', error)\n        }\n      }).catch(() => {\n        // 取消删除\n      })\n    },\n    \n    handleSizeChange(size) {\n      this.pageSize = size\n      this.loadAlarms()\n    },\n    \n    handleCurrentChange(current) {\n      this.currentPage = current\n      this.loadAlarms()\n    }\n  }\n}\n</script>\n\n<style scoped>\n.alarm-list-container {\n  padding: 20px;\n}\n\n.header-actions {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n}\n\n.title {\n  font-size: 20px;\n  font-weight: bold;\n  margin: 0;\n}\n\n.search-filters {\n  display: flex;\n  gap: 16px;\n}\n\n.search-input {\n  width: 300px;\n}\n\n.status-filter {\n  width: 150px;\n}\n\n.wayline-filter {\n  width: 150px;\n}\n\n.pagination-container {\n  margin-top: 20px;\n  display: flex;\n  justify-content: flex-end;\n}\n\n.status-dialog-content {\n  line-height: 1.8;\n}\n\n.status-dialog-content h4 {\n  margin-bottom: 10px;\n  color: #303133;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}