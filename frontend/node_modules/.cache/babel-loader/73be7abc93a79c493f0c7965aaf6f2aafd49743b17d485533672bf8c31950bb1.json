{"ast":null,"code":"import WaylineList from './WaylineList.vue';\nexport default {\n  name: 'WaylineFallback',\n  components: {\n    WaylineList\n  },\n  props: {\n    currentSelectedId: {\n      type: Number,\n      default: null\n    }\n  },\n  emits: ['wayline-selected'],\n  data() {\n    return {\n      showCustomWaylineList: false,\n      djiComponentLoaded: false,\n      checkTimer: null\n    };\n  },\n  async mounted() {\n    // 尝试加载大疆组件\n    await this.tryLoadDjiComponent();\n  },\n  beforeDestroy() {\n    // 清理定时器\n    if (this.checkTimer) {\n      clearTimeout(this.checkTimer);\n    }\n  },\n  methods: {\n    async tryLoadDjiComponent() {\n      try {\n        // 检查大疆组件是否可用\n        this.djiComponentLoaded = await this.checkDjiComponentAvailability();\n        if (!this.djiComponentLoaded) {\n          // 如果不可用，使用自定义组件\n          this.showCustomWaylineList = true;\n          this.$message.warning('大疆航线组件加载失败，已切换至自定义航线列表');\n        } else {\n          // 尝试渲染大疆组件\n          this.renderDjiComponent();\n\n          // 设置一个定时器再次检查，确保组件正常工作\n          this.checkTimer = setTimeout(() => {\n            this.verifyDjiComponent();\n          }, 3000);\n        }\n      } catch (error) {\n        console.error('加载大疆组件时出错:', error);\n        this.showCustomWaylineList = true;\n        this.$message.warning('大疆航线组件加载失败，已切换至自定义航线列表');\n      }\n    },\n    async checkDjiComponentAvailability() {\n      try {\n        // 检查全局是否存在大疆相关对象\n        if (typeof window.DJI !== 'undefined' && typeof window.DJI.WaylineComponent !== 'undefined') {\n          return true;\n        }\n\n        // 检查是否有特定的大疆API端点\n        if (window.djiApi && typeof window.djiApi.getWaylines === 'function') {\n          return true;\n        }\n\n        // 尝试简单的API调用\n        const response = await fetch('/api/dji/health', {\n          method: 'GET',\n          timeout: 2000\n        });\n        return response.ok;\n      } catch (error) {\n        return false;\n      }\n    },\n    renderDjiComponent() {\n      try {\n        // 这里应该是渲染大疆原始组件的代码\n        // 根据实际的大疆组件API进行调整\n        if (this.$refs.djiContainer) {\n          // 模拟渲染大疆组件\n          this.$refs.djiContainer.innerHTML = '<div class=\"dji-placeholder\">正在加载大疆航线组件...</div>';\n\n          // 尝试调用实际的大疆组件初始化\n          if (typeof window.DJI?.WaylineComponent?.init === 'function') {\n            window.DJI.WaylineComponent.init(this.$refs.djiContainer, {\n              // 配置参数\n              showList: true,\n              showMap: true\n            });\n          }\n        }\n      } catch (error) {\n        console.error('渲染大疆组件失败:', error);\n        this.showCustomWaylineList = true;\n        this.$message.error('大疆组件渲染失败，已切换至自定义列表');\n      }\n    },\n    verifyDjiComponent() {\n      try {\n        // 验证大疆组件是否正常工作\n        // 检查容器中是否有实际内容或特定的标记元素\n        const container = this.$refs.djiContainer;\n        if (container && container.querySelector('.dji-placeholder')) {\n          // 仍然显示占位符，表示组件未正确加载\n          this.showCustomWaylineList = true;\n          this.$message.warning('大疆航线组件未正常初始化，已切换至自定义列表');\n        }\n      } catch (error) {\n        console.error('验证大疆组件失败:', error);\n        this.showCustomWaylineList = true;\n      }\n    },\n    // 处理航线选择事件并向上传递\n    handleWaylineSelected(wayline) {\n      this.$emit('wayline-selected', wayline);\n    }\n  }\n};","map":{"version":3,"names":["WaylineList","name","components","props","currentSelectedId","type","Number","default","emits","data","showCustomWaylineList","djiComponentLoaded","checkTimer","mounted","tryLoadDjiComponent","beforeDestroy","clearTimeout","methods","checkDjiComponentAvailability","$message","warning","renderDjiComponent","setTimeout","verifyDjiComponent","error","console","window","DJI","WaylineComponent","djiApi","getWaylines","response","fetch","method","timeout","ok","$refs","djiContainer","innerHTML","init","showList","showMap","container","querySelector","handleWaylineSelected","wayline","$emit"],"sources":["D:\\projects\\FlightHub-2-Frontend-Standalone-Component\\frontend\\src\\components\\WaylineFallback.vue"],"sourcesContent":["<template>\r\n  <div class=\"wayline-fallback\">\r\n    <!-- 当大疆组件不可用时显示自定义航线列表 -->\r\n    <WaylineList \r\n      v-if=\"showCustomWaylineList\" \r\n      :current-selected-id=\"currentSelectedId\"\r\n      @wayline-selected=\"handleWaylineSelected\"\r\n    />\r\n    \r\n    <!-- 用于放置大疆原始组件的容器 -->\r\n    <div \r\n      v-else \r\n      ref=\"djiContainer\" \r\n      class=\"dji-container\"\r\n    ></div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport WaylineList from './WaylineList.vue'\r\n\r\nexport default {\r\n  name: 'WaylineFallback',\r\n  components: {\r\n    WaylineList\r\n  },\r\n  props: {\r\n    currentSelectedId: {\r\n      type: Number,\r\n      default: null\r\n    }\r\n  },\r\n  emits: ['wayline-selected'],\r\n  data() {\r\n    return {\r\n      showCustomWaylineList: false,\r\n      djiComponentLoaded: false,\r\n      checkTimer: null\r\n    }\r\n  },\r\n  async mounted() {\r\n    // 尝试加载大疆组件\r\n    await this.tryLoadDjiComponent()\r\n  },\r\n  beforeDestroy() {\r\n    // 清理定时器\r\n    if (this.checkTimer) {\r\n      clearTimeout(this.checkTimer)\r\n    }\r\n  },\r\n  methods: {\r\n    async tryLoadDjiComponent() {\r\n      try {\r\n        // 检查大疆组件是否可用\r\n        this.djiComponentLoaded = await this.checkDjiComponentAvailability()\r\n        \r\n        if (!this.djiComponentLoaded) {\r\n          // 如果不可用，使用自定义组件\r\n          this.showCustomWaylineList = true\r\n          this.$message.warning('大疆航线组件加载失败，已切换至自定义航线列表')\r\n        } else {\r\n          // 尝试渲染大疆组件\r\n          this.renderDjiComponent()\r\n          \r\n          // 设置一个定时器再次检查，确保组件正常工作\r\n          this.checkTimer = setTimeout(() => {\r\n            this.verifyDjiComponent()\r\n          }, 3000)\r\n        }\r\n      } catch (error) {\r\n        console.error('加载大疆组件时出错:', error)\r\n        this.showCustomWaylineList = true\r\n        this.$message.warning('大疆航线组件加载失败，已切换至自定义航线列表')\r\n      }\r\n    },\r\n    \r\n    async checkDjiComponentAvailability() {\r\n      try {\r\n        // 检查全局是否存在大疆相关对象\r\n        if (typeof window.DJI !== 'undefined' && \r\n            typeof window.DJI.WaylineComponent !== 'undefined') {\r\n          return true\r\n        }\r\n        \r\n        // 检查是否有特定的大疆API端点\r\n        if (window.djiApi && typeof window.djiApi.getWaylines === 'function') {\r\n          return true\r\n        }\r\n        \r\n        // 尝试简单的API调用\r\n        const response = await fetch('/api/dji/health', {\r\n          method: 'GET',\r\n          timeout: 2000\r\n        })\r\n        return response.ok\r\n      } catch (error) {\r\n        return false\r\n      }\r\n    },\r\n    \r\n    renderDjiComponent() {\r\n      try {\r\n        // 这里应该是渲染大疆原始组件的代码\r\n        // 根据实际的大疆组件API进行调整\r\n        if (this.$refs.djiContainer) {\r\n          // 模拟渲染大疆组件\r\n          this.$refs.djiContainer.innerHTML = '<div class=\"dji-placeholder\">正在加载大疆航线组件...</div>'\r\n          \r\n          // 尝试调用实际的大疆组件初始化\r\n          if (typeof window.DJI?.WaylineComponent?.init === 'function') {\r\n            window.DJI.WaylineComponent.init(this.$refs.djiContainer, {\r\n              // 配置参数\r\n              showList: true,\r\n              showMap: true\r\n            })\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('渲染大疆组件失败:', error)\r\n        this.showCustomWaylineList = true\r\n        this.$message.error('大疆组件渲染失败，已切换至自定义列表')\r\n      }\r\n    },\r\n    \r\n    verifyDjiComponent() {\r\n      try {\r\n        // 验证大疆组件是否正常工作\r\n        // 检查容器中是否有实际内容或特定的标记元素\r\n        const container = this.$refs.djiContainer\r\n        if (container && container.querySelector('.dji-placeholder')) {\r\n          // 仍然显示占位符，表示组件未正确加载\r\n          this.showCustomWaylineList = true\r\n          this.$message.warning('大疆航线组件未正常初始化，已切换至自定义列表')\r\n        }\r\n      } catch (error) {\r\n        console.error('验证大疆组件失败:', error)\r\n        this.showCustomWaylineList = true\r\n      }\r\n    },\r\n    \r\n    // 处理航线选择事件并向上传递\r\n    handleWaylineSelected(wayline) {\r\n      this.$emit('wayline-selected', wayline)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.wayline-fallback {\r\n  width: 100%;\r\n  max-width: 100%;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.dji-container {\r\n  width: 100%;\r\n  height: 300px;\r\n  min-height: 300px;\r\n  border: 1px solid #ebeef5;\r\n  border-radius: 4px;\r\n  overflow: hidden;\r\n}\r\n\r\n.dji-placeholder {\r\n  width: 100%;\r\n  height: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  color: #909399;\r\n  background-color: #f5f7fa;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}