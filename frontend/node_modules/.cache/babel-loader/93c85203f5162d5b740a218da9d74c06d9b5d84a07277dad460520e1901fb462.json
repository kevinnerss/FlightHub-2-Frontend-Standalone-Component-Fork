{"ast":null,"code":"import { ElMessage } from 'element-plus';\nimport componentConfigApi from '../api/componentConfigApi.js';\nexport default {\n  name: 'ComponentConfig',\n  data() {\n    return {\n      form: {\n        serverUrl: '',\n        wssUrl: '',\n        hostUrl: '',\n        prjId: '',\n        projectToken: '',\n        userId: '',\n        workspaceId: '',\n        fh2_project_id: '',\n        // 兼容旧字段\n        extra_params: ''\n      },\n      rules: {\n        serverUrl: [{\n          required: true,\n          message: '请输入 serverUrl',\n          trigger: 'blur'\n        }],\n        wssUrl: [{\n          required: true,\n          message: '请输入 wssUrl',\n          trigger: 'blur'\n        }],\n        hostUrl: [{\n          required: true,\n          message: '请输入 hostUrl',\n          trigger: 'blur'\n        }],\n        projectToken: [{\n          required: true,\n          message: '请输入 projectToken',\n          trigger: 'blur'\n        }]\n      },\n      loading: false,\n      saving: false,\n      lastUpdated: ''\n    };\n  },\n  mounted() {\n    this.loadConfig();\n  },\n  methods: {\n    async loadConfig() {\n      this.loading = true;\n      try {\n        const data = await componentConfigApi.getConfig(true);\n        if (data && typeof data === 'object') {\n          this.form = {\n            ...this.form,\n            ...data\n          };\n          if (data.extra_params && typeof data.extra_params === 'object') {\n            this.form.extra_params = JSON.stringify(data.extra_params, null, 2);\n          }\n          if (data.updated_at) {\n            this.lastUpdated = new Date(data.updated_at).toLocaleString('zh-CN');\n          }\n        }\n      } catch (error) {\n        console.error('加载配置失败:', error);\n        ElMessage.error('加载配置失败，请稍后重试');\n      } finally {\n        this.loading = false;\n      }\n    },\n    async handleSave() {\n      if (this.saving) return;\n      this.saving = true;\n      try {\n        // 校验 extra_params JSON\n        let extraParams = this.form.extra_params;\n        if (extraParams && typeof extraParams === 'string') {\n          try {\n            extraParams = JSON.parse(extraParams);\n          } catch (e) {\n            throw new Error('extra_params 不是合法的 JSON');\n          }\n        }\n        const payload = {\n          ...this.form,\n          extra_params: extraParams\n        };\n        const result = await componentConfigApi.updateConfig(payload);\n        if (result?.updated_at) {\n          this.lastUpdated = new Date(result.updated_at).toLocaleString('zh-CN');\n        } else {\n          this.lastUpdated = new Date().toLocaleString('zh-CN');\n        }\n        ElMessage.success('配置已保存并更新到数据库');\n      } catch (error) {\n        console.error('保存配置失败:', error);\n        let detail = error?.message || '保存失败，请检查网络或数据格式';\n        if (error?.response?.data) {\n          detail = JSON.stringify(error.response.data);\n        }\n        ElMessage.error(detail);\n      } finally {\n        this.saving = false;\n      }\n    }\n  }\n};","map":{"version":3,"names":["ElMessage","componentConfigApi","name","data","form","serverUrl","wssUrl","hostUrl","prjId","projectToken","userId","workspaceId","fh2_project_id","extra_params","rules","required","message","trigger","loading","saving","lastUpdated","mounted","loadConfig","methods","getConfig","JSON","stringify","updated_at","Date","toLocaleString","error","console","handleSave","extraParams","parse","e","Error","payload","result","updateConfig","success","detail","response"],"sources":["D:\\projects\\FlightHub-2-Frontend-Standalone-Component\\frontend\\src\\views\\ComponentConfig.vue"],"sourcesContent":["<template>\n  <div class=\"config-page\">\n    <!-- 页面头部 -->\n    <div class=\"page-header-premium\">\n      <div class=\"header-content\">\n        <div class=\"header-left\">\n          <div class=\"header-icon\">\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n              <path d=\"M4 7h16M4 12h10M4 17h6\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n              <circle cx=\"18\" cy=\"17\" r=\"2\" stroke=\"currentColor\" stroke-width=\"2\"/>\n              <circle cx=\"20\" cy=\"7\" r=\"2\" stroke=\"currentColor\" stroke-width=\"2\"/>\n            </svg>\n          </div>\n          <div class=\"header-text\">\n            <h1 class=\"page-title\">组件参数配置</h1>\n            <p class=\"page-subtitle\">为大疆二开组件集中配置公共参数，保存到数据库供全局使用</p>\n          </div>\n        </div>\n        <div class=\"header-actions\">\n          <el-button type=\"primary\" :loading=\"loading\" @click=\"loadConfig\">\n            重新拉取\n          </el-button>\n          <el-button type=\"success\" :loading=\"saving\" @click=\"handleSave\">\n            保存配置\n          </el-button>\n        </div>\n      </div>\n    </div>\n\n    <!-- 配置表单 -->\n    <div class=\"config-content\">\n      <el-card class=\"config-card\" shadow=\"hover\">\n        <div class=\"card-header\">\n          <div>\n            <h3>大疆组件公共参数</h3>\n            <p class=\"card-subtitle\">与官方 demo 一致的 FH2 配置（serverUrl / wssUrl / hostUrl / prjId / projectToken）</p>\n          </div>\n          <div class=\"meta-text\" v-if=\"lastUpdated\">\n            上次保存时间：{{ lastUpdated }}\n          </div>\n        </div>\n        <el-form\n          ref=\"formRef\"\n          :model=\"form\"\n          :rules=\"rules\"\n          label-width=\"160px\"\n          label-position=\"left\"\n          class=\"config-form\"\n        >\n          <el-row :gutter=\"20\">\n            <el-col :span=\"12\">\n              <el-form-item label=\"serverUrl\" prop=\"serverUrl\">\n                <el-input\n                  v-model=\"form.serverUrl\"\n                  placeholder=\"例如 http://127.0.0.1:30812\"\n                  clearable\n                />\n              </el-form-item>\n            </el-col>\n            <el-col :span=\"12\">\n              <el-form-item label=\"wssUrl\" prop=\"wssUrl\">\n                <el-input v-model=\"form.wssUrl\" placeholder=\"例如 ws://127.0.0.1:30812/duplex/web\" clearable />\n              </el-form-item>\n            </el-col>\n          </el-row>\n          <el-row :gutter=\"20\">\n            <el-col :span=\"12\">\n              <el-form-item label=\"hostUrl\" prop=\"hostUrl\">\n                <el-input\n                  v-model=\"form.hostUrl\"\n                  placeholder=\"例如 http://127.0.0.1\"\n                  clearable\n                />\n              </el-form-item>\n            </el-col>\n            <el-col :span=\"12\">\n              <el-form-item label=\"prjId\" prop=\"prjId\">\n                <el-input v-model=\"form.prjId\" placeholder=\"项目 ID，可选\" clearable />\n              </el-form-item>\n            </el-col>\n          </el-row>\n          <el-row :gutter=\"20\">\n            <el-col :span=\"12\">\n              <el-form-item label=\"projectToken\" prop=\"projectToken\">\n                <el-input v-model=\"form.projectToken\" placeholder=\"组织密钥（必填）\" clearable />\n              </el-form-item>\n            </el-col>\n            <el-col :span=\"12\">\n              <el-form-item label=\"用户 ID\" prop=\"userId\">\n                <el-input v-model=\"form.userId\" placeholder=\"可选：当前调用者用户 ID\" clearable />\n              </el-form-item>\n            </el-col>\n          </el-row>\n          <el-row :gutter=\"20\">\n            <el-col :span=\"12\">\n              <el-form-item label=\"Workspace / Org ID\" prop=\"workspaceId\">\n                <el-input v-model=\"form.workspaceId\" placeholder=\"可选：空间或组织 ID\" clearable />\n              </el-form-item>\n            </el-col>\n            <el-col :span=\"12\">\n              <el-form-item label=\"其它自定义 JSON\" prop=\"extra_params\">\n                <el-input\n                  v-model=\"form.extra_params\"\n                  type=\"textarea\"\n                  :autosize=\"{ minRows: 2, maxRows: 4 }\"\n                  placeholder='可选，JSON 字符串，如 {\"customKey\":\"customValue\"}'\n                />\n              </el-form-item>\n            </el-col>\n          </el-row>\n        </el-form>\n      </el-card>\n\n      <div class=\"footer-actions\">\n        <el-button @click=\"loadConfig\" :loading=\"loading\">恢复后端数据</el-button>\n        <el-button type=\"primary\" :loading=\"saving\" @click=\"handleSave\">保存配置</el-button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ElMessage } from 'element-plus'\nimport componentConfigApi from '../api/componentConfigApi.js'\n\nexport default {\n  name: 'ComponentConfig',\n  data() {\n    return {\n      form: {\n        serverUrl: '',\n        wssUrl: '',\n        hostUrl: '',\n        prjId: '',\n        projectToken: '',\n        userId: '',\n        workspaceId: '',\n        fh2_project_id: '', // 兼容旧字段\n        extra_params: ''\n      },\n      rules: {\n        serverUrl: [{ required: true, message: '请输入 serverUrl', trigger: 'blur' }],\n        wssUrl: [{ required: true, message: '请输入 wssUrl', trigger: 'blur' }],\n        hostUrl: [{ required: true, message: '请输入 hostUrl', trigger: 'blur' }],\n        projectToken: [{ required: true, message: '请输入 projectToken', trigger: 'blur' }]\n      },\n      loading: false,\n      saving: false,\n      lastUpdated: ''\n    }\n  },\n  mounted() {\n    this.loadConfig()\n  },\n  methods: {\n    async loadConfig() {\n      this.loading = true\n      try {\n        const data = await componentConfigApi.getConfig(true)\n        if (data && typeof data === 'object') {\n          this.form = {\n            ...this.form,\n            ...data\n          }\n          if (data.extra_params && typeof data.extra_params === 'object') {\n            this.form.extra_params = JSON.stringify(data.extra_params, null, 2)\n          }\n          if (data.updated_at) {\n            this.lastUpdated = new Date(data.updated_at).toLocaleString('zh-CN')\n          }\n        }\n      } catch (error) {\n        console.error('加载配置失败:', error)\n        ElMessage.error('加载配置失败，请稍后重试')\n      } finally {\n        this.loading = false\n      }\n    },\n    async handleSave() {\n      if (this.saving) return\n      this.saving = true\n      try {\n        // 校验 extra_params JSON\n        let extraParams = this.form.extra_params\n        if (extraParams && typeof extraParams === 'string') {\n          try {\n            extraParams = JSON.parse(extraParams)\n          } catch (e) {\n            throw new Error('extra_params 不是合法的 JSON')\n          }\n        }\n\n        const payload = { ...this.form, extra_params: extraParams }\n        const result = await componentConfigApi.updateConfig(payload)\n        if (result?.updated_at) {\n          this.lastUpdated = new Date(result.updated_at).toLocaleString('zh-CN')\n        } else {\n          this.lastUpdated = new Date().toLocaleString('zh-CN')\n        }\n        ElMessage.success('配置已保存并更新到数据库')\n      } catch (error) {\n        console.error('保存配置失败:', error)\n        let detail = error?.message || '保存失败，请检查网络或数据格式'\n        if (error?.response?.data) {\n          detail = JSON.stringify(error.response.data)\n        }\n        ElMessage.error(detail)\n      } finally {\n        this.saving = false\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.config-page {\n  max-width: 1200px;\n  margin: 0 auto;\n  padding: 0 0 32px 0;\n  color: #e2e8f0;\n}\n\n.page-header-premium {\n  margin: 24px 0;\n}\n\n.header-content {\n  padding: 24px 28px;\n  background: rgba(26, 31, 58, 0.6);\n  border-radius: 16px;\n  border: 1px solid rgba(14, 165, 233, 0.4);\n  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 20px;\n}\n\n.header-left {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n}\n\n.header-icon {\n  width: 48px;\n  height: 48px;\n  background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);\n  border-radius: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #fff;\n  box-shadow: 0 4px 16px rgba(14, 165, 233, 0.4);\n}\n\n.header-text .page-title {\n  font-size: 24px;\n  font-weight: 700;\n  margin: 0;\n  background: linear-gradient(135deg, #0ea5e9 0%, #38bdf8 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n}\n\n.header-text .page-subtitle {\n  margin: 6px 0 0 0;\n  color: #94a3b8;\n}\n\n.header-actions {\n  display: flex;\n  gap: 12px;\n}\n\n.config-content {\n  display: flex;\n  flex-direction: column;\n  gap: 18px;\n}\n\n.config-card {\n  background: rgba(26, 31, 58, 0.6);\n  border: 1px solid rgba(14, 165, 233, 0.2);\n  border-radius: 16px;\n}\n\n.card-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 12px;\n}\n\n.card-header h3 {\n  margin: 0;\n  color: #e2e8f0;\n  font-size: 18px;\n}\n\n.card-subtitle {\n  margin: 4px 0 0 0;\n  color: #94a3b8;\n  font-size: 13px;\n}\n\n.meta-text {\n  color: #cbd5e1;\n  font-size: 12px;\n}\n\n.config-form {\n  margin-top: 12px;\n}\n\n.footer-actions {\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n  margin-top: 8px;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}