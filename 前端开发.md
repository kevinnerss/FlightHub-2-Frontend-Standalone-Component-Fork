这是一份基于我们刚才梳理完的所有逻辑生成的 API 接口文档。你可以直接发给前端开发人员。

我整理了核心的三个接口：预扫描、启动任务、任务详情（含结果分类）。

🚁 智能巡检系统 API 接口文档 v1.0
最后更新: 2025-12-14 后端服务地址: http://<服务器IP>:8001 (开发环境: 127.0.0.1:8000) 基础路径: /api/v1

1. 扫描待检测文件夹 (预扫描)
前端在“新建任务”页面加载时调用，用于展示 MinIO 中最新上传、尚未处理的文件夹列表。

URL: /scan_candidate_folders

Method: GET

Auth: 无 (或根据实际项目添加 Token)

📥 Request
无参数。

📤 Response
JSON

{
    "code": 200,
    "data": [
        {
            "date": "2025-12-14",
            "tasks": [
                {
                    "folder_name": "李达轨道检测_20251214",
                    "full_path": "李达轨道检测_20251214/",
                    "detect_type": "李达轨道检测",  // 解析出的中文类型
                    "db_status": "new"             // 状态: new(新发现), scanning(检测中), done(已完成)
                },
                {
                    "folder_name": "接触网特巡_20251214",
                    "full_path": "接触网特巡_20251214/",
                    "detect_type": "接触网特巡",
                    "db_status": "done"            // 如果已测完，前端可置灰或标记
                }
            ]
        }
    ]
}
2. 批量启动检测任务
用户勾选文件夹后，点击“开始检测”调用。后端会自动关联航线、创建任务、并重置失败图片状态。

URL: /start_selected_tasks

Method: POST

Content-Type: application/json

📥 Request
JSON

{
    "folders": [
        "李达轨道检测_20251214",
        "接触网特巡_20251214"
    ]
}
📤 Response
JSON

{
    "code": 200,
    "msg": "成功启动 2 个任务",
    "started": [
        "李达轨道检测_20251214",
        "接触网特巡_20251214"
    ]
}
逻辑说明:

自动识别文件名中的关键词（轨道/绝缘子/桥/GLM），匹配算法类型。

自动继承后台配置的航线 ID（例如：轨道 -> 北部航线）。

如果任务已存在（重测），会自动将之前的 Failed 图片重置为 Pending 并立即触发重测。

3. 获取任务详情 (含正常/异常图片分类)
用于在任务详情页展示检测进度和结果。此接口已做分流处理，明确区分“正常图片”和“异常图片”。

URL: /inspect-tasks/{id}/report/

Method: GET

Path Param:

id: 任务 ID (InspectTask ID)

📥 Request
无

📤 Response
JSON

{
    "task_id": 22,
    "external_task_id": "李达轨道检测_20251214",
    "status": "done",         // pending, processing, done
    "wayline_id": 1,          // 关联的航线ID
    
    // 📊 统计摘要
    "summary": {
        "total": 105,         // 总图片数
        "normal_count": 100,  // 正常数量 (检测通过)
        "abnormal_count": 5,  // 异常数量 (发现病害)
        "pending_count": 0    // 待处理数量
    },

    // ✅ 正常图片列表 (仅路径，用于缩略图展示)
    "normal_images": [
        "李达轨道检测_20251214/detected_img_01.jpg",
        "李达轨道检测_20251214/detected_img_02.jpg",
        ...
    ],

    // ⚠️ 异常图片列表 (路径，通常也是告警源)
    "abnormal_images": [
        "李达轨道检测_20251214/detected_img_99.jpg"
    ]
}
4. 获取告警列表 (异常详情)
仅展示真正有问题的记录（过滤了正常的图片）。

URL: /alarms/

Method: GET

Query Param (可选筛选):

task_id: 按任务筛选

wayline_id: 按航线筛选

📤 Response
JSON

{
    "count": 5,
    "next": null,
    "previous": null,
    "results": [
        {
            "id": 1,
            "content": "AI检测发现: 螺母松动, 扣件缺失", // 具体的病害描述
            "image_url": "李达轨道检测_20251214/detected_img_99.jpg",
            "status": "PENDING",
            "created_at": "2025-12-14T10:30:00Z"
        }
    ]
}
📝 状态码字典 (Detection Status)
算法返回的 detection_status 字段定义：

状态码	含义	前端处理建议
0	正常	显示绿色标记，或者仅在“全部图片”列表中展示。
1	异常	重点展示，标红，并在“告警列表”中显示。

导出到 Google 表格

🛠️ 前端开发注意点
图片路径拼接: 接口返回的 object_key 或 image_url 是 MinIO 里的相对路径（如 dji/xxx.jpg）。 前端展示时需拼接 MinIO 的 HTTP 前缀： http://<MinIO_IP>:9000/dji/<object_key>

轮询机制: 点击“开始检测”后，前端建议每隔 3-5秒 轮询一次“任务详情接口 (/report/)”，直到 status 变为 done，以实时更新进度条。